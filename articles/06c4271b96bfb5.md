---
title: "ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ç”Ÿæˆã«ä¸€æ§˜åˆ†å¸ƒã‚’æ±‚ã‚ã‚‹ã®ã¯é–“é•ã£ã¦ã„ã‚‹ã ã‚ã†ã‹"
emoji: "ğŸŒ½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Haskell", "math", "ã‚°ãƒ©ãƒ•ç†è«–"]
publication_name: "folio_sec"
published: true
---

ã“ã‚Œã¯ [FOLIO Advent Calendar 2025](https://adventar.org/calendars/11591) 17æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/54f23ccf0bdc-20251214.png)

èª°ã§ã‚‚ä¸€åº¦ã¯é­”ç‹ã«ãªã£ã¦ã€å‹‡è€…ã®ãã›ã«ãªã¾ã„ãã ã¨ã€ä¾µå…¥è€…ã‚’æ’ƒé€€ã™ã‚‹ãŸã‚ã®ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ä½œã‚Šã«èˆˆã˜ãŸã“ã¨ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ï¼ˆé•·ã„ã®ã§ä»¥é™ã¯**è¿·è·¯**ã¨å‘¼ã¶ï¼‰ã¯å¤ãã‹ã‚‰ã‚ã‚‹å®šç•ªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãªã ã‘ã‚ã£ã¦ã€è‡ªå‹•çš„ãªç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚‚æ£’å€’ã—æ³•ã‚„ç©´æ˜ã‚Šæ³•ãªã©æ§˜ã€…ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã£ã¦ã¯é•·ã„ç›´ç·šã ã‚‰ã‘ã®é€šè·¯ãŒã§ãã¦ã—ã¾ã£ãŸã‚Šã€åå¯¾ã«è¡Œãæ­¢ã¾ã‚ŠãŒå¤šããªã£ã¦ã—ã¾ã£ãŸã‚Šã¨**ç”Ÿæˆã•ã‚Œã‚‹è¿·è·¯ã«åã‚ŠãŒç”Ÿã˜ã‚‹**ã“ã¨ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ãã“ã§æœ¬ç¨¿ã§ã¯ã¡ã‚‡ã£ã¨è¦–ç‚¹ã‚’åŠ ãˆã¦ã€ç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åã‚ŠãŒãªã„**å®Œå…¨ã«å…¬å¹³ãªè¿·è·¯ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ã‚’è€ƒãˆãŸã„ã¨æ€ã„ã¾ã™ã€‚

## è¿·è·¯ã¨ã‚°ãƒ©ãƒ•

è¿·è·¯ã‚’ã€Œéƒ¨å±‹ã€ã¨ã€Œé€šè·¯ã€ã¨ã„ã†2ã¤ã®æ§‹æˆè¦ç´ ã«åˆ†ã‘ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã™ã‚‹ã¨è¿·è·¯ã¯éƒ¨å±‹ã‚’**é ‚ç‚¹**ã€é€šè·¯ã‚’**è¾º**ã¨ã™ã‚‹ã‚ˆã†ãª**ã‚°ãƒ©ãƒ•æ§‹é€ **ã ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/46f49aea4f09-20251109.png)

æœ€åˆã«æœ¬ç¨¿ã§æ‰±ã†ã‚°ãƒ©ãƒ•ã‚’æ­£ç¢ºã«å®šç¾©ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚æœ¬ç¨¿ã§ã¯ã‚°ãƒ©ãƒ• $G$ ã‚’é ‚ç‚¹ã®é›†åˆ $V(G)$ ã¨è¾ºã®é›†åˆ $E(G)$ ã‹ã‚‰æˆã‚Šã€æœ‰é™ã§é€£çµã§ç„¡å‘ã§ãƒ«ãƒ¼ãƒ—ã¨é‡ã¿ã‚’æŒãŸãªã„å¤šé‡ã‚°ãƒ©ãƒ•ã§ã‚ã‚‹ã¨ã—ã¾ã™ï¼ˆä»¥ä¸‹ã§è©³ã—ãèª¬æ˜ã—ã¾ã™ï¼‰ã€‚

ã¾ãšã‚°ãƒ©ãƒ•ãŒ**æœ‰é™**ã§ã‚ã‚‹ã¨ã¯**é ‚ç‚¹ã¨è¾ºã®é›†åˆãŒå…±ã«æœ‰é™é›†åˆ**ã§ã‚ã‚‹ã“ã¨ã‚’è¨€ã„ã¾ã™ã€‚ä»¥é™ã¯é ‚ç‚¹é›†åˆã®è¦ç´ æ•° $|V(G)|$ ã‚’ $n$ã€è¾ºé›†åˆã®è¦ç´ æ•° $|E(G)|$ ã‚’ $m$ ã¨æ›¸ãã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚

$$
\begin{matrix}
n &=& |V(G)| \\
m &=& |E(G)| \\
\end{matrix}
$$

æ¬¡ã«ã‚°ãƒ©ãƒ•ãŒ**é€£çµ**ã§ã‚ã‚‹ã¨ã¯**ä»»æ„ã®ç›¸ç•°ãªã‚‹2é ‚ç‚¹ã‚’è¾ºã‚’è¾¿ã£ã¦ç§»å‹•ã§ãã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã‚‚ã†å°‘ã—æ­£ç¢ºã«è¿°ã¹ã‚‹ãŸã‚ã«ã€è¾ºé›†åˆã‹ã‚‰é ‚ç‚¹é›†åˆã®å†ªé›†åˆ$\mathfrak{P}(V)$ã¸ã®é–¢æ•°ã¨ã—ã¦**æ¥ç¶šé–¢æ•°**$\phi$ã‚’å°å…¥ã—ã¾ã™ã€‚

$$
\phi: E(G) \to \mathfrak{P}(V)
$$

ã“ã‚Œã¯**è¾ºã®ä¸¡ç«¯ã«ã‚ã‚‹é ‚ç‚¹ã®é›†åˆã‚’è¿”ã™é–¢æ•°**ã§ã€ä¾‹ãˆã°

![](https://storage.googleapis.com/zenn-user-upload/b6899648b047-20251111.png =200x)

ä¸Šè¨˜ã®ã‚ˆã†ãª2ã¤ã®é ‚ç‚¹ã¨1ã¤ã®è¾ºã‚’æŒã¤ç°¡å˜ãªã‚°ãƒ©ãƒ•ãŒã‚ã£ãŸå ´åˆ

$$
\phi(e) = \{v_1, v_2\}
$$

ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’ä½¿ãˆã°ã‚°ãƒ©ãƒ•ãŒé€£çµã§ã‚ã‚‹ã¨ã¯ã€ä»»æ„ã®ç›¸ç•°ãªã‚‹2ã¤ã®é ‚ç‚¹ $a, b \in V(G)$ ã¨1ä»¥ä¸Šã®è‡ªç„¶æ•° $k$ ã«å¯¾ã—ã¦ä»¥ä¸‹ã®é–¢ä¿‚ã‚’æº€ãŸã™é ‚ç‚¹é›†åˆ $\{v_1, \dots, v_{k+1}\}$ ã¨è¾ºé›†åˆ $\{e_1, \dots, e_k\}$ ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã¨è¨€ãˆã¾ã™ã€‚

$$
\begin{matrix}
v_1 &=& a \\
v_{k+1} &=& b \\
\phi(e_l) &=& \{v_l, v_{l+1}\},&1 \leq l \leq k \\
\end{matrix}
$$

æ¥ç¶šé–¢æ•°$\phi$ã¯å†ªé›†åˆã«å€¤ã‚’å–ã‚‹ã¨è¨€ã„ã¾ã—ãŸãŒã€é€šå¸¸ãã®åƒã¯1ç‚¹ã¾ãŸã¯2ç‚¹ã®é›†åˆã§ã™ã€‚ä¾‹ãˆã°ã‚ã‚‹è¾º$e$ã«å¯¾ã—ã¦$\phi(e)$ãŒ1ç‚¹é›†åˆã®å ´åˆã€è¾ºã®ä¸¡ç«¯ã®é ‚ç‚¹ãŒç­‰ã—ã„ã¨è§£é‡ˆã§ãã‚‹ã®ã§è¾º$e$ã¯ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ã—ã¦ã„ã‚‹ã¨è§£é‡ˆã§ãã¾ã™ã€‚ãŸã ã—æœ¬ç¨¿ã§ã¯**ãƒ«ãƒ¼ãƒ—ã®ãªã„ã‚°ãƒ©ãƒ•**ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã§ã€æ¥ç¶šé–¢æ•°$\phi$ã®åƒã¯**å¸¸ã«2ç‚¹é›†åˆ**ã¨ãªã‚Šã¾ã™ã€‚

æ–‡çŒ®ã«ã‚ˆã£ã¦ã¯**é‡ã¿**ã¨ã—ã¦è¾ºé›†åˆ$E(G)$ã‹ã‚‰æ­£ã®æ•°ã¸ã®é–¢æ•°ã‚’è€ƒãˆã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒ**æœ¬ç¨¿ã§ã¯è€ƒãˆã¾ã›ã‚“**ã€‚

æœ€å¾Œã«**å¤šé‡ã‚°ãƒ©ãƒ•**ã¨ã¯ã€æ¥ç¶šé–¢æ•° $\phi$ ãŒ**å˜å°„ã§ã‚ã‚‹ã¨ã¯é™ã‚‰ãªã„**ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã¤ã¾ã‚Šç›¸ç•°ãªã‚‹è¾º $e_1, e_2 \in E(G)$ ã§ã‚ã£ã¦ã‚‚

$$
\phi(e_1) = \phi(e_2)
$$

ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯2ã¤ã®é ‚ç‚¹ã®é–“ã«è¤‡æ•°ã®è¾ºãŒã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ï¼ˆè¿·è·¯ã‚’è€ƒãˆã‚‹ä¸Šã§ã¯ã‚ã¾ã‚Šç„¡ã„çŠ¶æ³ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b0e0434eab4d-20251111.png =200x)

ä»¥ä¸ŠãŒæœ¬ç¨¿ã§è€ƒãˆã‚‹ã‚°ãƒ©ãƒ•ã®å®šç¾©ã§ã™ã€‚

è¿·è·¯ã‚’ã‚°ãƒ©ãƒ•ã§è¡¨ã™ã“ã¨ãŒã§ãã¦ã‚‚ã€åå¯¾ã«ä»»æ„ã®ã‚°ãƒ©ãƒ•ãŒè¿·è·¯ã«ãªã‚‹ã‹ã¯ã¾ã åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚**ã©ã®ã‚ˆã†ãªã‚°ãƒ©ãƒ•ã‚’è¿·è·¯ã¨ã¿ãªã›ã‚‹ã®ã‹**ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ãŸã‚ã«æœ¬ç¨¿ã«ãŠã‘ã‚‹è¿·è·¯ã®å®šç¾©ã¨ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚°ãƒ©ãƒ•ã®æ¡ä»¶ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšä»»æ„ã®éƒ¨å±‹ã®é–“ã‚’é€šè·¯ã«ã‚ˆã£ã¦ç§»å‹•ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ã©ã“ã‹ã‚‰ã‚‚åˆ°é”ã§ããªã„ã‚ˆã†ãªå­¤ç«‹ã—ãŸéƒ¨å±‹ãŒç„¡ã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚æœ¬ç¨¿ã§ã¯**é€£çµãªã‚°ãƒ©ãƒ•**ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã§ã“ã®æ¡ä»¶ã«ã¤ã„ã¦ã¯è‡ªå‹•çš„ã«æº€ãŸã•ã‚Œã¦ã„ã¾ã™ã€‚æ¬¡ã«åŒã˜ã¨ã“ã‚ã‚’ã‚°ãƒ«ã‚°ãƒ«ã¨å·¡å›ã™ã‚‹ã‚ˆã†ãªé€šè·¯ãŒãªã„è¿·è·¯ã‚’è€ƒãˆã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ã“ã®æ¡ä»¶ã¯ã‚°ãƒ©ãƒ•ã®è¨€è‘‰ã§ã¯**é–‰è·¯ã‚’æŒãŸãªã„**ã¨è¨€ã„ã¾ã™ã€‚ä»¥ä¸Šã®ã‚ˆã†ãªé€£çµã§ã‚ã£ã¦é–‰è·¯ã‚’æŒãŸãªã„ã‚ˆã†ãªã‚°ãƒ©ãƒ•ã¯æœ¨æ§‹é€ ã¨ãªã‚Š**å…¨åŸŸæœ¨**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚

ä»¥ä¸Šã®è€ƒå¯Ÿã‹ã‚‰ã€å®Œå…¨ã«å…¬å¹³ãªè¿·è·¯ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦æ¬¡ã®ã‚ˆã†ãªæ–¹é‡ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã¾ãšè¿·è·¯ã®åœŸå°ã¨ãªã‚‹æ§‹é€ ã¨ã—ã¦å£ãŒä¸€ã¤ã‚‚ãªã„ç©ºé–“ã«å¯¾å¿œã™ã‚‹ã‚°ãƒ©ãƒ•ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã“ã®åœŸå°ã¨ãªã‚‹ã‚°ãƒ©ãƒ•ã«éƒ¨åˆ†ã‚°ãƒ©ãƒ•ã¨ã—ã¦å«ã¾ã‚Œã‚‹å…¨åŸŸæœ¨ã¯ä¸€ã¤ã¨ã¯é™ã‚‰ãªã„ã®ã§ã€å…¨åŸŸæœ¨å…¨ä½“ã®é›†åˆã‹ã‚‰ä¸€æ§˜ã«ãƒ©ãƒ³ãƒ€ãƒ ãªã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦å…¨åŸŸæœ¨ã‚’ç”Ÿæˆã—ã¾ã™ã€‚æœ€å¾Œã«å¾—ã‚‰ã‚ŒãŸå…¨åŸŸæœ¨ã«å¯¾å¿œã™ã‚‹è¿·è·¯ã‚’ä½œã£ã¦å®Œæˆã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0e8613552116-20251109.png)

æ–¹é‡ã¨ã—ã¦ã¯è‰¯ã•ãã†ã§ã™ãŒã€è‚å¿ƒã®ä¸€æ§˜ã«ãƒ©ãƒ³ãƒ€ãƒ ãªå…¨åŸŸæœ¨ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãŒæœ¬å½“ã«å®Ÿç¾ã§ãã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

## è¡Œåˆ—æœ¨ã®å®šç†ã¨ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚°ãƒ©ãƒ•ç†è«–
æœ‰é™ã‚°ãƒ©ãƒ•ã®å…¨åŸŸæœ¨ã®é›†åˆãŒæœ‰é™é›†åˆã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€ã¾ãšã¯å…¨ã¦ã®å…¨åŸŸæœ¨ã«åŒã˜ç¢ºç‡ã‚’ä»˜ä¸ã—ãŸé›¢æ•£ä¸€æ§˜åˆ†å¸ƒã‚’è€ƒãˆã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚ç¢ºç‡ã¯åˆè¨ˆã™ã‚‹ã¨1ã«ãªã‚‹ã®ã§ã€ä»˜ä¸ã™ã‚‹ç¢ºç‡ã¯1ã‚’**å…¨åŸŸæœ¨ã®å€‹æ•°**ã§å‰²ã£ãŸå€¤ã¨ãªã‚Šã¾ã™ã€‚å®Ÿã¯ã‚°ãƒ©ãƒ•ã«å«ã¾ã‚Œã‚‹å…¨åŸŸæœ¨ã®å€‹æ•°ã«ã¤ã„ã¦**è¡Œåˆ—æœ¨ã®å®šç†**ã¨å‘¼ã°ã‚Œã‚‹ä»¥ä¸‹ã®å®šç†ãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚

> **ã€è¡Œåˆ—æœ¨ã®å®šç†ã€‘**
> ã‚°ãƒ©ãƒ•ã®å…¨åŸŸæœ¨ã®å€‹æ•°ã¯ã€ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä»»æ„ã®ä½™å› å­ã«ç­‰ã—ã„ã€‚

ã“ã“ã§ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¨ã„ã†æ–°ã—ã„å˜èªãŒå‡ºã¦ãã¾ã—ãŸã€‚ã“ã‚Œã¯**ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚°ãƒ©ãƒ•ç†è«–**ã¨ã„ã†åˆ†é‡ã«ç¾ã‚Œã‚‹æ¦‚å¿µã§ã€ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚°ãƒ©ãƒ•ç†è«–ã¨ã¯ã‚°ãƒ©ãƒ•ã‹ã‚‰è¡Œåˆ—ã¨ã„ã†å½¢ã§æƒ…å ±ã‚’å–ã‚Šå‡ºã—ãã®è¡Œåˆ—ã‚’èª¿ã¹ã‚‹ã“ã¨ã§ã‚°ãƒ©ãƒ•ã®æ€§è³ªã‚’ç ”ç©¶ã™ã‚‹æ•°å­¦ã®ä¸€åˆ†é‡ã§ã™ã€‚

ã‚°ãƒ©ãƒ•ã‹ã‚‰æŠ½å‡ºã§ãã‚‹åŸºæœ¬çš„ãªè¡Œåˆ—ã¨ã—ã¦**éš£æ¥è¡Œåˆ—**ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ $n\times n$ è¡Œåˆ—ã§ã‚ã‚Šã€ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã‚’ $\{v_1, \dots, v_n\}$ ã¨ã™ã‚‹ã¨ã€$(i,j)$ æˆåˆ†ãŒ $v_i$ ã¨ $v_j$ ã‚’çµã¶è¾ºã®æ•°ã«ãªã£ã¦ã„ã‚‹è¡Œåˆ—ã§ã™ã€‚ä¾‹ãˆã°

![](https://storage.googleapis.com/zenn-user-upload/cb24beac6039-20251115.png =200x)

ä¸Šè¨˜ã®ã‚°ãƒ©ãƒ•ã®éš£æ¥è¡Œåˆ— $A$ ã¯

$$
A =
\begin{pmatrix}
0 & 2 & 0 \\
2 & 0 & 1 \\
0 & 1 & 0 \\
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚

ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ $v$ ã«æ¥ç¶šã—ã¦ã„ã‚‹è¾ºã®æ•°ã‚’ãã®é ‚ç‚¹ã®**æ¬¡æ•°** $\operatorname{deg}(v)$ ã¨å‘¼ã³ã¾ã™ã€‚ã‚°ãƒ©ãƒ•ã®**æ¬¡æ•°è¡Œåˆ—**ã¨ã¯å¯¾è§’æˆåˆ†ã«å„é ‚ç‚¹ã®æ¬¡æ•°ã‚’æŒã¤å¯¾è§’è¡Œåˆ—ã§ã™ã€‚å…ˆç¨‹ã®ä¾‹ã®ã‚°ãƒ©ãƒ•ã®æ¬¡æ•°è¡Œåˆ— $D$ ã¯

$$
D =
\begin{pmatrix}
2 & 0 & 0 \\
0 & 3 & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚

ã‚°ãƒ©ãƒ•ã®**ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—** $L$ ã¯æ¬¡æ•°è¡Œåˆ—ã‹ã‚‰éš£æ¥è¡Œåˆ—ã‚’å¼•ã„ãŸã‚‚ã®ã¨å®šç¾©ã•ã‚Œã¾ã™ã€‚

$$
L = D - A
$$

å…ˆç¨‹ã®ä¾‹ã®ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã¯

$$
L =
\begin{pmatrix}
2 & -2 & 0 \\
-2 & 3 & -1 \\
0 & -1 & 1 \\
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚

ä¸Šè¨˜ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã‚’çœºã‚ã‚‹ã¨å„è¡Œã®è¦ç´ ã‚’è¶³ã™ã¨0ã«ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ï¼ˆç„¡å‘ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯å¯¾ç§°è¡Œåˆ—ãªã®ã§å„åˆ—ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã§ã™ï¼‰ã€‚ã“ã‚Œã¯ä¸Šè¨˜ã®ä¾‹ã ã‘ã§ãªãä¸€èˆ¬ã®ã‚°ãƒ©ãƒ•ã§ã‚‚æˆã‚Šç«‹ã¡ã€å…¨ã¦ã®è¦ç´ ãŒ1ã§ã‚ã‚‹ãƒ™ã‚¯ãƒˆãƒ« $1$ ãŒç·šå½¢å†™åƒã¨ã—ã¦ã®è¡Œåˆ— $L$ ã®æ ¸ $\operatorname{Ker}L = \{x\ |\ Lx = 0\}$ ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚$n$æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ« $x = (x_1, \dots, x_n)$ ã«å¯¾ã—ã¦ $Lx$ ã¯

$$
Lx = Dx - Ax =
\begin{pmatrix}
\operatorname{deg}(v_1)x_1 \\
\vdots \\
\operatorname{deg}(v_n)x_n \\
\end{pmatrix}
-
\begin{pmatrix}
\displaystyle\sum_{\{v_1,v_i\}\in E(G)}x_i \\
\vdots \\
\displaystyle\sum_{\{v_n,v_i\}\in E(G)}x_i
\end{pmatrix}
=
\begin{pmatrix}
\displaystyle\sum_{\{v_1,v_i\}\in E(G)}(x_1-x_i) \\
\vdots \\
\displaystyle\sum_{\{v_n,v_i\}\in E(G)}(x_n-x_i)
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã“ã§ $\sum_{\{v_i, v_j\}\in E(G)}$ ã¯ $\phi(e) = \{v_i, v_j\}$ ã¨ãªã‚‹ã‚ˆã†ãªè¾ºã«æ¸¡ã£ã¦å’ŒãŒè¨ˆç®—ã•ã‚Œã‚‹ã“ã¨ã‚’è¡¨ã™ã¨ã—ã¾ã™ã€‚å¾—ã‚‰ã‚ŒãŸå¼ã‚’è¦‹ã‚‹ã¨å…¨ã¦ã®è¦ç´ ã®å€¤ãŒç­‰ã—ã„å®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ãŒ $\operatorname{Ker}L$ ã«å«ã¾ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«äºŒæ¬¡å½¢å¼ $x^{\sf T}Lx$ ã‚’è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

$$
x^{\sf T}Lx = x^{\sf T}Dx - x^{\sf T}Ax = \sum_{k=1}^n\operatorname{deg}(v_k)x_k^2 - \sum_{\{v_i, v_j\}\in E(G)}2x_ix_j
$$

ã“ã“ã§ $\sum_{k=1}^n\operatorname{deg}(v_k)x_k^2$ ã‚’è¾ºã«æ¸¡ã‚‹å’Œã§æ›¸ãç›´ã™ã¨ã€$\phi(e) = \{v_i, v_j\}$ ã¨ãªã‚‹ã‚ˆã†ãªè¾º $e$ ãŒã‚ã‚Œã° $v_i$ ã¨ $v_j$ ãã‚Œãã‚Œã®æ¬¡æ•°1ã«å¯¾å¿œã™ã‚‹ã®ã§

$$
\sum_{k=1}^n\operatorname{deg}(v_k)x_k^2 = \sum_{\{v_i, v_j\}\in E(G)}\left(x_i^2 + x_j^2\right)
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦å…ƒã®å¼ã‚’æ›¸ãç›´ã™ã¨

$$
\begin{matrix}
x^{\sf T}Lx
&=& \displaystyle\sum_{\{v_i, v_j\}\in E(G)}\left(x_i^2 + x_j^2\right) - \displaystyle\sum_{\{v_i, v_j\}\in E(G)}2x_ix_j \\
&=& \displaystyle\sum_{\{v_i, v_j\}\in E(G)} \left(x_i^2 -2x_ix_j + x_j^2\right) \\
&=& \displaystyle\sum_{\{v_i, v_j\}\in E(G)}\left(x_i - x_j\right)^2 \\
\end{matrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚$x^{T}Lx = 0$ ã¨ãªã‚‹ãŸã‚ã«ã¯ $v_i$ ã¨ $v_j$ ãŒè¾ºã§çµã°ã‚Œã¦ã„ã‚‹å ´åˆ $x_i$ ã¨ $x_j$ ã®å€¤ãŒç­‰ã—ããªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šã¯é€£çµãªã‚°ãƒ©ãƒ•ã®ã¿ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã§çµå±€å…¨ã¦ã® $x_i$ ã®å€¤ãŒç­‰ã—ããªã‚Šå®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ã¨ãªã‚Šã¾ã™ã€‚ã¾ãŸåŒæ§˜ã«ã“ã®å¼ã‹ã‚‰$L$ãŒåŠæ­£å®šå€¤è¡Œåˆ—ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã®ã§ $Lx = 0 \iff x^{\sf T}Lx = 0$ ã¨ãªã‚Š[^1] $\operatorname{Ker}L$ ã¯å®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ã§å¼µã‚‰ã‚Œã‚‹1æ¬¡å…ƒç©ºé–“ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚

ã•ã¦è¡Œåˆ—æœ¨ã®å®šç†ã¯ã€Œã‚°ãƒ©ãƒ•ã®å…¨åŸŸæœ¨ã®å€‹æ•°ã¯ã€ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä»»æ„ã®ä½™å› å­ã«ç­‰ã—ã„ã€ã¨ã„ã†ã‚‚ã®ã§ã—ãŸã€‚ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯åˆ†ã‹ã£ãŸã®ã§æ¬¡ã«ä½™å› å­ã¨ã¯ä½•ã‹è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãŸã“ã®å®šç†ã®ä¸»å¼µã¯ã€Œä»»æ„ã®ä½™å› å­ã«ç­‰ã—ã„ã€ã¨ã‚ã‚Šã¾ã™ãŒã€å…¨åŸŸæœ¨ã®å€‹æ•°ã¯ä¸€é€šã‚Šã«å®šã¾ã‚‹ã®ã§ã€Œãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä»»æ„ã®ä½™å› å­ã®å€¤ã¯ç­‰ã—ã„ã€ã“ã¨ãŒå‰æã«ã‚ã‚‹ã®ã‚‚æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚

ä¸€èˆ¬ã«$n$æ¬¡è¡Œåˆ—$A$ã®$(i,j)$**ä½™å› å­**ã¨ã¯ã€å…ƒã®è¡Œåˆ—ã®$i$è¡Œæˆåˆ†ã¨$j$åˆ—æˆåˆ†ã‚’é™¤ã„ãŸ$n-1$æ¬¡è¡Œåˆ—ã®è¡Œåˆ—å¼ã«$(-1)^{(i+j)}$ã‚’æ›ã‘ãŸã‚‚ã®ã§ã€$(i,j)$æˆåˆ†ã¨ã—ã¦$(i,j)$ä½™å› å­ã‚’æŒã¤$n$æ¬¡è¡Œåˆ—ã®è»¢ç½®è¡Œåˆ—ã‚’**ä½™å› å­è¡Œåˆ—**$\operatorname{adj}(A)$ã¨è¨€ã„ã¾ã™ã€‚å…ƒã®è¡Œåˆ—ã¨ä½™å› å­è¡Œåˆ—ã®ç©ã¯

$$
A\cdot\operatorname{adj}(A) = \operatorname{det}(A)I
$$

ã¨ãªã‚Šã¾ã™ã€‚å³è¾ºã®å¯¾è§’æˆåˆ†ãŒ $\operatorname{det}(A)$ ã«ä¸€è‡´ã™ã‚‹ã“ã¨ã¯[ä½™å› å­å±•é–‹](https://ja.wikipedia.org/wiki/%E4%BD%99%E5%9B%A0%E5%AD%90%E5%B1%95%E9%96%8B)ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸéå¯¾è§’æˆåˆ†ã®$(i,j)$æˆåˆ†ã¯è¡Œåˆ—$A$ã®$j$è¡Œã‚’$i$è¡Œã§ç½®ãæ›ãˆãŸæ–°ã—ã„è¡Œåˆ—$A'$ã®è¡Œåˆ—å¼ã‚’ä½™å› å­å±•é–‹ã«ã‚ˆã‚Šè¨ˆç®—ã—ã¦ã„ã‚‹ã“ã¨ã«å¯¾å¿œã™ã‚‹ã®ã§ã€$A'$ã®è¡Œãƒ™ã‚¯ãƒˆãƒ«ãŒç·šå½¢å¾“å±ã¨ãªã‚‹ã“ã¨ã‹ã‚‰$0$ã«ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã®é–¢ä¿‚å¼ã¯é€†è¡Œåˆ—ã®è¨ˆç®—ã«ã‚ˆãåˆ©ç”¨ã•ã‚Œã¾ã™ã‚ˆã­ã€‚

ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—$L$ã«ã¤ã„ã¦ä¸Šè¨˜é–¢ä¿‚å¼ã‚’è€ƒãˆã‚‹ã¨ $\operatorname{Ker}L$ ã¯éè‡ªæ˜ãªã®ã§ $\operatorname{det}(L)=0$ ã¨ãªã‚Š

$$
L\cdot\operatorname{adj}(L) = O
$$

ã¨ãªã‚Šã¾ã™ï¼ˆ$O$ã¯å…¨ã¦ã®æˆåˆ†ãŒ $0$ ã§ã‚ã‚‹é›¶è¡Œåˆ—ï¼‰ã€‚

ã¾ãŸ $\operatorname{Ker}L$ ã¯å®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ãŒå¼µã‚‹ç©ºé–“ã ã£ãŸã®ã§ $\operatorname{adj}(L)$ ã¯

$$
\operatorname{adj}(L) =
\begin{pmatrix}
c_1 & \dots & c_n \\
\vdots  & \ddots & \vdots \\
c_1 & \dots & c_n \\
\end{pmatrix}
$$

ã¨å®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ãŒåˆ—ãƒ™ã‚¯ãƒˆãƒ«ã¨ã—ã¦ä¸¦ã‚“ã è¡Œåˆ—ã«ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã¯å¯¾ç§°è¡Œåˆ—ãªã®ã§å®šç¾©ã‚ˆã‚Šãã®ä½™å› å­è¡Œåˆ— $\operatorname{adj}(L)$ ã‚‚å¯¾ç§°ã¨ãªã‚Š

$$
\begin{pmatrix}
c_1 & \dots & c_n \\
\vdots  & \ddots & \vdots \\
c_1 & \dots & c_n \\
\end{pmatrix}
=
\begin{pmatrix}
c_1 & \dots & c_1 \\
\vdots  & \ddots & \vdots \\
c_n & \dots & c_n \\
\end{pmatrix}
$$

ã§ã™ã€‚ã‚ˆã£ã¦ $c_1 = \dots = c_n$ ãŒå°ã‹ã‚Œä½™å› å­è¡Œåˆ— $\operatorname{adj}(L)$ ã®æˆåˆ†ã¯å…¨ã¦ç­‰ã—ã„

$$
\operatorname{adj}(L) =
\begin{pmatrix}
c & \dots & c \\
\vdots  & \ddots & \vdots \\
c & \dots & c \\
\end{pmatrix}
$$

ã¤ã¾ã‚Š**ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä»»æ„ã®ä½™å› å­ã¯ç­‰ã—ã„**ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚

è¡Œåˆ—æœ¨ã®å®šç†ã¯æ¥ç¶šè¡Œåˆ—ã¨ã‚³ãƒ¼ã‚·ãƒ¼ãƒ»ãƒ“ãƒã®å…¬å¼ã‹ã‚‰è¨¼æ˜ã§ãã¾ã™ãŒã€é•·ããªã‚‹ã®ã§æœ¬ç¨¿ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚è¨¼æ˜ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã¨æ–‡çŒ®ã¸ã®ãƒªãƒ³ã‚¯ãŒ ["Kirchhoff's theorem - Wikipedia"](https://en.wikipedia.org/wiki/Kirchhoff%27s_theorem#Proof_outline) ã«ã‚ã‚‹ã®ã§æ°—ã«ãªã‚‹äººã¯ã”å‚ç…§ãã ã•ã„ã€‚

å…ˆè¿°ã—ãŸä¾‹ã®ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä»»æ„ã®ä½™å› å­ã¯è¨ˆç®—ã™ã‚‹ã¨2ã«ãªã‚Šã¾ã™ã€‚æ›´ã«å…¨åŸŸæœ¨ã¯é ‚ç‚¹$v_1$ã¨$v_2$é–“ã®ã©ã¡ã‚‰ã®è¾ºã‚’é¸æŠã™ã‚‹ã‹ã«ã‚ˆã£ã¦å®šã¾ã‚‹ã®ã§2å€‹ã—ã‹ãªãã€è¡Œåˆ—æœ¨ã®å®šç†ãŒè¿°ã¹ã‚‹é€šã‚Šã“ã‚Œã‚‰ã®å€¤ã¯ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸Šã§å…¨åŸŸæœ¨ã®å€‹æ•°ã®æ±‚ã‚æ–¹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã—ã‹ã—å…¨åŸŸæœ¨ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«å…·ä½“çš„ã«ã©ã†ã‚„ã£ã¦å…¨åŸŸæœ¨ã‚’ä½œã‚Œã°ã‚ˆã„ã‹ã¯ã¾ã åˆ†ã‹ã‚Šã¾ã›ã‚“ã­ã€‚

## ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³
å…¨åŸŸæœ¨ã®ä½œã‚Šæ–¹ã‚’è€ƒãˆã‚‹ãŸã‚ã«å…¨åŸŸæœ¨ã®é›†åˆã®æ§‹é€ ã‚’ã‚‚ã†å°‘ã—è©³ã—ãèª¿ã¹ã¾ã—ã‚‡ã†ã€‚å˜ãªã‚‹æœ‰é™é›†åˆã¨ã—ã¦ç†è§£ã™ã‚‹ãªã‚‰å€‹æ•°ã‚’èª¿ã¹ã‚Œã°ååˆ†ã§ã™ãŒã€ã‚ˆã‚Šè©³ã—ãèª¿ã¹ã‚‹ãŸã‚ã«ã¯å…¨åŸŸæœ¨ã®é›†åˆã«ã•ã‚‰ãªã‚‹æ§‹é€ ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿã¯å…¨åŸŸæœ¨ã®é›†åˆã¯**ç¾¤**ã«ãªã‚‹ã®ã§ã™ã€‚

ã‚°ãƒ©ãƒ•ã‹ã‚‰ç¾¤æ§‹é€ ã‚’å–ã‚Šå‡ºã™ãŸã‚ã«ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã®å½¢å¼çš„ãªå’Œã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚ã¤ã¾ã‚Šã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹[è‡ªç”±ã‚¢ãƒ¼ãƒ™ãƒ«ç¾¤](https://ja.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E3%82%A2%E3%83%BC%E3%83%99%E3%83%AB%E7%BE%A4) $\operatorname{Div}(G)$ ã‚’è€ƒãˆã¾ã™ã€‚ã“ã‚Œã¯ **è‡ªç”± ${\mathbb Z}$ åŠ ç¾¤** ã§ã‚ã‚Šã€ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã‚’åŸºåº•ã¨ã™ã‚‹ï¼ˆå€¤ã‚’æ•´æ•°ã«é™å®šã—ãŸï¼‰"ãƒ™ã‚¯ãƒˆãƒ«ç©ºé–“"ã®ã‚ˆã†ãªã‚‚ã®ã¨è€ƒãˆã¦ã„ãŸã ã‘ã‚Œã°ååˆ†ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ $v_i$ ã«å¯¾å¿œã™ã‚‹åŸºåº•ã‚’ãã®ã¾ã¾ $v_i$ ã¨æ›¸ãã¨ $\operatorname{Div}(G)$ ã®å…ƒã¯ã€ä¾‹ãˆã°

$$
3v_2 + 4v_3 - 6v_5
$$

ã®ã‚ˆã†ã«è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

$\operatorname{Div}(G)$ ã®å…ƒã‚’ã‚°ãƒ©ãƒ• $G$ ã®**å› å­**ã¨å‘¼ã³ã¾ã™ã€‚å› å­ $D\in\operatorname{Div}(G)$ ãŒ

$$
D = \sum_{v\in V(G)} a_vv
$$

ã¨è¡¨ã›ã‚‹æ™‚ã€å„åŸºåº•ã®ä¿‚æ•° $a_v$ ã‚’ $D(v)$ ã¨è¡¨ã™ã“ã¨ã«ã—ã¾ã™ã€‚å› å­ $D$ ã®**æ¬¡æ•°** $\operatorname{deg}(D)$ ã‚’å…¨ã¦ã®åŸºåº•ã®ä¿‚æ•°ã‚’åˆè¨ˆã—ãŸå€¤

$$
\operatorname{deg}(D) = \sum_{v\in V(G)} D(v)
$$

ã¨å®šç¾©ã—ã¾ã™ã€‚ä¾‹ãˆã°å…ˆç¨‹ã®ä¾‹ã®å› å­ã ã¨æ¬¡æ•°ã¯$1$ã¨ãªã‚Šã¾ã™ã€‚å› å­ã®æ¬¡æ•°ã¯ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã®æ¬¡æ•°ã¨åå‰ã¯åŒã˜ã§ã™ãŒç•°ãªã‚‹æ¦‚å¿µã§ã™ã€‚

ã•ã¦**ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã‚’å¼•æ•°ã«å–ã‚Šæ•´æ•°ã‚’è¿”ã™é–¢æ•°**ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚ã“ã®ã‚ˆã†ãªé–¢æ•°å…¨ä½“ã®é›†åˆã‚’ ${\mathcal M}(G)$ ã¨è¡¨ã—ã¾ã™ã€‚

$$
{\mathcal M}(G) = \{f\ |\ f : V(G)\to{\mathbb Z}\}
$$

${\mathcal M}(G)$ ã‹ã‚‰ $\operatorname{Div}(G)$ ã¸ã®å†™åƒã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãª**ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ ** $\Delta$ ãŒã‚ã‚Šã¾ã™ã€‚

$$
\begin{matrix}
\Delta(f) &=& \displaystyle\sum_{v\in V(G)}\Delta_v(f)v \\
\Delta_v(f) &=& \displaystyle\sum_{\{v,w\}\in E(G)}\left(f(v)-f(w)\right)
\end{matrix}
$$

ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ ã®åƒã¨ãªã‚‹å› å­ã®é›†åˆã‚’$\operatorname{Prin}(G)$ã¨æ›¸ãã€$\operatorname{Prin}(G)$ã®å…ƒã‚’**ä¸»å› å­**ã¨å‘¼ã³ã¾ã™[^2]ã€‚

$$
\operatorname{Prin}(G) = \operatorname{Im}(\Delta)
$$

${\mathcal M}(G)$ ã®å…ƒã‚’å„é ‚ç‚¹ã§è©•ä¾¡ã—ãŸå€¤ã‚’é †ç•ªã«ä¸¦ã¹ã¦ ${\mathbb Z}^n$ ã®å…ƒã«å¯¾å¿œã•ã›ã‚‹æ–¹æ³•ã§ã€ã“ã®2ã¤ãŒåŒå‹ ${\mathcal M}(G)\cong{\mathbb Z}^n$ ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚$f \in {\mathcal M}(G)$ ã‚’ã“ã®å¯¾å¿œã«ã‚ˆã‚Š ${\mathbb Z}^n$ ã®å…ƒã«å†™ã—ãŸã‚‚ã®ã‚’ $[f]$ ã¨æ›¸ãã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚åŒæ§˜ã«å› å­ã‚’åŸºåº•ï¼ˆé ‚ç‚¹ï¼‰ã®ä¿‚æ•°ã‚’é †ç•ªã«ä¸¦ã¹ã¦ ${\mathbb Z}^n$ ã®å…ƒã«å¯¾å¿œã•ã›ã‚‹æ–¹æ³•ã§ã€ã“ã®2ã¤ãŒåŒå‹ $\operatorname{Div}(G)\cong{\mathbb Z}^n$ ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚$D \in \operatorname{Div}(G)$ ã‚’ã“ã®å¯¾å¿œã«ã‚ˆã‚Š ${\mathbb Z}^n$ ã®å…ƒã«å†™ã—ãŸã‚‚ã®ã‚‚ $[D]$ ã¨æ›¸ãã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ã¨ã“ã‚ã§ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯è¦ç´ ãŒæ•´æ•°ãªã®ã§é€šå¸¸ã®è¡Œåˆ—ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®ç©ã¨åŒã˜è¨ˆç®—ã«ã‚ˆã‚Šæº–åŒå‹å†™åƒ $L: {\mathbb Z}^n \to {\mathbb Z}^n$ ã¨ã¿ãªã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®å¯¾å¿œã«ã‚ˆã‚Šãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ ã¨ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯ä»¥ä¸‹ã®é–¢ä¿‚å¼ã‚’æº€ãŸã™ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

$$
[\Delta(f)] = L[f]
$$

æ¬¡æ•°ãŒ $0$ ã¨ãªã‚‹å› å­å…¨ä½“ã‚’ $\operatorname{Div}^0(G)$ ã§è¡¨ã—ã¾ã™ã€‚å˜ä½å…ƒï¼ˆå…¨ã¦ã®åŸºåº•ã®ä¿‚æ•°ãŒ0ã§ã‚ã‚‹ã‚ˆã†ãªå…ƒï¼‰ã®æ¬¡æ•°ã¯0ã§ã™ã—ã€æ¬¡æ•°0ã®å› å­åŒå£«ã‚’è¶³ã—ã¦ã‚‚å¼•ã„ã¦ã‚‚æ¬¡æ•°ã¯0ã®ã¾ã¾ãªã®ã§ã€ã“ã‚Œã¯ $\operatorname{Div}(G)$ ã®éƒ¨åˆ†ç¾¤ã¨ãªã‚Šã¾ã™ã€‚ã¾ãŸ $\operatorname{Prin}(G)$ ã®å…ƒã¯ãã®å®šç¾©ã‹ã‚‰æ¬¡æ•°ãŒ0ã¨ãªã‚‹ã®ã§ $\operatorname{Div}^0(G)$ ã«å«ã¾ã‚Œã¦ãŠã‚Šã€$\operatorname{Prin}(G)$ ã¯æº–åŒå‹å†™åƒã®åƒã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ $\operatorname{Div}^0(G)$ ã®éƒ¨åˆ†ç¾¤ã«ãªã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šä»¥ä¸‹ã®ã‚ˆã†ãªéƒ¨åˆ†ç¾¤ã®åˆ—ï¼ˆã‚¢ãƒ¼ãƒ™ãƒ«ç¾¤ãªã®ã§æ­£è¦éƒ¨åˆ†ç¾¤ã®åˆ—ï¼‰ãŒã‚ã‚Šã¾ã™ã€‚

$$
\operatorname{Div}(G) \trianglerighteq \operatorname{Div}^0(G) \trianglerighteq \operatorname{Prin}(G)
$$

ã“ã®é–¢ä¿‚ã‹ã‚‰å‰°ä½™ç¾¤ã¨ã—ã¦

- $\operatorname{Div}(G) / \operatorname{Div}^0(G)$
- $\operatorname{Div}(G) / \operatorname{Prin}(G)$
- $\operatorname{Div}^0(G) / \operatorname{Prin}(G)$

ã®3é€šã‚ŠãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã¾ãš $\operatorname{Div}(G) / \operatorname{Div}^0(G)$ ã¯ ${\mathbb Z}$ ã¨åŒå‹ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸ $\operatorname{Div}(G) / \operatorname{Prin}(G)$ ã«ã¯**å› å­é¡ç¾¤**ã€$\operatorname{Div}^0(G) / \operatorname{Prin}(G)$ ã«ã¯**ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³** $\operatorname{Jac}(G)$ [^3]ã¨ã„ã†åå‰ãŒã¤ã„ã¦ãŠã‚Šã€$\operatorname{Div}(G) / \operatorname{Prin}(G)\cong{\mathbb Z}\oplus\operatorname{Jac}(G)$ ã¨ã„ã†åŒå‹ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿã¯ã“ã®**ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ãŒå…¨åŸŸæœ¨ã®é›†åˆã¨å¯¾å¿œã™ã‚‹**ã®ã§ã™ã€‚

## ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ 
å› å­é¡ç¾¤ã‚„ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å®šç¾©ã¯æŠ½è±¡çš„ã§æ…£ã‚Œã¦ã„ãªã„ã¨ã‚ˆãã‚ã‹ã‚‰ãªã„ã¨æ€ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ç¾¤ãŒå…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªç¾¤ãªã®ã‹ã‚’è¦‹ã‚‹ãŸã‚ã«ã€å› å­ã‚’ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã«æ•´æ•°ã‚’å¯¾å¿œä»˜ã‘ã‚‹å½¢ã§å›³ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/25f3c9658483-20251121.png =200x)

ã“ã‚Œã¯æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã«ãŠã‘ã‚‹

$$
3v_1 - 3v_2 - v_3 + v_4
$$

ã¨ã„ã†å› å­ $D$ ã‚’è¡¨ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã®å› å­ã®æ¬¡æ•°ã¯ $\operatorname{deg}(D) = 0$ ãªã®ã§ $D \in \operatorname{Div}^0(G)$ ã¨ãªã‚Šã¾ã™ã€‚

ã“ã“ã§é ‚ç‚¹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ•´æ•°ã‚’"é ‚ç‚¹ã«ç½®ã‹ã‚ŒãŸãƒãƒƒãƒ—ã®æ•°"ï¼ˆè² ã®å ´åˆã¯å€Ÿé‡‘ï¼‰ã‚’è¡¨ã™ **é…ç½®ï¼ˆconfigurationï¼‰** ã ã¨è€ƒãˆ **ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ï¼ˆchip-firing gameï¼‰** ã¨å‘¼ã°ã‚Œã‚‹ä»¥ä¸‹ã®æ“ä½œã‚’è€ƒãˆã¾ã™ã€‚

1. ã‚ã‚‹é ‚ç‚¹**ã‹ã‚‰**è¾ºã§éš£æ¥ã—ãŸå…¨ã¦ã®é ‚ç‚¹**ã«**ãƒãƒƒãƒ—ã‚’1æšãšã¤**é…ã‚‹**
2. ã‚ã‚‹é ‚ç‚¹**ãŒ**è¾ºã§éš£æ¥ã—ãŸå…¨ã¦ã®é ‚ç‚¹**ã‹ã‚‰**ãƒãƒƒãƒ—ã‚’1æšãšã¤**è²°ã†**

ä¾‹ãˆã°ä¸Šè¨˜ä¾‹ã®å› å­ã«ãŠã„ã¦ $v_1$ ã‹ã‚‰å‘¨ã‚Šã«ãƒãƒƒãƒ—ã‚’é…ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªé…ç½®ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b79a7d605d07-20251121.png =200x)

ã•ã‚‰ã« $v_4$ ãŒå‘¨ã‚Šã‹ã‚‰ãƒãƒƒãƒ—ã‚’è²°ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªé…ç½®ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/70b09cea4211-20251121.png =200x)

ã‚²ãƒ¼ãƒ ã®å‹åˆ©æ¡ä»¶ã¯ã“ã‚Œã‚‰æ“ä½œã‚’ç¹°ã‚Šè¿”ã—ã¦**ã©ã®é ‚ç‚¹ã‚‚å€Ÿé‡‘ã®ãªã„çŠ¶æ…‹ã«ã™ã‚‹ã“ã¨**ã§ã™ï¼ˆ$\operatorname{Div}^0(G)$ ã®å› å­ã«é™ã‚Œã°å˜ä½å…ƒã«ãªã‚‹ã“ã¨ã¨ç­‰ã—ã„ï¼‰ã€‚ã™ã‚‹ã¨ä¸Šè¨˜ä¾‹ã®é…ç½®ã«ã¯å‹åˆ©çŠ¶æ…‹ã«ãªã‚‹ã‚ˆã†ãªå‹•ã‹ã—æ–¹ãŒå­˜åœ¨ã—ã¾ã™ï¼ˆç°¡å˜ãªã®ã§æ˜¯éã‚„ã£ã¦ã¿ã¦ãã ã•ã„ï¼‰ã€‚ä¸€æ–¹ã§ä»¥ä¸‹ã®é…ç½®ã§ã¯ã©ã®ã‚ˆã†ãªæˆ¦ç•¥ã‚’ã¨ã£ã¦ã‚‚å‹åˆ©çŠ¶æ…‹ã«ã¯ã§ãã¾ã›ã‚“ï¼ˆå¾Œã§è¨¼æ˜ã—ã¾ã™ï¼‰ã€‚

![](https://storage.googleapis.com/zenn-user-upload/87a9bdff8039-20251120.png =200x)

å› å­ã«ã‚ˆã£ã¦ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã‚’å‹åˆ©çŠ¶æ…‹ã«ã§ãã‚‹é…ç½®ã¨ã§ããªã„é…ç½®ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦**äº’ã„ã«ç§»ã‚Šå¤‰ã‚ã‚‹ã“ã¨ãŒã§ããªã„å› å­ãŒå­˜åœ¨ã™ã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã“ã®ã‚ˆã†ãªäº’ã„ã«ç•°ãªã‚‹å› å­ãŒæœ¬è³ªçš„ã«ã©ã‚Œã ã‘å­˜åœ¨ã™ã‚‹ã®ã‹ã‚’èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

å› å­ $D$ ã‚’ ${\mathbb Z}^n$ ã®å…ƒ $[D]$ ã¨ã—ã¦è€ƒãˆã‚‹ã¨ã€ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã¯ $[D]$ ã«ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ã„ãšã‚Œã‹ã®åˆ—ã‚’åŠ ãˆã‚‹ã€ã‚ã‚‹ã„ã¯å¼•ãã“ã¨ã¨åŒã˜ã§ã™ã€‚

ä¾‹ãˆã°æœ€åˆã®ä¾‹ã®å› å­ $D = 3v_1 - 3v_2 - v_3 + v_4$ ã«å¯¾å¿œã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã¯

$$
[D] = \begin{pmatrix}
3 \\
-3 \\
-1 \\
1
\end{pmatrix}
$$

ã¨ãªã‚Šã€å…ˆç¨‹ã®ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã¯

$$
L = \begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã®ãƒ™ã‚¯ãƒˆãƒ«ã«å¯¾ã—ã¦ $v_1$ ã‹ã‚‰å‘¨ã‚Šã«ãƒãƒƒãƒ—ã‚’é…ã‚‹ã“ã¨ã«ã‚ˆã‚‹å¤‰åŒ–ã¯

$$
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1
\end{pmatrix}
-
\begin{pmatrix}
2 \\
-1 \\
-1 \\
0
\end{pmatrix}
=
\begin{pmatrix}
1 \\
-2 \\
0 \\
1
\end{pmatrix}
$$

ã¨ãªã‚Šãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ç¬¬1åˆ—ã‚’å¼•ãã“ã¨ã«å¯¾å¿œã—ã¾ã™ã€‚ã•ã‚‰ã« $v_4$ ãŒå‘¨ã‚Šã‹ã‚‰ãƒãƒƒãƒ—ã‚’è²°ã†ã“ã¨ã«ã‚ˆã‚‹å¤‰åŒ–ã‚’è€ƒãˆã‚‹ã¨

$$
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1
\end{pmatrix}
-
\begin{pmatrix}
2 \\
-1 \\
-1 \\
0
\end{pmatrix}
+
\begin{pmatrix}
0 \\
-1 \\
-1 \\
2
\end{pmatrix}
=
\begin{pmatrix}
1 \\
-3 \\
-1 \\
3
\end{pmatrix}
$$

ã¨ãªã‚Šãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ç¬¬4åˆ—ã‚’åŠ ãˆã‚‹ã“ã¨ã«å¯¾å¿œã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¨ˆç®—ã¯ä¸Šè¨˜ã®ä¾‹ã«ãŠã‘ã‚‹é…ç½®ã®æ¨ç§»ã«å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã“ã‚Œã‚‰ã®è¨ˆç®—ã‚’ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã‚’ä½¿ã£ã¦ã¾ã¨ã‚ã¦æ›¸ãã¨

$$
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1
\end{pmatrix}
+
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\begin{pmatrix}
-1 \\
0 \\
0 \\
1
\end{pmatrix}
=
\begin{pmatrix}
1 \\
-3 \\
-1 \\
3
\end{pmatrix}
$$

ã¨æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚ã¤ã¾ã‚Šä¸€èˆ¬ã«å› å­ $D$ ã«å¯¾å¿œã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ« $[D]$ ã®ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ã‚ˆã‚‹å¤‰åŒ–ã¯ã‚ã‚‹æ•´æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ« $[f]$ ã‚’ä½¿ã£ã¦

$$
[D] + L[f]
$$

ã¨æ›¸ã‘ã‚‹ã®ã§ã™ã€‚ã“ã‚Œã¯ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ã‚ˆã‚‹å› å­ $D$ ã®å¤‰åŒ–ãŒã‚ã‚‹ $f\in{\mathcal M}(G)$ ã‚’ä½¿ã£ã¦

$$
D + \Delta(f)
$$

ã¨æ›¸ã‘ã‚‹ã¨ã„ã†ã“ã¨ã¨åŒã˜ã§ã™ã€‚

å› å­ $D$ ãŒå‹åˆ©çŠ¶æ…‹ã«ãªã‚Œã‚‹ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã®é…ç½®ã‹ã©ã†ã‹ã¯ã€$D$ ã‚’ã‚ã‚‰ã‚†ã‚‹ $f\in{\mathcal M}(G)$ ã®åƒ $\Delta(f) \in \operatorname{Prin}(G)$ ã‚’ä½¿ã£ã¦å‹•ã‹ã—ãŸå› å­ã®é›†åˆã«å‹åˆ©çŠ¶æ…‹ãŒå«ã¾ã‚Œã‚‹ã‹ã©ã†ã‹ã§æ±ºã¾ã‚Šã¾ã™ã€‚ã“ã® $\operatorname{Prin}(G)$ ã®å…ƒã®è¶³ã—å¼•ãã®é•ã„ã‚’é™¤ã„ã¦åŒã˜ã‚‚ã®ã¨ã¿ãªã—ãŸå› å­ã®é›†åˆã¯åŒå€¤é¡ã¨ãªã‚Š**å› å­é¡**ã¨å‘¼ã³ã¾ã™ã€‚ã“ã‚ŒãŒã¾ã•ã«å› å­é¡ç¾¤ $\operatorname{Div}(G)/\operatorname{Prin}(G)$ ã®å…ƒãªã®ã§ã™ã€‚ãã—ã¦ $\operatorname{Div}^0(G)$ ã®å› å­ã«é™ã£ã¦ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã‚’è€ƒãˆã‚Œã°ã€ã“ã‚Œã¯ $\operatorname{Div}^0(G)/\operatorname{Prin}(G)$ ã™ãªã‚ã¡ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ $\operatorname{Jac}(G)$ ã®å…ƒã¨ãªã‚Šã¾ã™ã€‚

ã‚°ãƒ©ãƒ•ã®ç¨®æ•° $g$ ã‚’ $g = |E(G)|-|V(G)|+1$ ã¨å®šç¾©ã™ã‚‹ã¨ã€å› å­ $D$ ã®æ¬¡æ•° $\operatorname{deg}(D)$ ãŒ $\operatorname{deg}(D)\geq g$ ã¨ãªã‚‹æ™‚ã¯å¿…ãšå‹åˆ©çŠ¶æ…‹ã«ãªã‚‹å‹•ã‹ã—æ–¹ãŒå­˜åœ¨ã—ã€åå¯¾ã« $\operatorname{deg}(D)\leq g-1$ ã¨ãªã‚‹å ´åˆã¯ã©ã®ã‚ˆã†ã«å‹•ã‹ã—ã¦ã‚‚å‹åˆ©çŠ¶æ…‹ã«ãªã‚Œãªã„å› å­ $D$ ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã®å‹åˆ©æ¡ä»¶ã«ã¤ã„ã¦æœ¬ç¨¿ã§ã¯ã“ã‚Œä»¥ä¸Šè§¦ã‚Œã¾ã›ã‚“ãŒã€èˆˆå‘³ã®ã‚ã‚‹äººã¯ä»¥ä¸‹ã®è«–æ–‡ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

https://arxiv.org/abs/math/0608360

## å˜å› å­è«–
ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ $\operatorname{Jac}(G)=\operatorname{Div}^0(G)/\operatorname{Prin}(G)$ ã®å…ƒã¯ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦äº’ã„ã«ç§»ã‚Šå¤‰ã‚ã‚‹æ¬¡æ•°0ã®å› å­ã®é›†åˆã ã¨ã„ã†ã“ã¨ã¯ã‚ã‹ã‚Šã¾ã—ãŸãŒã€å…·ä½“çš„ã«ã©ã‚“ãªå› å­ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã®ã‹ã‚‚æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚ãã“ã§å„å› å­é¡ã‹ã‚‰ä»£è¡¨å…ƒã‚’å–ã‚Šå‡ºã—ã¦çœºã‚ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ãã®ãŸã‚ã«ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã‚’ã‚‚ã†å°‘ã—æ‰±ã„ã‚„ã™ã„å½¢ã«å¤‰æ›ã—ã¾ã™ã€‚

$\operatorname{Div}^0(G)$ ã¯æ¬¡æ•°0ã®å› å­ãŒæˆã™ç¾¤ã§ã™ã€‚ã‚°ãƒ©ãƒ•ã®ç‰¹å®šã®é ‚ç‚¹$v$ã«æ³¨ç›®ã™ã‚‹ã¨ãã‚Œä»¥å¤–ã®ä¿‚æ•°ã‚’å‹æ‰‹ã«æ±ºã‚ã¦ã—ã¾ãˆã°ã€ $v$ ã®ä¿‚æ•°ã‚’ä»–ã®é ‚ç‚¹ã®ä¿‚æ•°ã®åˆè¨ˆã®è² ã®å€¤ã¨ã™ã‚‹ã“ã¨ã§æ¬¡æ•°ãŒ0ã¨ã„ã†æ¡ä»¶ã¯è‡ªå‹•çš„ã«æº€ãŸã•ã‚Œã¾ã™ã€‚ã“ã®å¯¾å¿œã‹ã‚‰ $\operatorname{Div}^0(G)\cong{\mathbb Z}^{n-1}$ ã¨ã„ã†åŒå‹ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ä¾‹ãˆã° $n=4$ ã¨ã—ã¦ $v_4$ ã«æ³¨ç›®ã™ã‚‹ã¨

$$
a_1v_1+a_2v_2+a_3v_3-(a_1+a_2+a_3)v_4
$$

ã¨

$$
\begin{pmatrix}
a_1 \\
a_2 \\
a_3
\end{pmatrix}
$$

ã®é–“ã«ä¸€å¯¾ä¸€ã®å¯¾å¿œãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ï¼ˆã‚‚ã¡ã‚ã‚“æ¼”ç®—ã‚‚ä¿ã¡ã¾ã™ï¼‰ã€‚

$\operatorname{Prin}(G)$ ã¯ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´  $\Delta$ ã®åƒãªã®ã§ã€æº–åŒå‹å®šç†ã‚ˆã‚Š

$$
\operatorname{Prin}(G)=\operatorname{Im}\Delta\cong{\mathcal M}(G)/\operatorname{Ker}\Delta
$$

ã¨ãªã‚Šã¾ã™ã€‚

$\operatorname{Ker}\Delta$ ã¯å®šæ•°é–¢æ•°å…¨ä½“ã§ã‚ã‚Šã€ç‰¹å®šã®é ‚ç‚¹$v$ã«æ³¨ç›®ã™ã‚‹ã¨ ${\mathcal M}(G)/\operatorname{Ker}\Delta$ ã¯

$$
\{f\in{\mathcal M}(G)| f(v)=0\}
$$

ã¨ã„ã† ${\mathcal M}(G)$ ã®éƒ¨åˆ†ç¾¤ã¨åŒå‹ã«ãªã‚Šã¾ã™ã€‚ãªãœãªã‚‰ $f\in{\mathcal M}(G)$ ã«å¯¾ã—ã¦ $f\mapsto f - f(v)\cdot 1$ ã¨ã„ã†æº–åŒå‹å†™åƒ $\phi: {\mathcal M}(G)\to{\mathcal M}(G)$ ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã®æº–åŒå‹å†™åƒã®æ ¸ $\operatorname{Ker}\phi$ ã‚‚ã¾ãŸå®šæ•°é–¢æ•°å…¨ä½“ã¨ãªã‚‹ãŸã‚ $\operatorname{Ker}\Delta$ ã«ä¸€è‡´ã—ã€æº–åŒå‹å®šç†ã‹ã‚‰

$$
{\mathcal M}(G)/\operatorname{Ker}\Delta={\mathcal M}(G)/\operatorname{Ker}\phi\cong\operatorname{Im}\phi=\{f\in{\mathcal M}(G)| f(v)=0\}
$$

ãŒå¾“ã†ã‹ã‚‰ã§ã™ã€‚ãã—ã¦ã€ã“ã®éƒ¨åˆ†ç¾¤ã¯é ‚ç‚¹ $v$ ä»¥å¤–ã®å€¤ã‚’ä¸¦ã¹ã‚‹ã¨ã„ã†å¯¾å¿œã§ ${\mathbb Z}^{n-1}$ ã¨åŒå‹ã«ãªã‚Šã¾ã™ã€‚

ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ ã¨ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã«ã¯ $[\Delta(f)]=L[f]$ ã¨ã„ã†é–¢ä¿‚ãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ä»¥ä¸‹ã®å›³å¼ãŒå¯æ›ã«ãªã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

$$
\begin{array}{ccc}
  {\mathcal M}(G) & \stackrel{\Delta}{\longrightarrow} & \operatorname{Div}(G) \\
  \ \ \downarrow {\small [\cdot]} & & \ \ \downarrow {\small [\cdot]} \\
  {\mathbb Z}^n & \stackrel{L}{\longrightarrow} & {\mathbb Z}^n
\end{array}
$$

åŒæ§˜ã«ã€é ‚ç‚¹ $v$ ã«æ³¨ç›®ã—ãŸã¨ãã® $\operatorname{Div}^0(G)$ ã¨ ${\mathcal M}(G)/\operatorname{Ker}\Delta$ ãã‚Œãã‚Œã‹ã‚‰ ${\mathbb Z}^{n-1}$ ã¸ã®åŒå‹å¯¾å¿œã‚’åŒã˜ $[\cdot]_v$ ã¨ã„ã†è¨˜å·ã§æ›¸ãã¨ã€

$$
\begin{array}{ccc}
  {\mathcal M}(G)/\operatorname{Ker}\Delta & \stackrel{\Delta}{\longrightarrow} & \operatorname{Div}^0(G) \\
  {\scriptsize\cong}\downarrow{\small[\cdot]_v} & & {\scriptsize\cong}\downarrow{\small[\cdot]_v} \\
  {\mathbb Z}^{n-1} & \stackrel{L_v}{\longrightarrow} & {\mathbb Z}^{n-1}
\end{array}
$$

ã¨ã„ã†å›³å¼ãŒå¯æ›ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§ $L_v$ ã¯ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã‹ã‚‰é ‚ç‚¹ $v$ ã«å¯¾å¿œã™ã‚‹è¡Œã¨åˆ—ã‚’é™¤ã„ãŸ$n-1$æ¬¡è¡Œåˆ—ã§ã™ã€‚$\operatorname{Prin}(G)$ ã¨ $\operatorname{Div}^0(G)$ ã¯å…±ã« ${\mathbb Z}^{n-1}$ ã¨åŒå‹ã§ã™ãŒé›†åˆã¨ã—ã¦ä¸€è‡´ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å…±ã« ${\mathbb Z}^{n-1}$ ã¨ã—ã¦è¦‹ãŸæ™‚ã«å‰è€…ãŒå¾Œè€…ã«ã©ã®ã‚ˆã†ãªå½¢ã§åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ã®æƒ…å ±ã‚’ $L_v$ ãŒæ¡ã£ã¦ã„ã‚‹ã®ã§ã™ã€‚

ä»¥ä¸Šã®å¯¾å¿œã‹ã‚‰ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã«å¯¾ã—ã¦

$$
\operatorname{Jac}(G)=\operatorname{Div}^0(G)/\operatorname{Prin}(G)\cong{\mathbb Z}^{n-1}/L_v{\mathbb Z}^{n-1}
$$

ã¨ã„ã†åŒå‹ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

ã‚°ãƒ©ãƒ•ã«ãŠã‘ã‚‹ ${\mathbb Z}^{n-1}/L_v{\mathbb Z}^{n-1}$ ã¨ã„ã†ç¾¤ã¯ã€ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ãŠã„ã¦é ‚ç‚¹ $v$ ã‚’ã‚·ãƒ³ã‚¯ã¨ã„ã†ç‰¹æ®Šãªé ‚ç‚¹ã¨å®šã‚ã€$v$ ã‹ã‚‰ãƒãƒƒãƒ—ãŒè²°ãˆã‚‹ã“ã¨ã‚‚ãªã„ã— $v$ ã«é…ã‚‰ã‚ŒãŸãƒãƒƒãƒ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨ã‚‚ãªã„ã¨ã—ãŸæ™‚ã®å®‰å®šé…ç½®ï¼ˆãã‚Œä»¥ä¸Šãƒãƒƒãƒ—ã‚’é…ã‚‹ã¨è² ã®æ•°ã«ãªã£ã¦ã—ã¾ã†é…ç½®ï¼‰ãŒå®šã‚ã‚‹ç¾¤ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ãªç¾¤ã¯**ç ‚å±±ç¾¤**ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚ç ‚å±±ç¾¤ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®[ã€Œä»£æ•°å­¦åŸºç¤ B è¬›ç¾©ãƒãƒ¼ãƒˆ (ç’°è«–)ã€](https://www.math.okayama-u.ac.jp/~mi/lecture/)ã«è©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§æ°—ã«ãªã‚‹äººã¯ã”å‚ç…§ãã ã•ã„ã€‚

${\mathbb Z}^{n-1}/L_v{\mathbb Z}^{n-1}$ ã¯ $L_v: {\mathbb Z}^{n-1}\to {\mathbb Z}^{n-1}$ ã®ä½™æ ¸ $\operatorname{Coker}L_v$ ã§ã™ã€‚ã“ã®ä½™æ ¸ã®æ§‹é€ ã‚’èª¿ã¹ã‚‹ã«ã¯æ¬¡ã®å®šç†ãŒæœ‰ç”¨ã§ã™ã€‚

> ã€å®šç†ã€‘
> $n$æ¬¡æ•´æ•°è¡Œåˆ— $A$ ã®å˜å› å­ã‚’ $d_1,\dots,d_r$ ã¨ã™ã‚‹ã¨
> ${\mathbb Z}^n/A{\mathbb Z}^n\cong{\mathbb Z}/d_1{\mathbb Z}\times\cdots\times{\mathbb Z}/d_r{\mathbb Z}\times{\mathbb Z}^{n-r}$
> ãŒæˆç«‹ã™ã‚‹

è¡Œåˆ— $A$ ã®**ã‚¹ãƒŸã‚¹æ¨™æº–å½¢**ã¨ã¯ã€

$$
\begin{pmatrix}
d_1 & \\
& d_2 \\
& & \ddots \\
& & & d_r \\
& & & & 0 \\
& & & & & \ddots \\
& & & & & & 0 \\
\end{pmatrix}
$$

ã¨ã„ã†å½¢ã®å¯¾è§’è¡Œåˆ— $S$ ã§ã€$d_{i-1}$ ãŒ $d_i$ ã‚’å‰²ã‚Šåˆ‡ã‚‹ $(2\leq i\leq r)$ ã¨ã„ã†æ€§è³ªã‚’æº€ãŸã—ã€ã‚ã‚‹å¯é€†ãªæ•´æ•°è¡Œåˆ—ï¼ˆãƒ¦ãƒ‹ãƒ¢ã‚¸ãƒ¥ãƒ©è¡Œåˆ—ï¼‰ $U,V$ ã«ã‚ˆã£ã¦ $A=USV$ ã¨ã„ã†é–¢ä¿‚ã‚’æº€ãŸã™ã‚ˆã†ãªè¡Œåˆ—ã§ã™ã€‚$d_1,\dots,d_r$ ã‚’è¡Œåˆ— $A$ ã®**å˜å› å­**ã¨å‘¼ã³ã¾ã™ã€‚ä»»æ„ã®æ•´æ•°è¡Œåˆ—ã«å¯¾ã—ã¦ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã¯å˜å› å­ã®å˜å…ƒå€ï¼ˆ$-1$å€ï¼‰ã‚’é™¤ã„ã¦ä¸€æ„ã«å­˜åœ¨ã™ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚æœ¬ç¨¿ã§ã¯å¿…è¦ãªã‚‰$-1$å€ã‚’è¡Œã£ã¦å˜å› å­ã¯å¸¸ã«0ä»¥ä¸Šã®æ•´æ•°ã¨ã—ã¾ã™ã€‚ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã‚„å˜å› å­ã®è©±ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚‚ã”å‚ç…§ãã ã•ã„ã€‚

https://zenn.dev/lotz/articles/93f73c17145819

**è¨¼æ˜**
è¡Œåˆ— $A$ ãŒã‚¹ãƒŸã‚¹æ¨™æº–å½¢ $S$ ã¨ãƒ¦ãƒ‹ãƒ¢ã‚¸ãƒ¥ãƒ©è¡Œåˆ— $U,V$ ã‚’ç”¨ã„ã¦ $A=USV$ ã¨è¡¨ã›ã‚‹ã¨ã™ã‚‹ã€‚

$$
{\mathbb Z}^n/A{\mathbb Z}^n={\mathbb Z}^n/USV{\mathbb Z}^n
$$

$V$ ãŒå¯é€†ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ $V{\mathbb Z}^n$ ã¨ ${\mathbb Z}^n$ ã¯åŒå‹ã§ã‚ã‚‹ã ã‘ã§ãªãé›†åˆã¨ã—ã¦ã‚‚ä¸€è‡´ã™ã‚‹ã®ã§

$$
{\mathbb Z}^n/USV{\mathbb Z}^n={\mathbb Z}^n/US{\mathbb Z}^n
$$

ã¾ãŸ $U$ ã¯å¯é€†ãªã®ã§ $U^{-1}$ ãŒåŒå‹å†™åƒã§ã‚ã‚‹ã“ã¨ã‚ˆã‚Š

$$
{\mathbb Z}^n/US{\mathbb Z}^n\cong U^{-1}{\mathbb Z}^n/U^{-1}US{\mathbb Z}^n = {\mathbb Z}^n/S{\mathbb Z}^n
$$

ã¨ãªã‚‹ã€‚

æˆåˆ†ã”ã¨ã«æ›¸ãè¡¨ã™ã¨

$$
{\mathbb Z}^n = {\mathbb Z}\times\cdots\times{\mathbb Z}
$$

ã§ã‚ã‚Š

$$
S{\mathbb Z}^n = (d_1)\times\cdots(d_r)\times(0)\times\cdots\times(0)
$$

ã§ã‚ã‚‹ã®ã§ï¼ˆã“ã“ã§ $(d)$ ã¯ $d$ ãŒç”Ÿæˆã™ã‚‹å˜é …ã‚¤ãƒ‡ã‚¢ãƒ«ï¼ˆ$d$ ã®å€æ•°å…¨ä½“ã®é›†åˆï¼‰ï¼‰ã€${\mathbb Z}^n/S{\mathbb Z}^n$ ã¯æˆåˆ†ã”ã¨ã®å•†ã®ç›´ç©

$$
{\mathbb Z}^n/S{\mathbb Z}^n \cong {\mathbb Z}/d_1{\mathbb Z}\times\cdots\times{\mathbb Z}/d_r{\mathbb Z}\times{\mathbb Z}^{n-r}
$$

ã¨åŒå‹ã«ãªã‚‹ã€‚

---

è¡Œåˆ—æœ¨ã®å®šç†ã‚ˆã‚Š $L_v$ ã®è¡Œåˆ—å¼ã®å€¤ã¯å…¨åŸŸæœ¨ã®å€‹æ•°ã¨ä¸€è‡´ã™ã‚‹ãŸã‚0ã§ãªã„ã“ã¨ã‹ã‚‰

$$
\begin{matrix}
\operatorname{det}(L_v)
&=&\operatorname{det}(USV) \\
&=&\operatorname{det}(U)\operatorname{det}(S)\operatorname{det}(V) \\
&=&\operatorname{det}(S)
\end{matrix}
$$


ã‚ˆã‚Š $L_v$ ã®ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ $S$ ã®å¯¾è§’æˆåˆ†ã«0ã¯ç¾ã‚Œã¾ã›ã‚“ï¼ˆ$U,V$ ã¯ãƒ¦ãƒ‹ãƒ¢ã‚¸ãƒ¥ãƒ©è¡Œåˆ—ãªã®ã§è¡Œåˆ—å¼ã¯ $\pm 1$ ã§ã‚ã‚‹ã“ã¨ã¨ã€å˜å› å­ã¯æ­£ã®æ•´æ•°ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ï¼‰ã€‚ãã®ãŸã‚ $L_v$ ã®å˜å› å­ã‚’ $d_1,\dots,d_{n-1}$ ã¨ã™ã‚Œã°

$$
{\mathbb Z}^{n-1}/L_v{\mathbb Z}^{n-1}\cong{\mathbb Z}/d_1{\mathbb Z}\times\cdots\times{\mathbb Z}/d_{n-1}{\mathbb Z}
$$

ã¨æ›¸ã‘ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä½æ•°ãŒæœ‰é™ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ã•ã‚‰ã«

$$
\operatorname{det}(L_v) = \operatorname{det}(S) = d_1\cdots d_{n-1}
$$

ã‚ˆã‚Šãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä½æ•°ãŒå…¨åŸŸæœ¨ã®å€‹æ•°ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã™ã€‚

ä»Šåº¦ã¯ã€ã“ã“ã¾ã§ã®åŒå‹å¯¾å¿œã‚’é€†ã«è¾¿ã£ã¦ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚æ³¨ç›®ã™ã‚‹é ‚ç‚¹ã‚’ $v_n$ ã¨ã—ã¾ã™ã€‚$d_1,\dots,d_{n-1}$ ã‚’ $L_{v_n}$ ã®å˜å› å­ã¨ã—ã¦ã€å„ $1\leq r\leq n-1$ ã«å¯¾ã—ã¦ $0$ ã‹ã‚‰ $d_r$ ã¾ã§ã®å€¤ $a_r$ ã‚’é¸ã³ã€

$$
\begin{pmatrix}
a_1+d_1{\mathbb Z}\\
\vdots\\
a_{n-1}+d_{n-1}{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}/d_1{\mathbb Z}\times\cdots\times{\mathbb Z}/d_{n-1}{\mathbb Z}
$$

ã‚’è€ƒãˆã¾ã™ã€‚ã“ã‚Œä»¥é™ã€åŒå€¤é¡ã‚’è¡¨ã™ãŸã‚ã« ${\mathbb Z}$ ã¨ã„ã†è¨˜å·ã‚’æ¿«ç”¨ã—ã¾ã™ãŒã€æœ€å¾Œã«ã¯ä»£è¡¨å…ƒã‚’å–ã‚‹ã®ã§ã€èª­ã¿ã«ãã„ã¨æ„Ÿã˜ãŸå ´åˆã¯ ${\mathbb Z}$ ã‚’å˜ã« $0$ ã¨ç½®ãæ›ãˆã¦èª­ã‚“ã§ã‚‚ã‚‰ãˆã‚Œã°å¤§ä¸ˆå¤«ã§ã™ã€‚${\mathbb Z}/d_1{\mathbb Z}\times\cdots\times{\mathbb Z}/d_{n-1}{\mathbb Z}\cong{\mathbb Z}^{n-1}/S{\mathbb Z}^{n-1}$ ã‚ˆã‚Šã“ã®å…ƒã¯

$$
\begin{pmatrix}
a_1\\
\vdots\\
a_{n-1}
\end{pmatrix}
+
\begin{pmatrix}
d_1 & \\
& \ddots & \\
& & d_{n-1}
\end{pmatrix}
\begin{pmatrix}
{\mathbb Z}\\
\vdots\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^{n-1}/S{\mathbb Z}^{n-1}
$$

ã«å¯¾å¿œã—ã¾ã™ã€‚ã“ã‚Œã¯å½“ç„¶

$$
\begin{pmatrix}
a_1\\
\vdots\\
a_{n-1}
\end{pmatrix}
+
U^{-1}U
\begin{pmatrix}
d_1 & \\
& \ddots & \\
& & d_{n-1}
\end{pmatrix}
\begin{pmatrix}
{\mathbb Z}\\
\vdots\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^{n-1}/S{\mathbb Z}^{n-1}
$$

ã¨åŒã˜ã§ã™ã€‚ã“ã®å…ƒã«å·¦ã‹ã‚‰ $U$ ã‚’æ›ã‘ã¦å¤‰æ›ã™ã‚‹ã¨

$$
U
\begin{pmatrix}
a_1\\
\vdots\\
a_{n-1}
\end{pmatrix}
+
U
\begin{pmatrix}
d_1 & \\
& \ddots & \\
& & d_{n-1}
\end{pmatrix}
\begin{pmatrix}
{\mathbb Z}\\
\vdots\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^{n-1}/US{\mathbb Z}^{n-1}
$$

ã¨ãªã‚Šã€ã•ã‚‰ã« $VV^{-1}$ ã‚’ã²ã­ã‚Šå‡ºã™ã¨

$$
U
\begin{pmatrix}
a_1\\
\vdots\\
a_{n-1}
\end{pmatrix}
+
U
\begin{pmatrix}
d_1 & \\
& \ddots & \\
& & d_{n-1}
\end{pmatrix}
V
\left(V^{-1}
\begin{pmatrix}
{\mathbb Z}\\
\vdots\\
{\mathbb Z}
\end{pmatrix}
\right)
\in
{\mathbb Z}^{n-1}/USVV^{-1}{\mathbb Z}^{n-1}
$$

ã¨ãªã‚Šã€ã“ã‚Œã¯

$$
U
\begin{pmatrix}
a_1\\
\vdots\\
a_{n-1}
\end{pmatrix}
+
L_{v_n}
\begin{pmatrix}
{\mathbb Z}\\
\vdots\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^{n-1}/L_{v_n}{\mathbb Z}^{n-1}
$$

ã«ä¸€è‡´ã™ã‚‹ãŸã‚ ${\mathbb Z}^{n-1}/L_{v_n}{\mathbb Z}^{n-1}$ ã®å…ƒãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ã‚ã¨ã¯ç¬¬ä¸€é …ã¨ç¬¬äºŒé …ã‚’ãã‚Œãã‚Œ $\operatorname{Div}^0(G)$ ã¨ $\operatorname{Prin}(G)$ ã®å› å­ã«ç¿»è¨³ã™ã‚Œã°ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã®å®Œæˆã§ã™ã€‚

ä¸Šè¨˜ã§è¦‹ãŸæ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã§å…·ä½“ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯

$$
L = \begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
$$

ã§ã—ãŸã€‚é ‚ç‚¹ $v_4$ ã«æ³¨ç›®ã™ã‚‹ã¨ $L_{v_4}$ ã¯

$$
L_{v_4} = \begin{pmatrix}
2 & -1 & -1 \\
-1 & 2 & 0 \\
-1 & 0 & 2
\end{pmatrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã®è¡Œåˆ—ã®ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ $S$ ã¯

$$
S = \begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 4
\end{pmatrix}
$$

ã¨ãªã‚Šã€ãƒ¦ãƒ‹ãƒ¢ã‚¸ãƒ¥ãƒ©è¡Œåˆ—

$$
U = \begin{pmatrix}
-1 & 0 & 0 \\
2 & 3 & 1 \\
0 & -1 & 0 \\
\end{pmatrix},\ 
V = \begin{pmatrix}
-2 & 1 & 1 \\
1 & 0 & -2 \\
0 & 0 & 1 \\
\end{pmatrix}
$$

ã«ã‚ˆã£ã¦ $L_v=USV$ ã¨ã„ã†é–¢ä¿‚ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã£ã¦ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¯

$$
\operatorname{Jac}(G) \cong {\mathbb Z}^3/L_v{\mathbb Z}^3 \cong {\mathbb Z}/1{\mathbb Z}\times{\mathbb Z}/1{\mathbb Z}\times{\mathbb Z}/4{\mathbb Z}\cong {\mathbb Z}/4{\mathbb Z}
$$

ã¨ãªã‚Š4æ¬¡ã®å·¡å›ç¾¤ã«åŒå‹ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

$L_v$ ã®å˜å› å­ã¯ $1, 1, 4$ ãªã®ã§ $0$ ã‹ã‚‰å˜å› å­æœªæº€ã¾ã§ã®å€¤ã‚’è¡¨ã™ $a_1, a_2, a_3$ ã¨ã„ã†å¤‰æ•°ã‚’ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚ã¨ã„ã£ã¦ã‚‚å˜å› å­1ã«å¯¾å¿œã™ã‚‹å¤‰æ•°ã¯å€¤ãŒ0ã—ã‹å–ã‚Œãªã„ã®ã§ $a_1=a_2=0$ ã§ã™ã€‚

$$
\begin{pmatrix}
0 + {\mathbb Z} \\
0 + {\mathbb Z} \\
a_3 + 4{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}/1{\mathbb Z}\times{\mathbb Z}/1{\mathbb Z}\times{\mathbb Z}/4{\mathbb Z}
$$

ã“ã®å…ƒã¯

$$
\begin{pmatrix}
0 \\
0 \\
a_3
\end{pmatrix}
+
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 4
\end{pmatrix}
\begin{pmatrix}
{\mathbb Z} \\
{\mathbb Z} \\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^3/S{\mathbb Z}^3
$$

ã«å¯¾å¿œã—ã¾ã™ã€‚ã•ã‚‰ã«å·¦ã‹ã‚‰ $U$ ã‚’æ›ã‘ã¦ $VV^{-1}$ ã‚’ã²ã­ã‚Šå‡ºã™ã¨

$$
\begin{pmatrix}
-1 & 0 & 0 \\
2 & 3 & 1 \\
0 & -1 & 0 \\
\end{pmatrix}
\begin{pmatrix}
0 \\
0 \\
a_3
\end{pmatrix}
+
L_{v_4}
V^{-1}
\begin{pmatrix}
{\mathbb Z}\\
{\mathbb Z}\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^3/L_{v_4}V^{-1}{\mathbb Z}^3
$$

ã¨ãªã‚Šã€è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{pmatrix}
0 \\
a_3 \\
0
\end{pmatrix}
+
L_{v_4}
\begin{pmatrix}
{\mathbb Z}\\
{\mathbb Z}\\
{\mathbb Z}
\end{pmatrix}
\in
{\mathbb Z}^3/L_{v_4}{\mathbb Z}^3
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å› å­ã«å¼•ãæˆ»ã™ã¨

$$
a_3v_2 - a_3v_4 + \Delta(f) \in\operatorname{Div}^0(G)/\operatorname{Prin}(G)
$$

ã¨ãªã‚Šã¾ã™ã€‚

ã‚ˆã£ã¦ä»£è¡¨å…ƒã¨ã—ã¦ã¯ $f=0, a_3\in\{0,1,2,3\}$ ã‚’è€ƒãˆã‚Œã°

$$
0, v_2-v_4, 2(v_2-v_4), 3(v_2-v_4)
$$

ã‚’å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å…ƒã®è¶³ã—å¼•ãã‚’è€ƒãˆã‚‹ã¨

$$
n(v_2-v_4)
$$

ã¨ã„ã†å½¢ã®å…ƒãŒå¾—ã‚‰ã‚Œã¾ã™ãŒã€$f$ ã¨ã—ã¦

$$
f(x) =
\begin{cases}
2,\ \ x = v_1 \\
3,\ \ x = v_2 \\
1,\ \ x = v_3 \\
0,\ \ x = v_4
\end{cases}
$$

ã¨ã„ã†é–¢æ•°ã‚’é¸ã¶ã¨

$$
\Delta(f) = 4v_2 - 4v_4
$$

ãŒä½œã‚Œã‚‹ã®ã§ $\operatorname{Prin}(G)$ ã®å·®ã‚’é™¤ã‘ã° $n=0,1,2,3$ ã®å ´åˆã«åã¾ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ä»¥ä¸Šã®è€ƒå¯Ÿã‹ã‚‰ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­ã‚’ã‚‚ã¨ã«æœ‰ç•Œãªç¯„å›²ã§æœ‰é™å€‹ã®æ•´æ•°ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

## $q$-ç°¡ç´„å› å­
ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã§ãã‚‹ã“ã¨ã¯ã‚ã‹ã‚Šã¾ã—ãŸãŒã€ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã‹ã‚‰å…¨åŸŸæœ¨ã«ã©ã®ã‚ˆã†ã«å¤‰æ›ã™ã‚Œã°ã„ã„ã‹ãŒã¾ã ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚å®Ÿã¯å‰ç« ã§è¦‹ãŸæ–¹æ³•ã¨ã¯åˆ¥ã«ã€ã‚°ãƒ©ãƒ•ã®ã„ãšã‚Œã‹ã®é ‚ç‚¹$q$ã«æ³¨ç›®ã™ã‚‹ã“ã¨ã§$q$**-ç°¡ç´„å› å­**ã¨å‘¼ã°ã‚Œã‚‹åˆ¥ã®ä»£è¡¨å…ƒã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã•ã‚‰ã«ä»»æ„ã®å› å­ã‚’åŒã˜å› å­é¡ã®$q$-ç°¡ç´„å› å­ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ã¨ã€$q$-ç°¡ç´„å› å­ã‚’å…¨åŸŸæœ¨ã«å¤‰æ›ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã™ã€‚ã“ã®ç« ã§ã¯$q$-ç°¡ç´„å› å­ã«ã¤ã„ã¦è©³ã—ãè¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

$q$-ç°¡ç´„å› å­ã¯é ‚ç‚¹$q$ã«ã¯è² æ•°ã‚’è¨±ã—ã€ãã‚Œä»¥å¤–ã®é ‚ç‚¹ã¯ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦ã‚®ãƒªã‚®ãƒªè² ã®æ•°ã«ãªã‚‰ãªã„å€¤ã‚’ä¿ã£ã¦ã„ã‚‹ã‚ˆã†ãªå› å­ã§ã™ã€‚

> **ã€$q$-ç°¡ç´„å› å­ã€‘**
> ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ $q \in V(G)$ ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®2ã¤ã®æ¡ä»¶ã‚’æº€ãŸã™å› å­ $D \in \operatorname{Div}(G)$ ã‚’ $q$-ç°¡ç´„å› å­ã¨å‘¼ã¶
> 1. ä»»æ„ã®é ‚ç‚¹ $v \in V(G)\setminus\{q\}$ ã«å¯¾ã—ã¦ $D(v)\geq 0$
> 2. ä»»æ„ã®éç©ºãªé ‚ç‚¹ã®éƒ¨åˆ†é›†åˆ $A\subseteq V(G)\setminus\{q\}$ ã«å¯¾ã—ã¦ã€ã‚ã‚‹é ‚ç‚¹ $v\in A$ ãŒå­˜åœ¨ã— $D(v) < \operatorname{outdeg}_A(v)$ ãŒæˆã‚Šç«‹ã¤

ã“ã“ã§ $\operatorname{outdeg}_A(v)$ ã¯ç‰‡æ–¹ã‚’é ‚ç‚¹ $v$ ã€ã‚‚ã†ç‰‡æ–¹ã‚’ $V(G)\setminus A$ ã®é ‚ç‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹è¾ºã®æ•°ã‚’è¡¨ã—ã¾ã™ã€‚2ç•ªç›®ã®æ¡ä»¶ã¯$A$ã«å«ã¾ã‚Œã‚‹å…¨ã¦ã®é ‚ç‚¹ã‹ã‚‰ãƒãƒƒãƒ—ã‚’é…ã‚‹ã¨ $D(v)<0$ ã¨ãªã‚‹ã‚ˆã†ãªé ‚ç‚¹$v$ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

å„å› å­é¡ã«ã¯$q$-ç°¡ç´„å› å­ãŒå­˜åœ¨ã—ã¦ä¸€æ„ã«å®šã¾ã‚Šã¾ã™ã€‚ã“ã“ã‹ã‚‰ã¯$q$-ç°¡ç´„å› å­ã®å­˜åœ¨æ€§ã¨ä¸€æ„æ€§ã‚’è¨¼æ˜ã—ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®è¨¼æ˜ã¯ä¸‹è¨˜è«–æ–‡ã‚’å‚è€ƒã«ã—ã¦ã„ã‚‹ãŸã‚ Theorem ã‚„ Proposition ã®é€šç•ªã‚‚ã“ã¡ã‚‰ã®è«–æ–‡ã¨åŒã˜ã‚‚ã®ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã“ã®è«–æ–‡ã®å†…å®¹ã¯ä»Šå¾Œã‚‚é »ç¹ã«å¼•ç”¨ã™ã‚‹ã®ã§å‚ç…§ã™ã‚‹éš›ã¯ [[Baker and Shokrieh 2013]](https://www.sciencedirect.com/science/article/pii/S0097316512001355) ã¨è¨˜ã™ã“ã¨ã«ã—ã¾ã™ã€‚

https://arxiv.org/abs/1107.1313

### å­˜åœ¨æ€§
å› å­ $D, E$ ãŒåŒã˜å› å­é¡ã«å±ã™ã‚‹ã“ã¨ã€ã™ãªã‚ã¡ $D - E \in\operatorname{Prin}(G)$ ã¨ãªã‚‹ã“ã¨ã‚’ $D$ ã¨ $E$ ã¯**ç·šå½¢åŒå€¤**ã§ã‚ã‚‹ã¨è¨€ã„ $D\sim E$ ã¨è¡¨ã—ã¾ã™ã€‚$D$ ã¨ç·šå½¢åŒå€¤ã§ã‚ã£ã¦é ‚ç‚¹ $q$ ã‚’é™¤ã„ã¦ãã®ä¿‚æ•°ãŒ0ä»¥ä¸Šã«ãªã‚‹å› å­ã®é›†åˆã‚’ $|D|_q$ ã§è¡¨ã—ã¾ã™ã€‚

$$
|D|_q = \left\{ E \mid E \sim D, E(v)\geq 0\text{ for all }v \neq q\right\}
$$

$D\sim E$ ã§ã‚ã‚Œã° $|D|_q = |E|_q$ ã¨ãªã‚‹ã®ã§ $|D|_q$ ã¯å„å› å­é¡ã«å¯¾ã—ã¦ä¸€æ„ã«å®šã¾ã‚‹é›†åˆã§ã™ã€‚

$|D|_q$ ã¯ç©ºé›†åˆã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚æ„Ÿè¦šçš„ã«ã¯é ‚ç‚¹ $q$ ã«å¿…è¦ãªã ã‘è² ã®æ•°ã‚’æŠ¼ã—ä»˜ã‘ã‚Œã°ãã‚Œä»¥å¤–ã®é ‚ç‚¹ã‚’æ­£ã®æ•°ã«ã§ãã‚‹ã‹ã‚‰ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚é ‚ç‚¹ $q$ ã‚’å…ˆé ­ã«ã€ãã®ä»–ã®é ‚ç‚¹ã¯éš£æ¥é ‚ç‚¹ãŒè‡ªåˆ†ã‚ˆã‚Šå‰ã«æ¥ã‚‹ã‚ˆã†ã«ä¸€åˆ—ã«é ‚ç‚¹ã‚’ä¸¦ã¹ã‚‹ã¨ã—ã¾ã—ã‚‡ã†ã€‚ä¾‹ãˆã° $q$ ã‚’æ ¹ã¨ã™ã‚‹å…¨åŸŸæœ¨ã‚’ä½œã‚Š $q$ ã‹ã‚‰ã®è·é›¢ã«åŸºã¥ã„ã¦ä¸¦ã¹ã‚Œã°ãã®ã‚ˆã†ãªæ•´åˆ—ãŒå¯èƒ½ã§ã™ã€‚ãã—ã¦æœ€å¾Œã®é ‚ç‚¹ã‹ã‚‰é †ç•ªã«ã€ãã®é ‚ç‚¹ã®å€¤ãŒæ­£ã«ãªã‚‹ã¾ã§è‡ªåˆ†ã‚ˆã‚Šå‰ã«ã‚ã‚‹éš£æ¥é ‚ç‚¹ã‹ã‚‰ãƒãƒƒãƒ—ã‚’è²°ã„ã¾ã™ã€‚ã“ã‚Œã‚’ $q$ ã®æ¬¡ã®é ‚ç‚¹ã¾ã§ç¹°ã‚Šè¿”ã›ã° $q$ ä»¥å¤–ã®é ‚ç‚¹ã®ä¿‚æ•°ã‚’0ä»¥ä¸Šã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å› å­ã®é›†åˆã‚’èª¿ã¹ã‚‹ãŸã‚ã«$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ $\operatorname{\mathcal E}_q$ ã¨ã„ã†é–¢æ•°ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã¯è¡Œåˆ—å¼ãŒ0ãªã®ã§é€†è¡Œåˆ—ã‚’æŒã¡ã¾ã›ã‚“ãŒã€ä»£ã‚ã‚Šã«[ãƒ ãƒ¼ã‚¢ãƒ»ãƒšãƒ³ãƒ­ãƒ¼ã‚ºã®æ“¬ä¼¼é€†è¡Œåˆ—](https://ja.wikipedia.org/wiki/%E3%83%A0%E3%83%BC%E3%82%A2%E3%83%BB%E3%83%9A%E3%83%B3%E3%83%AD%E3%83%BC%E3%82%BA%E9%80%86%E8%A1%8C%E5%88%97) $L^{+}$ ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã®æ“¬ä¼¼é€†è¡Œåˆ—ã¯ $LL^{+}L=L$ ã¨ã„ã†æ€§è³ªã‚’æº€ãŸã—ã¾ã™ã€‚ãŸã ã— $L^{+}$ ã®è¦ç´ ã¯æ•´æ•°ã¨ã¯é™ã‚‰ãšä¸€èˆ¬ã«ã¯æœ‰ç†æ•°ã¨ãªã‚Šã¾ã™ã€‚ã“ã®æ“¬ä¼¼é€†è¡Œåˆ— $L^{+}$ ã‚’ç”¨ã„ã¦**ã‚¨ãƒãƒ«ã‚®ãƒ¼å¯¾** $\langle\cdot, \cdot\rangle:\operatorname{Div}(G)\times\operatorname{Div}(G)\to\mathbb{Q}$ ã‚’ä»¥ä¸‹ã®ã‚ˆã†ãªåŒç·šå‹å½¢å¼ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚

$$
\langle D, E\rangle = [D]^{\sf T}L^{+}[E]
$$

ãã—ã¦ã“ã®åŒç·šå‹å½¢å¼ã‚’ç”¨ã„ã¦$q$**-ã‚¨ãƒãƒ«ã‚®ãƒ¼** $\operatorname{\mathcal E}_q: \operatorname{Div}(G) \to \mathbb{Q}$ ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™[^4]ã€‚

$$
\operatorname{\mathcal E}_q(D) = \langle D - \operatorname{deg}(D)q, D - \operatorname{deg}(D)q\rangle
$$

ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ãŒåŠæ­£å®šå€¤è¡Œåˆ—ãªã®ã§æ“¬ä¼¼é€†è¡Œåˆ— $L^{+}$ ã‚‚åŠæ­£å®šå€¤è¡Œåˆ—ã¨ãªã‚Šã€ $\operatorname{\mathcal E}_q(D)$ ã¯0ä»¥ä¸Šã®å€¤ã‚’å–ã‚Šã¾ã™ã€‚ã¾ãŸ $L^{+}$ ã®è¦ç´ ã¯æœ‰ç†æ•°ã§ã™ãŒã€ãã®åˆ†æ¯ã®æœ€å°å…¬å€æ•°ã‚’ $M$ ã¨ç½®ãã¨ $M\cdot\operatorname{\mathcal E}_q(D)$ ã¯æ•´æ•°å€¤ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®äº‹å®Ÿã‹ã‚‰ï¼ˆæ•´åˆ—åŸç†ã«ã‚ˆã‚Šï¼‰ $|D|_q$ ã®ä¸­ã«$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æœ€ã‚‚å°ã•ãã™ã‚‹ã‚ˆã†ãªå› å­ $D'$ ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã¤ã¾ã‚Š $D'$ ã¯ä»»æ„ã® $D''\in|D|_q$ ã«å¯¾ã—ã¦ $\operatorname{\mathcal E}_q(D')\leq\operatorname{\mathcal E}_q(D'')$ ã¨ãªã‚‹ã‚ˆã†ãªå› å­ã§ã™ã€‚å®Ÿã¯ã“ã® $D'$ ãŒæ¢ã—ã¦ã„ã‚‹ $q$-ç°¡ç´„å› å­ãªã®ã§ã™ã€‚ã¾ãšã¯$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ€§è³ªã‚’ã„ãã¤ã‹ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

> **ã€Proposition 4.1 (a)ã€‘**
> å› å­ $E,D\in\operatorname{Div}(G)$ ã¨ $f\in\operatorname{\mathcal M}(G)$ ã«ã¤ã„ã¦ $E=D+\Delta(f)$ ã¨è¡¨ã›ã‚‹ãªã‚‰
> $\operatorname{\mathcal E}_q(E) = \operatorname{\mathcal E}_q(D)+\displaystyle\sum_{v\in V(G)}(D+E)(v)\cdot f(v)-2\operatorname{deg}(E)\cdot f(q)$

**è¨¼æ˜**
$E$ ã¨ $D$ ã¯ç·šå½¢åŒå€¤ãªã®ã§æ¬¡æ•°ãŒç­‰ã—ãã€ã“ã‚Œã‚’ $d=\operatorname{deg}(E)=\operatorname{deg}(D)$ ã¨ç½®ãã€‚

$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å®šç¾©ã‚ˆã‚Š

$$
\begin{matrix}
\operatorname{\mathcal E}_q(E)
&=& \langle D+\Delta(f)-d\cdot q, D+\Delta(f)-d\cdot q\rangle \\
&=& \langle D-d\cdot q, D-d\cdot q\rangle + 2\langle D-d\cdot q, \Delta(f)\rangle + \langle \Delta(f), \Delta(f)\rangle \\
&=& \operatorname{\mathcal E}_q(D) + 2\langle D-d\cdot q, \Delta(f)\rangle + \langle \Delta(f), \Delta(f)\rangle \\
\end{matrix}
$$

ã“ã“ã§

$$
\begin{matrix}
\langle D+E-2d\cdot q, \Delta(f)\rangle
&=& \langle 2D+\Delta(f)-2d\cdot q, \Delta(f)\rangle \\
&=& 2\langle D-d\cdot q, \Delta(f)\rangle + \langle \Delta(f), \Delta(f)\rangle \\
\end{matrix}
$$

ã‚ˆã‚Š

$$
\begin{matrix}
\operatorname{\mathcal E}_q(E)
&=& \operatorname{\mathcal E}_q(D) + \langle D+E-2d\cdot q, \Delta(f)\rangle \\
&=& \operatorname{\mathcal E}_q(D) + [D+E-2d\cdot q]^{\sf T}L^{+}[\Delta(f)] \\
&=& \operatorname{\mathcal E}_q(D) + [D+E-2d\cdot q]^{\sf T}L^{+}L[f] \\
\end{matrix}
$$

å®Ÿã¯æœ‰ç†æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ« $[g]$ ã‚’ä½¿ãˆã° $[D+E-2d\cdot q] = L[g]$ ã¨è¡¨ã›ã‚‹ã®ã§[^5]ã€

$$
\begin{matrix}
\operatorname{\mathcal E}_q(E)
&=& \operatorname{\mathcal E}_q(D) + (L[g])^{\sf T}L^{+}L[f] \\
&=& \operatorname{\mathcal E}_q(D) + [g]^{\sf T}L^{\sf T}L^{+}L[f] \\
&=& \operatorname{\mathcal E}_q(D) + [g]^{\sf T}LL^{+}L[f] \\
&=& \operatorname{\mathcal E}_q(D) + [g]^{\sf T}L[f] \\
&=& \operatorname{\mathcal E}_q(D) + (L[g])^{\sf T}[f] \\
&=& \operatorname{\mathcal E}_q(D) + [D+E-2d\cdot q]^{\sf T}[f] \\
&=& \operatorname{\mathcal E}_q(D) + \displaystyle\sum_{v\in V(G)}(D+E)(v)\cdot f(v)-2d\cdot f(q)
\end{matrix}
$$

ã¨ãªã‚Šé¡Œæ„ãŒç¤ºã•ã‚ŒãŸã€‚

---

é ‚ç‚¹é›†åˆ $A \subseteq V(G)$ ã«å¯¾ã—ã¦ã€ã‚ã‚‹æ•´æ•°å€¤é–¢æ•° ${\chi_A\in\mathcal M}(G)$ ã§ $v\in A$ ãªã‚‰ $\chi_A(v)=1$ã€$v\not\in A$ ãªã‚‰ $\chi_A(v)=0$ ã‚’æº€ãŸã™ã‚‚ã®ã‚’ $A$ ã®**ç‰¹æ€§é–¢æ•°**ã¨å‘¼ã³ã¾ã™ã€‚$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ç‰¹æ€§é–¢æ•°ã«ã¤ã„ã¦æ¬¡ã®æ€§è³ªãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚

> **ã€Proposition 4.1 (b) å‰åŠã€‘**
> $E,D\in\operatorname{Div}(G)$, $A\subseteq V(G)\setminus \{q\}$ ã«ã¤ã„ã¦ $E=D-\Delta(\chi_A)$ ã§ã‚ã‚‹ã¨ã
> $\operatorname{\mathcal E}_q(E) = \operatorname{\mathcal E}_q(D) - \displaystyle\sum_{v\in A}(D+E)(v)$

**è¨¼æ˜**
Proposition 4.1 (a) ã«ãŠã„ã¦ $f = -\chi_A$ ã¨ç½®ãã¨ç›´ã¡ã«å¾“ã†ã€‚

---

å› å­ $E$ ãŒé ‚ç‚¹é›†åˆ $A$ ã«å«ã¾ã‚Œã‚‹ä»»æ„ã®é ‚ç‚¹ $v\in A$ ã«ã¤ã„ã¦ $E(v)\geq 0$ ã§ã‚ã‚‹ã¨ã $E$ ã¯ $A$ ã«ãŠã„ã¦**æœ‰åŠ¹**ã§ã‚ã‚‹ã¨è¨€ã„ã¾ã™ã€‚ã“ã‚Œã‚’è¸ã¾ãˆã¦$q$-ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«ã¤ã„ã¦ä»¥ä¸‹ã®æ€§è³ªãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚

> **ã€Proposition 4.1 (b) å¾ŒåŠã€‘**
> $E,D\in\operatorname{Div}(G)$, $A\subseteq V(G)\setminus \{q\}$ ã«ã¤ã„ã¦ $E=D-\Delta(\chi_A)$ ã§ã‚ã‚Šã€$E$ ãŒ $A$ ã«ãŠã„ã¦æœ‰åŠ¹ã§ã‚ã‚‹ã¨ã
> $\operatorname{\mathcal E}_q(E)\leq\operatorname{\mathcal E}_q(D) - \lambda(A)$

ã“ã“ã§ $\lambda(A)$ ã¯ç‰‡æ–¹ãŒ $A$ ã®é ‚ç‚¹ã«ã€ã‚‚ã†ç‰‡æ–¹ãŒ $V(G)\setminus A$ ã®é ‚ç‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹è¾ºã®æ•°ã‚’è¡¨ã—ã¾ã™ï¼ˆã™ãªã‚ã¡ã‚°ãƒ©ãƒ•ã®ã‚«ãƒƒãƒˆ$(A, V(G)\setminus A)$ã®ã‚µã‚¤ã‚ºã§ã™ï¼‰ã€‚å®šç¾©ã‚ˆã‚Š $\lambda(A) = \sum_{v\in A}\operatorname{outdeg}_A(v)$ ã¨ãªã‚Šã¾ã™ã€‚

**è¨¼æ˜**
$v\in A$ ã«ãŠã„ã¦ $E(v)\geq 0 \iff D(v) \geq \Delta_v(\chi_A)$ ã§ã‚ã‚Š $\Delta_v(\chi_A)=\operatorname{outdeg}_A(v)$ ã§ã‚ã‚‹ã€‚Proposition 4.1 (b) å‰åŠã‚ˆã‚Š

$$
\begin{matrix}
\operatorname{\mathcal E}_q(E)
&=& \operatorname{\mathcal E}_q(D) - \displaystyle\sum_{v\in A}(D+E)(v) \\
&\leq& \operatorname{\mathcal E}_q(D) - \displaystyle\sum_{v\in A}D(v) \\
&\leq& \operatorname{\mathcal E}_q(D) - \displaystyle\sum_{v\in A}\operatorname{outdeg}_A(v) \\
&=& \operatorname{\mathcal E}_q(D) - \lambda(A)
\end{matrix}
$$

ã¨ãªã‚Šé¡Œæ„ãŒç¤ºã•ã‚ŒãŸã€‚

---

ä»¥ä¸Šã‹ã‚‰ $|D|_q$ ã®è¦ç´ ã§ $\operatorname{\mathcal E}_q(D)$ ã®æœ€å°å€¤ã‚’ä¸ãˆã‚‹ã‚ˆã†ãªå› å­ $D'$ ãŒ $q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã“ã¨ãŒè¨¼æ˜ã§ãã¾ã™ã€‚ã‚‚ã— $D'$ ãŒ $q$-ç°¡ç´„å› å­ã§ãªã„ã¨ä»®å®šã™ã‚‹ã¨å®šç¾©ã‚ˆã‚Šã€ã‚ã‚‹éç©ºãªé ‚ç‚¹é›†åˆ $A$ ã§ãƒãƒƒãƒ—ã®ç™ºå°„ã‚’è¡Œã£ãŸã¨ã—ã¦ã‚‚ï¼ˆã™ãªã‚ã¡ $D'-\Delta(\chi_A)$ ï¼‰ã¾ãŸ $|D|_q$ ã®è¦ç´ ã¨ãªã‚Šã¾ã™ã€‚ã—ã‹ã— $A$ ãŒéç©ºãªã‚‰ã‚°ãƒ©ãƒ•ã®é€£çµæ€§ã‚ˆã‚Š $\lambda(A)\geq 1$ ã§ã‚ã‚Šã€Proposition 4.1 (b) å¾ŒåŠã‚ˆã‚Š $\operatorname{\mathcal E}_q(D'-\Delta(\chi_A)) < \operatorname{\mathcal E}_q(D')$ ãŒæˆã‚Šç«‹ã¤ã®ã§ã€$D'$ ã®æœ€å°æ€§ã«çŸ›ç›¾ã—ã¾ã™ã€‚ã‚ˆã£ã¦ $D'$ ãŒ $q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã“ã¨ãŒç¤ºã›ã¾ã—ãŸã€‚

### ä¸€æ„æ€§
å› å­é¡ã®ä¸­ã«$q$-ç°¡ç´„å› å­ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã¯åˆ†ã‹ã‚Šã¾ã—ãŸãŒã€ä»Šåº¦ã¯ãã‚ŒãŒå”¯ä¸€ã¤ã«å®šã¾ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã—ã‚‡ã†ã€‚

> **ã€Lemma 3.7ã€‘**
> $f\in{\mathcal M}(G)$ ã«å¯¾ã—ã¦ $A_{\rm max}\subseteq V(G)$ ã‚’ $f$ ã®æœ€å¤§å€¤ã‚’ä¸ãˆã‚‹é ‚ç‚¹ã®é›†åˆã¨ã™ã‚‹ã€‚åŒæ§˜ã« $A_{\rm min}\subseteq V(G)$ ã‚’ $f$ ã®æœ€å°å€¤ã‚’ä¸ãˆã‚‹é ‚ç‚¹ã®é›†åˆã¨ã™ã‚‹ã€‚ã“ã®æ™‚ã€ä»¥ä¸‹ãŒæˆç«‹ã™ã‚‹ã€‚
> (a) $\forall v\in A_{\rm max}, \Delta_v(f) \geq \operatorname{outdeg}_{A_{\rm max}}(v)$
> (b) $\forall v\in A_{\rm min}, \Delta_v(f) \leq \operatorname{outdeg}_{A_{\rm min}}(v)$

**è¨¼æ˜**
(a) $v\in A_{\rm max}$ ã¨æ¥ç¶šã™ã‚‹è¾º $e$, $\phi(e)=\{v,w\}$ ã«ã¤ã„ã¦ã€ã‚‚ã— $w\in A_{\rm max}$ ãªã‚‰ $f(v)=f(w)$ ã§ã‚ã‚Šã€ã‚‚ã— $w\not\in A_{\rm max}$ ãªã‚‰ $f(v)-f(w)\geq 1$ ã§ã‚ã‚‹ã€‚å®šç¾© $\Delta_v(f) = \sum_{\{v,w\}\in E(G)}(f(v)-f(w))$ ã‚ˆã‚Š $\Delta_v(f) \geq \operatorname{outdeg}_{A_{\rm max}}(v)$ ãŒå¾“ã†ã€‚
(b) ã«ã¤ã„ã¦ã¯ $f$ ã‚’ $-f$ ã¨ç½®ãæ›ãˆã‚Œã° (a) ã‚ˆã‚Šæ˜ã‚‰ã‹ã€‚

---

> **ã€Lemma 4.11ã€‘ï¼ˆæœ€å°ä½œç”¨ã®åŸç†ï¼‰**
> $D$ ã‚’$q$-ç°¡ç´„å› å­ã¨ã— $D$ ã¨åŒå€¤ãªå› å­ $E$ ãŒ $D=E+\Delta(f)$ ã¨è¡¨ã•ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹ã€‚ã“ã®æ™‚
> (a) $E\in|D|_q$ ãªã‚‰ $\forall v\in V(G), f(v)\leq f(q)$
> (b) $E+\Delta(g)\in|D|_q$ ãªã‚‰ $\forall v\in V(G), f(v) - f(q) \leq g(v) - g(q)$

**è¨¼æ˜**
(a) ã‚‚ã— $f(q)$ ãŒæœ€å¤§å€¤ã§ãªã„ã¨ä»®å®šã™ã‚‹ã¨ã€$A_{\rm max}\subseteq V(G)\setminus \{q\}$ ã§ã‚ã‚Šã€Lemma 3.7 (a) ã‚ˆã‚Š $A_{\rm max}$ ã®ã™ã¹ã¦ã®é ‚ç‚¹ã«å¯¾ã—ã¦ $\Delta_v(f) \geq \operatorname{outdeg}_{A_{\rm max}}(v)$ ãŒæˆã‚Šç«‹ã¤ã€‚$D$ ã¯ $q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã®ã§ã€ã‚ã‚‹é ‚ç‚¹ $u\in A_{\rm max}$ ãŒå­˜åœ¨ã—ã¦ $D(u) < \operatorname{outdeg}_{A_{\rm max}}(u)$ ã§ã‚ã‚‹ã€‚ã—ã‹ã— $E(u) = D(u)-\Delta(f) < 0$ ã‚ˆã‚Š $E\in|D|_q$ ã¨ã„ã†ä»®å®šã«çŸ›ç›¾ã™ã‚‹ã€‚ã‚ˆã£ã¦ $f$ ã¯ $q$ ã§æœ€å¤§å€¤ã‚’ã¨ã‚‹ã€‚
(b) $E'=E+\Delta(g)$ ã¨ç½®ãã¨ $D=E'+\Delta(f-g)$ ã€‚ (a) ã‚ˆã‚Š $(f-g)(v) \leq (f-g)(q)$ ã¨ãªã‚‹ã®ã§å¼ã‚’æ•´ç†ã™ã‚Œã°é¡Œæ„ãŒç¤ºã•ã‚Œã‚‹ã€‚

---

ã‚‚ã—2ã¤ã®ç·šå½¢åŒå€¤ãª$q$-ç°¡ç´„å› å­ $D, D'$ ãŒå¾—ã‚‰ã‚ŒãŸã¨ã—ã¾ã—ã‚‡ã†ã€‚$D=D'+\Delta(f)$ ã¨æ›¸ã‘ã¾ã™ãŒ $f(q)=0$ ã¨ä»®å®šã—ã¦ã‚‚ä¸€èˆ¬æ€§ã‚’å¤±ã„ã¾ã›ã‚“ã€‚ãªãœãªã‚‰å®šæ•°é–¢æ•°ã¯ $\Delta$ ã®æ ¸ã«å…¥ã‚‹ã®ã§ä¸€èˆ¬ã« $D=D'+\Delta(f')$ ã¨æ›¸ã‘ãŸã¨ã—ã¦ $f=f'-f'(q)\cdot 1$ ã¨ç½®ã‘ã°ï¼ˆ$1$ã¯å¸¸ã«å€¤ãŒ1ã¨ãªã‚‹å®šæ•°é–¢æ•°ï¼‰

$$
\begin{matrix}
D
&=& E+\Delta(f') \\
&=& E+\Delta(f+f'(q)\cdot 1) \\
&=& E+\Delta(f)+\Delta(f'(q)\cdot 1) \\
&=& E+\Delta(f) \\
\end{matrix}
$$

ã¨ã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚ã™ã‚‹ã¨Lemma 4.11 (a) ã‚ˆã‚Š $\forall v\in V(G),f(v) \leq 0$ ã¨ãªã‚Šã¾ã™ã€‚ã¾ãŸ $D'=D-\Delta(f)$ ã¨æ›¸ã‘ã‚‹ãŸã‚ã€åŒæ§˜ã®è­°è«–ã«ã‚ˆã‚Š $\forall v\in V(G),-f(v) \leq 0$ ã¨ãªã‚Šã¾ã™ã€‚ã‚ˆã£ã¦ $\forall v\in V(G),f(v)=0$ ã¨ãªã‚Š $D=D'$ ãŒç¤ºã›ã¾ã—ãŸã€‚

## Dhar ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
å„å› å­é¡ã«$q$-ç°¡ç´„å› å­ãŒä¸€æ„ã«å­˜åœ¨ã™ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã®ã§å®‰å¿ƒã—ã¦æ¢ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯å®Ÿéš›ã«$q$-ç°¡ç´„å› å­ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚

ä¸ãˆã‚‰ã‚ŒãŸå› å­ $D$ ãŒ$q$-ç°¡ç´„å› å­ã‹ã©ã†ã‹ã‚’å®šç¾©é€šã‚Šã«åˆ¤å®šã—ã‚ˆã†ã¨ã™ã‚‹ã¨$q$ã‚’é™¤ãé ‚ç‚¹é›†åˆã®éƒ¨åˆ†é›†åˆã‚’å…¨ã¦èª¿ã¹ã‚‹ã“ã¨ã«ãªã‚Šè¨ˆç®—é‡ãŒæŒ‡æ•°é–¢æ•°çš„ã«å¢—ãˆã¦ã—ã¾ã„ã¾ã™ã€‚é ‚ç‚¹ $v$ ãŒã‚ã‚‹éƒ¨åˆ†é›†åˆ $A$ ã«ãŠã„ã¦ $D(v) < \operatorname{outdeg}_A(v)$ ãŒæˆã‚Šç«‹ã¤ã¨åˆ†ã‹ã‚Œã°ã€ãã®é ‚ç‚¹ã¯ $A$ ã® $v$ ã‚’å«ã‚€ä»»æ„ã®éƒ¨åˆ†é›†åˆ $A'$ ã«ãŠã„ã¦ã‚‚ $D(v) < \operatorname{outdeg}_{A'}(v)$ ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ãªãœãªã‚‰ $\operatorname{outdeg}_{A}(v)$ ã¯ $v$ ã¨ $V(G)\setminus A$ ã®é–“ã®è¾ºã®æ•°ã‚’æ•°ãˆã¦ã„ã‚‹ã®ã§ã€éƒ¨åˆ†é›†åˆã‚’ã¨ã‚‹æ“ä½œã«ã‚ˆã£ã¦è¾ºã®æ•°ãŒå¢—ãˆã‚‹ã“ã¨ã¯ã‚ã£ã¦ã‚‚æ¸›ã‚‹ã“ã¨ã¯ãªã„ã®ã§ $\operatorname{outdeg}_A(v)\leq\operatorname{outdeg}_{A'}(v)$ ãŒæˆã‚Šç«‹ã¤ã‹ã‚‰ã§ã™ã€‚ã“ã®æ€§è³ªã‚’ç”¨ã„ã¦ã€æ¡ä»¶ã‚’æº€ãŸã™é ‚ç‚¹ã‚’é †ã«å–ã‚Šé™¤ã„ã¦ã„ãè²ªæ¬²æ³•ã«ã‚ˆã£ã¦$q$-ç°¡ç´„å› å­ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯**Dhar ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ã¨å‘¼ã°ã‚Œã¦ãŠã‚Šã€è¨ˆç®—é‡ã‚’ $O(n^2)$ ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…·ä½“çš„ãªDhar ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

> **ã€Dhar ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€‘**
> å…¥åŠ›: å› å­ $D\in\operatorname{Div}(G)$ ã¨é ‚ç‚¹ $q\in V(G)$
> å‡ºåŠ›: TRUE/FALSEï¼ˆ$D$ ãŒ$q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã‹å¦ã‹ï¼‰
> 1. ã‚ã‚‹é ‚ç‚¹ $v\in V(G)\setminus\{q\}$ ã«ãŠã„ã¦ $D(v)<0$ ãªã‚‰ FALSE ã‚’å‡ºåŠ›ã—ã¦åœæ­¢ã™ã‚‹
> 2. $A_0 = V(G), v_{(0)} = q$ ã¨ç½®ã
> 3. $i=1,\dots,n-1$ã¾ã§ä»¥ä¸‹ã‚’ç¹°ã‚Šè¿”ã™
>     1. $A_i =A_{i-1}\setminus \{v_{(i-1)}\}$ ã¨ç½®ã
>     2. ã‚‚ã—å…¨ã¦ã® $v\in A_i$ ã«ã¤ã„ã¦ $D(v)\geq\operatorname{outdeg}_{A_i}(v)$ ãªã‚‰ FALSE ã‚’å‡ºåŠ›ã—ã¦åœæ­¢ã™ã‚‹
>     3. ãã†ã§ãªã‘ã‚Œã° $v_{(i)}$ ã‚’ $D(v_{(i)}) < \operatorname{outdeg}_{A_i}(v_{(i)})$ ã‚’æº€ãŸã™ä»»æ„ã®é ‚ç‚¹ã¨ç½®ã
> 4. TRUE ã‚’å‡ºåŠ›ã—ã¦åœæ­¢ã™ã‚‹

ã“ã®Dhar ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä¿®æ­£ã™ã‚Œã°ã€ä¸ãˆã‚‰ã‚ŒãŸå› å­ã«åŒå€¤ãª$q$-ç°¡ç´„å› å­ã‚’æ§‹æˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å…ˆè¿°ã®æ“¬ä¼¼é€†è¡Œåˆ— $L^+$ ãŒæº€ãŸã™æ€§è³ªã¨ã—ã¦ $LL^+L=L$ ã‚’æŒ™ã’ã¾ã—ãŸãŒã€é€†ã«ã“ã®æ€§è³ªã‚’æº€ãŸã™è¡Œåˆ—ã¯**ä¸€èˆ¬åŒ–é€†è¡Œåˆ—**ã¨å‘¼ã°ã‚Œã¾ã™[^6]ã€‚ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$ ã«ãŠã„ã¦æ“¬ä¼¼é€†è¡Œåˆ—ã§ã¯ãªã„ã‘ã‚Œã©ä¸€èˆ¬åŒ–é€†è¡Œåˆ—ã§ã‚ã‚‹ã‚ˆã†ãªè¡Œåˆ—ã®ä¾‹ã¨ã—ã¦ $L_{(i)}$ ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ $L$ ã® $i$ è¡Œã¨ $i$ åˆ—ã‚’é™¤ã„ãŸ $n-1$ æ¬¡ã®è¡Œåˆ— $L_i$ ã®é€†è¡Œåˆ— $L_i^{-1}$ ã‚’è¨ˆç®—ã—ã€ $L_i^{-1}$ ã® $i-1$ è¡Œã®å¾Œã«è¦ç´ ãŒå…¨ã¦0ã®è¡Œãƒ™ã‚¯ãƒˆãƒ«ã‚’æŒ¿å…¥ã— $i-1$ åˆ—ã®å¾Œã‚ã«è¦ç´ ãŒå…¨ã¦0ã®åˆ—ãƒ™ã‚¯ãƒˆãƒ«ã‚’æŒ¿å…¥ã—ã¦å¾—ã‚‰ã‚Œã‚‹è¡Œåˆ—ã§ã™ã€‚å®Ÿéš› $LL_{(i)}$ ã‚’è¨ˆç®—ã™ã‚‹ã¨ $LL_{(i)} = I - R_{(i)}$ ã¨ãªã‚Šï¼ˆã“ã“ã§ $R_{(i)}$ ã¯ $i$ è¡Œã®è¦ç´ ãŒ $-1$ ã§ä»–ã¯ $0$ ã§ã‚ã‚‹è¡Œåˆ—ï¼‰ã€$LL_{(i)}L = L$ ã¨ãªã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ä¸ãˆã‚‰ã‚ŒãŸå› å­ $D$ ã«å¯¾ã—ã¦ $[D] - L\lfloor L_{(q)}[D]\rfloor$ ã‚’è¨ˆç®—ã™ã‚‹ã¨ $D$ ã¨ç·šå½¢åŒå€¤ã§ä¿‚æ•°ã®ã‚ˆã‚Šå°ã•ã„å› å­ $D'$ ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ã“ã“ã§ $\lfloor\cdot\rfloor$ ã¯ãƒ™ã‚¯ãƒˆãƒ«ã®å„è¦ç´ ã®å°æ•°ã‚’åˆ‡ã‚Šè½ã¨ã—æ•´æ•°ã«ä¸¸ã‚ã‚‹è¨˜å·ã§ã™ã€‚æ¬¡ã« $D'(v) < 0$ ã¨ãªã‚‹ $q$ ä»¥å¤–ã®é ‚ç‚¹ $v$ ãŒç„¡ããªã‚‹ã‚ˆã†ã«ãƒãƒƒãƒ—ã‚’è²°ã£ã¦èª¿æ•´ã—ã¾ã™ã€‚æœ€å¾Œã« $D'(v)<\operatorname{outdeg}_A(v)$ ã¨ãªã‚‹ $q$ ä»¥å¤–ã®é ‚ç‚¹ $v$ ãŒç¾ã‚Œã‚‹ã‚ˆã†ã«å„é ‚ç‚¹ã‹ã‚‰ãƒãƒƒãƒ—ã‚’é…ã£ã¦èª¿æ•´ã™ã‚‹ã“ã¨ã§ã€æœ€åˆã®å› å­ $D$ ã«ç·šå½¢åŒå€¤ãª$q$-ç°¡ç´„å› å­ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…·ä½“çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

> **ã€Algorithm 4ã€‘**
> å…¥åŠ›: ã‚°ãƒ©ãƒ• $G$ ã®å› å­ $D\in\operatorname{Div}(G)$ ã¨é ‚ç‚¹ $q\in V(G)$ ã¨ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ— $L$
> å‡ºåŠ›: $D$ ã¨ç·šå½¢åŒå€¤ãª$q$-ç°¡ç´„å› å­
> 1. $L$ ã®ä¸€èˆ¬åŒ–é€†è¡Œåˆ— $L_{(q)}$ ã‚’ç”¨ã„ã¦ $[D'] = [D] - L\lfloor L_{(q)}[D]\rfloor$ ã‚’è¨ˆç®—ã™ã‚‹
> 2. $D'(v)<0$ ã¨ãªã‚‹é ‚ç‚¹ $v\in V(G)\setminus\{q\}$ ãŒå­˜åœ¨ã™ã‚‹é™ã‚Šä»¥ä¸‹ã®ç½®ãæ›ãˆã‚’ç¹°ã‚Šè¿”ã™
>     1. $[D'] \leftarrow [D']+L[\chi_{\{v\}}]$ ã¨ç½®ãæ›ãˆã‚‹
> 3. $A_0=V(G),v_{(0)}=q,i=1$ ã¨ç½®ã
> 4. $i\leq n-1$ ã®é–“ã€ä»¥ä¸‹ã®å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã™
>     1. $A_i = A_{i-1}\setminus \{v_{(i-1)}\}$ ã¨ç½®ã
>     2. ã‚‚ã— $D'(v_{(i)})<\operatorname{outdeg}_{A_i}(v_{(i)})$ ã¨ãªã‚‹ $v_{(i)}\in A_i$ ãŒè¦‹ã¤ã‹ã‚Œã° $i\leftarrow i+1$ ã¨æ›´æ–°ã™ã‚‹
>     3. ãã†ã§ãªã‘ã‚Œã° $[D']\leftarrow [D']-L[\chi_{A_i}]$ ã¨æ›´æ–°ã—ã¦ $i=1$ ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹
> 5. $D'$ ã‚’å‡ºåŠ›ã—ã¦åœæ­¢ã™ã‚‹

ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒåŠ¹ç‡çš„ã§ã‚ã‚Šã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒåœæ­¢ã—ã¦$q$-ç°¡ç´„å› å­ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã®è¨¼æ˜ãŒ [[Baker and Shokrieh 2013]](https://www.sciencedirect.com/science/article/pii/S0097316512001355) ã«è¼‰ã£ã¦ã„ã¾ã™ã€‚

ä¾‹ã¨ã—ã¦å…ˆè¿°ã®ä¾‹ã«æŒ™ã’ãŸå› å­ã‚’ Algorithm 4 ã‚’ä½¿ã£ã¦$q$-ç°¡ç´„å› å­ã«å¤‰æ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã«ãŠã‘ã‚‹

$$
3v_1 - 3v_2 - v_3 + v_4
$$

ã¨ã„ã†å› å­ $D$ ã‚’è€ƒãˆã¾ã™ã€‚é…ç½®ã‚’å›³ç¤ºã™ã‚‹ã¨

![](https://storage.googleapis.com/zenn-user-upload/25f3c9658483-20251121.png =200x)

ã§ã—ãŸã€‚ã“ã®ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã¯

$$
L = \begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
$$

ã§ã™ã€‚$q$ ã¨ã—ã¦ $v_4$ ã‚’æ¡ç”¨ã—ã¾ã—ã‚‡ã†ã€‚ã¤ã¾ã‚Š$v_4$-ç°¡ç´„å› å­ã‚’è¨ˆç®—ã—ã¾ã™ã€‚å®šç¾©ã‚ˆã‚Š

$$
L_{(q)} = \frac{1}{4}\begin{pmatrix}
4 & 2 & 2 & 0 \\
2 & 3 & 1 & 0 \\
2 & 1 & 3 & 0 \\
0 & 0 & 0 & 0 \\
\end{pmatrix}
$$

ã¨ãªã‚‹ã®ã§ $[D']=[D]-L\lfloor L_{(q)}[D]\rfloor$ ã¨è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{matrix}
[D'] &=&
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\left\lfloor
\frac{1}{4}\begin{pmatrix}
4 & 2 & 2 & 0 \\
2 & 3 & 1 & 0 \\
2 & 1 & 3 & 0 \\
0 & 0 & 0 & 0 \\
\end{pmatrix}
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1 \\
\end{pmatrix}
\right\rfloor \\

&=&
\begin{pmatrix}
3 \\
-3 \\
-1 \\
1 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
-1 \\
0 \\
0 \\
\end{pmatrix} \\

&=&
\begin{pmatrix}
0 \\
0 \\
0 \\
0 \\
\end{pmatrix} \\
\end{matrix}
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã®æ™‚ç‚¹ã§æ˜ã‚‰ã‹ã«$v_4$-ç°¡ç´„å› å­ã§ã™ã€‚$D$ ãŒå˜ä½å…ƒã¨ç·šå½¢åŒå€¤ã§ã‚ã‚Šãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã«ãŠã„ã¦å‹åˆ©çŠ¶æ…‹ã¨ãªã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã—ãŸã­ã€‚

ç°¡å˜ã ã£ãŸã®ã§åˆ¥ã®ä¾‹ã‚‚è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»Šåº¦ã¯å‹åˆ©çŠ¶æ…‹ãŒç„¡ã„ã¨è¨€ã£ã¦ã„ãŸã“ã¡ã‚‰ã®é…ç½®ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/87a9bdff8039-20251120.png =200x)

å› å­ã«æ›¸ãç›´ã™ã¨

$$
v_1 + 2v_2 + v_3 - 4v_4
$$

ã¨ãªã‚Šã¾ã™ã€‚ã¾ãš $[D']=[D]-L\lfloor L_{(q)}[D]\rfloor$ ã‚’è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{matrix}
[D'] &=&
\begin{pmatrix}
1 \\
2 \\
1 \\
-4 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\left\lfloor
\frac{1}{4}\begin{pmatrix}
4 & 2 & 2 & 0 \\
2 & 3 & 1 & 0 \\
2 & 1 & 3 & 0 \\
0 & 0 & 0 & 0 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
2 \\
1 \\
-4 \\
\end{pmatrix}
\right\rfloor \\

&=&
\begin{pmatrix}
1 \\
2 \\
1 \\
-4 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\left\lfloor
\begin{pmatrix}
2.5 \\
2.25 \\
1.75 \\
0 \\
\end{pmatrix}
\right\rfloor \\

&=&
\begin{pmatrix}
1 \\
2 \\
1 \\
-4 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\begin{pmatrix}
2 \\
2 \\
1 \\
0 \\
\end{pmatrix} \\

&=&
\begin{pmatrix}
1 \\
2 \\
1 \\
-4 \\
\end{pmatrix}
-
\begin{pmatrix}
1 \\
2 \\
0 \\
-3 \\
\end{pmatrix} \\

&=&
\begin{pmatrix}
0 \\
0 \\
1 \\
-1 \\
\end{pmatrix} \\
\end{matrix}
$$

ã“ã‚Œã¯ã©ã†ã§ã—ã‚‡ã†ã€‚$v_4$ ä»¥å¤–ã« $D'(v)<0$ ã¨ãªã‚‹é ‚ç‚¹ã¯å­˜åœ¨ã—ãªã„ã®ã§æ‰‹é †2ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚

- $A_0=\{v_1, v_2, v_3, v_4\}, v_{(0)}=v_4, i=1$ ã¨ç½®ãã¾ã™
- $A_1=A_0\setminus\{v_{(0)}\}=\{v_1, v_2, v_3\}$ ã§ã™ã€‚ã“ã®æ™‚ $D'(v_2)=0<\operatorname{outdeg}_{A_1}(v_2)=1$ ã¨ãªã‚‹ã®ã§ $v_{(1)}=v_2$ ã¨ç½®ãã€$i=2$ ã«é€²ã¿ã¾ã™
- $A_2=A_1\setminus\{v_{(1)}\}=\{v_1, v_3\}$ ã§ã™ã€‚ã“ã®æ™‚ $D'(v_1)=0<\operatorname{outdeg}_{A_2}(v_1)=1$ ã¨ãªã‚‹ã®ã§ $v_{(2)}=v_1$ ã¨ç½®ãã€$i=3$ ã«é€²ã¿ã¾ã™
- $A_3=A_2\setminus\{v_{(2)}\}=\{v_3\}$ ã§ã™ã€‚ã“ã®æ™‚ $D'(v_3)=1<\operatorname{outdeg}_{A_3}(v_3)=2$ ã¨ãªã‚‹ã®ã§ $v_{(3)}=v_3$ ã¨ç½®ãã€$i=4$ ã«é€²ã¿ã¾ã™
- $i = 4 > 4 - 1$ ã¨ãªã‚‹ã®ã§ $[D']$ ã‚’å‡ºåŠ›ã—ã¾ã™

çµå±€ $[D']$ ã¯æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ãªããã®ã¾ã¾$v_4$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã¾ãŸ$v_4$-ç°¡ç´„å› å­ãŒç•°ãªã‚‹ã“ã¨ã‹ã‚‰å‹åˆ©çŠ¶æ…‹ã¨ç·šå½¢åŒå€¤ã§ã¯ãªã„ã®ã§ã“ã®å› å­ã¯ãƒãƒƒãƒ—ç™ºå°„ã‚²ãƒ¼ãƒ ã§å‹åˆ©ã§ããªã„é…ç½®ã§ã‚ã‚‹ã“ã¨ã‚‚è¨¼æ˜ã§ãã¾ã—ãŸã€‚

æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã«ãŠã‘ã‚‹æ¬¡æ•°0ã®$v_4$-ç°¡ç´„å› å­ã¯å…¨éƒ¨ã§ä»¥ä¸‹ã®4ã¤ã§ã™ã€‚

$$
D_0=\begin{pmatrix}
0\\
0\\
0\\
0\\
\end{pmatrix},
D_1=\begin{pmatrix}
1\\
0\\
0\\
-1\\
\end{pmatrix},
D_2=\begin{pmatrix}
0\\
1\\
0\\
-1\\
\end{pmatrix},
D_3=\begin{pmatrix}
0\\
0\\
1\\
-1\\
\end{pmatrix}
$$

ã“ã‚Œã‚‰ã¯ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ $\operatorname{Jac}(G)=\operatorname{Div}^0(G)/\operatorname{Prin}(G)$ ã®å› å­é¡ã®ä»£è¡¨å…ƒã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€ç¾¤ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚$D_0$ ã¯æ˜ã‚‰ã‹ã«å˜ä½å…ƒã§ã™ã€‚$D_1 + D_2$ ã‚’è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

$$
D_1 + D_2 = \begin{pmatrix}
1\\
1\\
0\\
-2\\
\end{pmatrix}
$$

ã“ã‚Œã‚’ Algorithm 4 ã‚’ä½¿ã£ã¦$v_4$-ç°¡ç´„å› å­ã«å¤‰æ›ã—ã¾ã™ã€‚ã¾ãš $[D']=[D]-L\lfloor L_{(q)}[D]\rfloor$ ã‚’è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{matrix}
[D'] &=&
\begin{pmatrix}
1 \\
1 \\
0 \\
-2 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\left\lfloor
\frac{1}{4}\begin{pmatrix}
4 & 2 & 2 & 0 \\
2 & 3 & 1 & 0 \\
2 & 1 & 3 & 0 \\
0 & 0 & 0 & 0 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
1 \\
0 \\
-2 \\
\end{pmatrix}
\right\rfloor \\

&=&
\begin{pmatrix}
1 \\
1 \\
0 \\
-2 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\left\lfloor
\begin{pmatrix}
1.5 \\
1.25 \\
0.75 \\
0 \\
\end{pmatrix}
\right\rfloor \\

&=&
\begin{pmatrix}
1 \\
1 \\
0 \\
-2 \\
\end{pmatrix}
-
\begin{pmatrix}
2 & -1 & -1 & 0 \\
-1 & 2 & 0 & -1 \\
-1 & 0 & 2 & -1 \\
0 & -1 & -1 & 2 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
1 \\
0 \\
0 \\
\end{pmatrix} \\

&=&
\begin{pmatrix}
1 \\
1 \\
0 \\
-2 \\
\end{pmatrix}
-
\begin{pmatrix}
1 \\
1 \\
-1 \\
-1 \\
\end{pmatrix} \\

&=&
\begin{pmatrix}
0 \\
0 \\
1 \\
-1 \\
\end{pmatrix} \\
\end{matrix}
$$

ã¨ãªã‚Šã“ã‚Œã¯ $D_3$ ã«ãªã‚Šã¾ã™ï¼ˆã‚ˆãè¦‹ã‚‹ã¨ $[D']\leftarrow[D']-L[\chi_{\{v_1,v_2\}}]$ ã‚’è¨ˆç®—ã—ã¦ã„ã¾ã™ã­ï¼‰ã€‚

åŒæ§˜ã«è¨ˆç®—ã—ã¦ã„ãã¨ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ãŒå‡ºæ¥ä¸ŠãŒã‚Šã€ã¡ã‚ƒã‚“ã¨ç¾¤ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ $D_2$ ã‚ã‚‹ã„ã¯ $D_3$ ã‚’ç”Ÿæˆå…ƒã¨ã™ã‚‹4æ¬¡ã®å·¡å›ç¾¤ã§ã™ã­ã€‚

![](https://storage.googleapis.com/zenn-user-upload/eb3c94bd4e2b-20251126.png =300x)

ä»¥å‰ã«

$$
0, v_2-v_4, 2(v_2-v_4), 3(v_2-v_4)
$$

ãŒã€ã¾ãŸåˆ¥ã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’è¦‹ã¾ã—ãŸãŒã€$v_2-v_4$ ãŒ $D_2$ ã«å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã“ã‚Œã‚‰ã¨ç·šå½¢åŒå€¤ãª$q$-ç°¡ç´„å› å­ã¯é †ã«

$$
D_0, D_2, D_1, D_3
$$

ã¨å¯¾å¿œã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

## $q$-ç°¡ç´„å› å­ã‹ã‚‰å…¨åŸŸæœ¨ã¸
ã„ã‚ˆã„ã‚ˆ$q$-ç°¡ç´„å› å­ã‹ã‚‰å…¨åŸŸæœ¨ã¸ã®å¯¾å¿œã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚$q$-ç°¡ç´„å› å­ $D$ ã«ãŠã„ã¦é ‚ç‚¹$q$ã‹ã‚‰é †ç•ªã«æ¥ç¶šã—ãŸè¾ºã‚’æ¶ˆã—ã¦ã„ãã€ä¸åº¦ $D(v)$ ã¨åŒã˜æ•°ã®è¾ºãŒæ¶ˆãˆãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãã®è¾ºã‚’è¨˜éŒ²ã—é ‚ç‚¹ $v$ ã‹ã‚‰æ¬¡ã®é ‚ç‚¹ã¸ã¨é€²ã‚“ã§ã„ãã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã®è¨˜éŒ²ã•ã‚ŒãŸè¾ºãŒå…¨åŸŸæœ¨ã«å¯¾å¿œã—ã¾ã™ã€‚ä¸€åº¦åˆ°é”ã—ãŸé ‚ç‚¹ã‚’å†ã³è¨ªå•ã™ã‚‹ã“ã¨ã¯ãªã„ã®ã§æ¡ä»¶ã‚’æº€ãŸã™è¾ºã‚’1æœ¬ãšã¤è¨˜éŒ²ã™ã‚Œã°æœ¨ã«ãªã‚‹ã®ã§ã™ã€‚ã•ã‚‰ã« $D$ ãŒ$q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã“ã¨ãŒã“ã®æ“ä½œã«ã‚ˆã‚Šå…¨é ‚ç‚¹ã«åˆ°é”ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯Dharã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ãŠã„ã¦é ‚ç‚¹ã”ã¨æ¶ˆã™ã®ã§ã¯ãªãè¾ºã‚’ä¸€ã¤ä¸€ã¤æ¶ˆã—ã¦ã„ãå½¢ã«ä¿®æ­£ã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[[Baker and Shokrieh 2013]](https://www.sciencedirect.com/science/article/pii/S0097316512001355) ã«ã‚ˆã‚‹å…·ä½“çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

> **ã€Algorithm 2ã€‘**
> å…¥åŠ›: ã‚°ãƒ©ãƒ• $G$ ã®é ‚ç‚¹é›†åˆ $V(G)$ ã¨è¾ºé›†åˆ $E(G)$ ã¨é ‚ç‚¹ $q\in V(G)$ ã¨$q$-ç°¡ç´„å› å­ $D\in\operatorname{Div}(G)$
> å‡ºåŠ›: ã‚°ãƒ©ãƒ• $G$ ã®å…¨åŸŸæœ¨ï¼ˆã‚’æ§‹æˆã™ã‚‹è¾ºã®é›†åˆï¼‰
> 1. $X = \{q\},R=\emptyset,T=\emptyset$ ã¨ç½®ã
> 2. $X\neq V(G)$ ã®é–“ã€ä»¥ä¸‹ã‚’ç¹°ã‚Šè¿”ã™
>     1. $e'=\min\{e\in E(G)|e\not\in R, \phi(e)=\{s,t\},s\in X, t\not\in X\}$ ã¨ç½®ãï¼ˆè¾ºé›†åˆã«ã¯ã‚ã‚‰ã‹ã˜ã‚é †åºã‚’å®šã‚ã¦ãŠãï¼‰
>     2. $v\in V(G)\setminus X$ ã‚’ $e'$ ã«éš£æ¥ã™ã‚‹é ‚ç‚¹ã¨ã™ã‚‹
>     3. ã‚‚ã— $D(v)$ ãŒ$R$ ã«å«ã¾ã‚Œã‚‹ $v$ ã¨æ¥ç¶šã—ãŸè¾ºã®æ•°ã«ç­‰ã—ã‘ã‚Œã°ä»¥ä¸‹ã®é€šã‚Šæ›´æ–°ã™ã‚‹
>         1. $X\leftarrow X\cup\{v\}$
>         2. $T\leftarrow T\cup\{e'\}$
>     4. $R\leftarrow R\cup\{e'\}$
> 3. $T$ ã‚’å‡ºåŠ›ã™ã‚‹

ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã¯åå¯¾ã«å…¨åŸŸæœ¨ã‹ã‚‰$q$-ç°¡ç´„å› å­ã‚’æ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆAlgorithm 3ï¼‰ã‚‚çŸ¥ã‚‰ã‚Œã¦ãŠã‚Šä¸Šè¨˜ã®Algorithm 2ã¨åˆã‚ã›ã¦ã€$q$-ç°¡ç´„å› å­ã¨å…¨åŸŸæœ¨ã®é–“ã«ã¯å…¨å˜å°„ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã®å…¨å˜å°„ã¯ **Coriâ€“Le Borgne bijection** ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚Coriâ€“Le Borgne bijection ã«ã¤ã„ã¦ã¯ ["The Mathematics of Chip-Firing"](https://www.dam.brown.edu/people/cklivans/chipfiring.html) ã«ã‚‚è¶…å®‰å®šé…ç½®ï¼ˆ$q$-ç°¡ç´„å› å­ã«å¯¾å¿œã™ã‚‹ï¼‰ã¨å…¨åŸŸæœ¨ã¨ã®å…¨å˜å°„ã¨ã—ã¦åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå…¨åŸŸæœ¨ã®é›†åˆã¨1å¯¾1ã«å¯¾å¿œã™ã‚‹å› å­é¡ã®ä»£è¡¨å…ƒã¨ã—ã¦ã¯ä»–ã«ã‚‚ãƒ–ãƒ¬ã‚¤ã‚¯å› å­ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ $\operatorname{Div}^g(G)$ ã«ãŠã‘ã‚‹å› å­é¡ã®ä»£è¡¨å…ƒã§ã™[^7]ã€‚

å®Ÿéš›ã« Algorithm 2 ã«ã‚ˆã£ã¦å…¨åŸŸæœ¨ã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã¨è¾ºã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šã‚$v_4$-ç°¡ç´„å› å­ã§ã‚ã‚‹ $D_2$ ã«å¯¾å¿œã™ã‚‹å…¨åŸŸæœ¨ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/78c6c0a48901-20251129.png =200x)

Algorithm 2 ã‚’ä»¥ä¸‹ã®é€šã‚Šå®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚

1. $X=\{v_4\},R=\emptyset,T=\emptyset$
    1. $e' = e_3$
    2. $v = v_2$
    3. $D(v_2)=1$ ã§ã‚ã‚Š $R$ ã¯ç©ºé›†åˆãªã®ã§æ¡ä»¶ã‚’æº€ãŸã•ãªã„
    4. $R\leftarrow R\cup\{e_3\}$
2. $X=\{v_4\},R=\{e_3\},T=\emptyset$
    1. $e' = e_4$
    2. $v = v_3$
    3. $D(v_3)=0$ ã§ã‚ã‚Š $R$ ã«å«ã¾ã‚Œã‚‹ $v_3$ ã¨æ¥ç¶šã™ã‚‹è¾ºã¯0å€‹ãªã®ã§æ¡ä»¶ã‚’æº€ãŸã™
    4. $X\leftarrow X\cup\{v_3\}$
    5. $T\leftarrow T\cup\{e_4\}$
    6. $R\leftarrow R\cup\{e_4\}$
3. $X=\{v_3,v_4\},R=\{e_3,e_4\},T=\{e_4\}$
    1. $e'=e_2$
    2. $v=v_1$
    3. $D(v_1)=0$ ã§ã‚ã‚Š $R$ ã«å«ã¾ã‚Œã‚‹ $v_1$ ã¨æ¥ç¶šã™ã‚‹è¾ºã¯0å€‹ãªã®ã§æ¡ä»¶ã‚’æº€ãŸã™
    4. $X\leftarrow X\cup\{v_1\}$
    5. $T\leftarrow T\cup\{e_2\}$
    6. $R\leftarrow R\cup\{e_2\}$
4. $X=\{v_1,v_3,v_4\},R=\{e_2,e_3,e_4\},T=\{e_2,e_4\}$
    1. $e'=e_1$
    2. $v=v_2$
    3. $D(v_2)=1$ ã§ã‚ã‚Š $R$ ã«å«ã¾ã‚Œã‚‹ $v_2$ ã¨æ¥ç¶šã™ã‚‹è¾ºã¯1å€‹ãªã®ã§æ¡ä»¶ã‚’æº€ãŸã™
    4. $X\leftarrow X\cup\{v_2\}$
    5. $T\leftarrow T\cup\{e_1\}$
    6. $R\leftarrow R\cup\{e_1\}$
5. $X=\{v_1,v_2,v_3,v_4\},R=\{e_1,e_2,e_3,e_4\},T=\{e_1,e_2,e_4\}$
6. $X=V(G)$ ã¨ãªã£ãŸã®ã§ $T$ ã‚’å‡ºåŠ›ã™ã‚‹

$T$ ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªå…¨åŸŸæœ¨ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/420943d12c75-20251129.png =200x)

ã“ã‚Œã¾ã§ã®è©±ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€è¿·è·¯ã¯ã‚°ãƒ©ãƒ•ã«å¯¾å¿œã—ã€ã‚°ãƒ©ãƒ•ã«ã¯ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ $\operatorname{Jac}(G)$ ã¨ã„ã†ç¾¤ãŒå®šã¾ã‚Šã€ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã¯ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­ã‚’ä½¿ã£ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã§ãã€ä»»æ„ã®å› å­ã‚’ç·šå½¢åŒå€¤ãª$q$-ç°¡ç´„å› å­ã¨ã„ã†ä»£è¡¨å…ƒã«å¤‰æ›ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒã‚ã‚Šï¼ˆAlgorithm 4ï¼‰ã€$q$-ç°¡ç´„å› å­ã¨å…¨åŸŸæœ¨ã®é–“ã«ã¯å…¨å˜å°„ãŒã‚ã£ã¦ã€$q$-ç°¡ç´„å› å­ã‹ã‚‰å…¨åŸŸæœ¨ã‚’ç”Ÿæˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆAlgorithm 2ï¼‰ãŒã‚ã‚‹ã®ã§ã—ãŸã€‚ã“ã‚Œã‚‰ã‚’å…¨ã¦çµ„ã¿åˆã‚ã›ã‚Œã°ä¸€æ§˜ã«ãƒ©ãƒ³ãƒ€ãƒ ãªè¿·è·¯ç”ŸæˆãŒå®Ÿç¾ã§ããã†ã§ã™ã­ã€‚

## å®Ÿè£…
å®Ÿè£…ã«ã¯ Haskell ã‚’ç”¨ã„ã¾ã™ã€‚å‹ãƒ¬ãƒ™ãƒ«è‡ªç„¶æ•°ã‚’ç”¨ã„ã‚Œã°ã‚°ãƒ©ãƒ•ã¨è¡Œåˆ—ã®å¯¾å¿œã‚’é–“é•ãˆãŸã‚Šã€è¡Œåˆ—ã®è¡Œã¨åˆ—ã®æ“ä½œã‚’æ··åŒã—ãŸå‡¦ç†ã‚’æ›¸ã„ã¦ã—ã¾ã£ãŸã¨ã—ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºã•ã‚Œã‚‹ã®ã§å®‰å¿ƒã§ã™ã€‚

:::details ãƒ—ãƒ©ã‚°ãƒã®å®£è¨€ï¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼è£œåŠ©é–¢æ•°ã®å®šç¾©
```hs
{-# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise #-}
{-# OPTIONS_GHC -fplugin GHC.TypeLits.KnownNat.Solver #-}

{-# LANGUAGE GHC2024 #-}
{-# LANGUAGE BlockArguments #-}

import Control.Monad (forM_, when)
import Control.Monad.ST (runST, ST)
import Data.Bits (xor)
import Data.Function (fix)
import Data.List (find)
import Data.Maybe (catMaybes, isJust, fromJust, fromMaybe, listToMaybe)
import Data.Proxy (Proxy(..))
import GHC.TypeLits (KnownNat, natVal, type (<=), type (-))

import Codec.Picture (convertRGB8, DynamicImage(ImageRGB8), Image, PixelRGB8(..), readImage, savePngImage, writePixel)
import Codec.Picture.Types (createMutableImage, freezeImage, pixelAt)
import Control.Monad.State
import Data.Finite (Finite, packFinite, getFinite)
import Data.Vector.Sized (Vector, (//))
import qualified Data.Vector as VB
import qualified Data.Vector.Mutable as VBM
import qualified Data.Vector.Sized as V
import qualified Data.Set as Set
import Data.Scientific (fromFloatDigits, Scientific)
import Numeric.LinearAlgebra (toLists)
import Numeric.LinearAlgebra.Static (inv, extract,matrix, L)
import System.Random (randomRIO)

toFinite :: KnownNat k => Int -> Finite k
toFinite x = fromMaybe (error "Index out of bounds") $ packFinite (fromIntegral x)
```
:::

ã‚°ãƒ©ãƒ•ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚`n` ã«ã¯å‹ãƒ¬ãƒ™ãƒ«è‡ªç„¶æ•°ãŒå…¥ã‚Šé ‚ç‚¹ã®æ•°ã‚’è¡¨ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã—ã¦ã¯è¾ºã®ãƒªã‚¹ãƒˆã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã‚¿ãƒ—ãƒ«ãªã®ã§é †åºãŒå®šã¾ã‚Šå‘ããŒå®šã¾ã£ã¦ã—ã¾ã„ã¾ã™ãŒã€é–¢æ•°å´ã§ç„¡å‘ã‚°ãƒ©ãƒ•ã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«å·¥å¤«ã—ã¦ã„ãã¾ã™ã€‚

```hs
-- | ã‚°ãƒ©ãƒ•ã®å®šç¾©
type Graph n = [(Finite n, Finite n)]
```

ãƒ™ã‚¯ãƒˆãƒ«ã‚„è¡Œåˆ—ã®å‹ã§ã‚‚è¦ç´ æ•°ã‚’å‹ãƒ¬ãƒ™ãƒ«è‡ªç„¶æ•°ã§æ‰±ãˆã‚‹ã‚ˆã†ã« [vector-sized](https://hackage.haskell.org/package/vector-sized) ã® `Vector` ã‚’ä½¿ã„ã¾ã™ã€‚

```hs
-- | ãƒ™ã‚¯ãƒˆãƒ«ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®å¼•ãç®—
(^-^) :: Num a => Vector n a -> Vector n a -> Vector n a
(^-^) = V.zipWith (-)

-- | å†…ç©
dot :: Num a => Vector n a -> Vector n a -> a
dot = (V.sum .) . V.zipWith (*)

-- | è¡Œåˆ—
type Matrix n m a = Vector n (Vector m a)

-- | å˜ä½è¡Œåˆ—
eye :: KnownNat n => Matrix n n Integer
eye = V.generate \i -> V.generate \j -> if i == j then 1 else 0

-- | è¡Œåˆ—ã®å¯¾è§’æˆåˆ†
diag :: KnownNat n => Matrix n n a -> Vector n a
diag = (>>= id)

-- | è¡Œåˆ—ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®ç©
(!*) :: Num a => Matrix m n a -> Vector n a -> Vector m a
(!*) m v = V.map (dot v) m

-- | å„æˆåˆ†ã”ã¨ã®æ¼”ç®—
elementWise :: (a -> b -> c) -> Matrix m n a -> Matrix m n b -> Matrix m n c
elementWise = V.zipWith . V.zipWith

-- | è¡Œåˆ—ã®å·®
(!-!) :: Num a => Matrix m n a -> Matrix m n a -> Matrix m n a
(!-!) = elementWise (-)
```

ã‚‚ã£ã¨è‰²ã€…ãªç·šå½¢ä»£æ•°ã«é–¢ã™ã‚‹é–¢æ•°ã®å®Ÿè£…ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚‚ã”å‚ç…§ãã ã•ã„ã€‚

https://zenn.dev/lotz/articles/6b0d8081ad2f8a

ã‚°ãƒ©ãƒ•ã¨ç·šå½¢ä»£æ•°ã®åŸºæœ¬çš„ãªæ–¹ãŒå®šç¾©ã§ããŸã®ã§ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚°ãƒ©ãƒ•ç†è«–ã«ç¾ã‚Œã‚‹è¡Œåˆ—ã‚’ä½œã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚å› å­ã®ä¿‚æ•°ãŒå¤§ãããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§è¦ç´ ã®å‹ã¯ `Int` ã§ã¯ãªãå¤šå€é•·æ•´æ•°ã® `Integer` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä¸€èˆ¬åŒ–é€†è¡Œåˆ—ã«ã¯æƒãå‡ºã—æ³•ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚‚å¯èƒ½ã§ã™ãŒã€é•·ããªã‚‹ã®ã§ [hmatrix](https://hackage.haskell.org/package/hmatrix) ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸæœ‰ç†æ•°ã§ã‚ã‚‹è¡Œåˆ—ã®è¦ç´ ã®è¡¨ç¾ã«ã¯ `Double` ã§ã¯ãªãã‚ˆã‚Šé«˜ã„ç²¾åº¦ã§å°æ•°ã‚’è¡¨ç¾ã§ãã‚‹ [scientific](https://hackage.haskell.org/package/scientific) ã® `Scientific` ã¨ã„ã†æ•°å€¤å‹ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯å¾Œã«å·¨å¤§ãªä¿‚æ•°ã®å› å­ã‚’æ‰±ã†éš›ã« `Double` ã ã¨æ•°å€¤ãŒ `NaN` ã«æ½°ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

```hs
-- | éš£æ¥è¡Œåˆ—
adjacencyMatrix :: KnownNat n => Graph n -> Matrix n n Integer
adjacencyMatrix es =
  let allEdges = es ++ [(v, u) | (u, v) <- es]
      adjList = V.accum (flip (:)) (V.replicate []) allEdges
  in fmap (\vs -> V.accum (+) (V.replicate 0) [(v, 1) | v <- vs]) adjList

-- | æ¬¡æ•°è¡Œåˆ—
degreeMatrix :: KnownNat n => Graph n -> Matrix n n Integer
degreeMatrix es =
  let vertexCounts = [(vertex, 1) | (u, v) <- es, vertex <- [u, v]]
      degrees = V.accum (+) (V.replicate 0) vertexCounts
   in V.generate \i -> V.accum (+) (V.replicate 0) [(i, degrees `V.index` i)]

-- | ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—
laplacianMatrix :: KnownNat n => Graph n -> Matrix n n Integer
laplacianMatrix es = degreeMatrix es !-! adjacencyMatrix es

-- | ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã‹ã‚‰kè¡Œkåˆ—ã‚’é™¤ã„ãŸè¡Œåˆ—
reducedLaplacianMatrix :: forall n. (KnownNat n, 1 <= n) => Graph n -> Finite n -> Matrix (n-1) (n-1) Integer
reducedLaplacianMatrix es k = 
    let matL :: Matrix n n Integer
        matL = laplacianMatrix es
        skip x = if x' < k' then toFinite x' else toFinite (x' + 1)
          where x' = fromInteger (getFinite x)
                k' = fromInteger (getFinite k)
    in V.generate \i -> V.generate \j -> matL `V.index` skip i `V.index` skip j

-- | ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®ä¸€èˆ¬åŒ–é€†è¡Œåˆ—
generalizedInversedLaplacianMatrix :: forall n. (KnownNat n, 1 <= n) => Graph n -> Finite n -> Matrix n n Scientific
generalizedInversedLaplacianMatrix es k =
  let n = fromInteger $ natVal (Proxy :: Proxy n)
      k' = fromInteger (getFinite k)
      matL = reducedLaplacianMatrix es k
      inversed :: L (n-1) (n-1)
      inversed = inv . matrix $ map fromIntegral $ V.toList $ V.concatMap id matL
      matList = map (map fromFloatDigits) . toLists $ extract inversed
      expanded = insertAt k' (replicate n 0) $ map (insertAt k' 0) matList
   in fromJust $ V.fromListN =<< (sequence . map V.fromListN $ expanded)
  where
    insertAt :: Int -> a -> [a] -> [a]
    insertAt i x xs =
      let (before, after) = splitAt i xs
       in before ++ [x] ++ after 
```

ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã‚’è¨ˆç®—ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

```hs
-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå·¦1ï¼‰
swapRows :: (KnownNat n, KnownNat m) => Finite n -> Finite n -> Matrix n m Integer -> Matrix n m Integer
swapRows i j mat
  | i == j = mat
  | otherwise = V.generate \r ->
      if r == i then mat `V.index` j
      else if r == j then mat `V.index` i
      else mat `V.index` r

-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå³1ï¼‰
swapCols :: (KnownNat n, KnownNat m) => Finite m -> Finite m -> Matrix n m Integer -> Matrix n m Integer
swapCols i j mat
  | i == j = mat
  | otherwise = flip V.map mat \row ->
      V.generate \r ->
        if r == i then row `V.index` j
        else if r == j then row `V.index` i
        else row `V.index` r

-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå·¦2ï¼‰
negateRow :: (KnownNat n, KnownNat m) => Finite n -> Matrix n m Integer -> Matrix n m Integer
negateRow i = V.imap (\r row -> if r == i then V.map negate row else row)

-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå³2ï¼‰
negateCol :: (KnownNat n, KnownNat m) => Finite m -> Matrix n m Integer -> Matrix n m Integer
negateCol j mat = flip V.map mat \row -> flip V.imap row (\c z -> if c == j then negate z else z) 

-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå·¦3ï¼‰
addRow :: (KnownNat n, KnownNat m) => Finite n -> Finite n -> Integer -> Matrix n m Integer -> Matrix n m Integer
addRow i j z mat = V.generate \r ->
  if r == i
    then V.zipWith (\x y -> x + z * y) (mat `V.index` i) (mat `V.index` j)
    else mat `V.index` r

-- | æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢ï¼ˆå³3ï¼‰
addCol :: (KnownNat n, KnownNat m) => Finite m -> Finite m -> Integer -> Matrix n m Integer -> Matrix n m Integer
addCol i j z mat = flip V.map mat \row ->
    V.generate \c ->
      if c == i
        then (row `V.index` i) + z * (row `V.index` j)
        else row `V.index` c
```

ã“ã¡ã‚‰ã®å®Ÿè£…ã¨ `ï¼ˆå·¦1ï¼‰` ç­‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ä»¥å‰ã®è¨˜äº‹ã§ã®ã‚‚ã®ã¨åŒã˜ã§ã™ã€‚

https://zenn.dev/lotz/articles/93f73c17145819

æ¬¡ã«æ•´æ•°è¡Œåˆ—ã®ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã¨ãã®è¨ˆç®—ã«ç”¨ã„ã‚‹ãƒ¢ãƒŠãƒ‰åŠã³ãã‚Œã‚‰ã«é–¢ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ä¸Šè¨˜ã®è¨˜äº‹ã§ã¯ $S=UAV$ ã¨ã„ã†é–¢ä¿‚å¼ã‚’å‰æã«ã—ã¦ã„ã¾ã—ãŸãŒã€æœ¬ç¨¿ã§ã¯å¾Œã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®éƒ½åˆä¸Š $A=USV$ ã¨ã„ã†é–¢ä¿‚å¼ã‚’å‰æã«è¨­è¨ˆã—ã¦ã„ã‚‹ã®ã§ã€å®Ÿè£…ãŒå¾®å¦™ã«å¤‰ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã° $S$ ã«å¯¾ã™ã‚‹å·¦åŸºæœ¬å¤‰å½¢ $P$ ã¯

$$
\begin{matrix}
A
&=& USV \\
&=& U(P^{-1}P)SV \\
&=& (UP^{-1})(PS)V \\
\end{matrix}
$$

ã®ã‚ˆã†ã« $U$ ã«å¯¾ã™ã‚‹ $P^{-1}$ ã«ã‚ˆã‚‹å³åŸºæœ¬å¤‰å½¢ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

```hs
-- | æ•´æ•°è¡Œåˆ—ã®ã‚¹ãƒŸã‚¹æ¨™æº–å½¢
-- A = USV ã¨ãªã‚‹S,U,Vã‚’è¡¨ã™
data SNFState n m = SNFState
  { snfS :: Matrix n m Integer
  , snfU :: Matrix n n Integer
  , snfV :: Matrix m m Integer
  } deriving Show

-- | ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã®è¨ˆç®—ã«ç”¨ã„ã‚‹ãƒ¢ãƒŠãƒ‰
type SNFMonad n m a = State (SNFState n m) a

getS :: SNFMonad n m (Matrix n m Integer)
getS = gets snfS

getVal :: (KnownNat n, KnownNat m) => Finite n -> Finite m -> SNFMonad n m Integer
getVal i j = do
  s <- getS
  pure $ (s `V.index` i) `V.index` j

modifyS :: (Matrix n m Integer -> Matrix n m Integer) -> SNFMonad n m ()
modifyS f = modify \s -> s { snfS = f (snfS s) }

modifyU :: (Matrix n n Integer -> Matrix n n Integer) -> SNFMonad n m ()
modifyU f = modify \s -> s { snfU = f (snfU s) }

modifyV :: (Matrix m m Integer -> Matrix m m Integer) -> SNFMonad n m ()
modifyV f = modify \s -> s { snfV = f (snfV s) }

-- | `SNFState` ã«å¯¾ã™ã‚‹æ•´æ•°è¡Œåˆ—ã®åŸºæœ¬å¤‰å½¢
swapRowsM :: (KnownNat n, KnownNat m) => Finite n -> Finite n -> SNFMonad n m ()
swapRowsM i j = do
  modifyS $ swapRows i j
  modifyU $ swapCols j i

swapColsM :: (KnownNat n, KnownNat m) => Finite m -> Finite m -> SNFMonad n m ()
swapColsM i j = do
  modifyS $ swapCols i j
  modifyV $ swapRows j i

negateRowM :: (KnownNat n, KnownNat m) => Finite n -> SNFMonad n m ()
negateRowM i = do
  modifyS $ negateRow i
  modifyU $ negateCol i
-- negateColM ã‚‚ã‚ã‚‹ãŒæœ¬ç¨¿ã§ã¯ä½¿ç”¨ã—ãªã„ã®ã§å‰²æ„›

addRowM :: (KnownNat n, KnownNat m) => Finite n -> Finite n -> Integer -> SNFMonad n m ()
addRowM i j m = do
  modifyS $ addRow i j m
  modifyU $ addCol j i (-m)

addColM :: (KnownNat n, KnownNat m) => Finite m -> Finite m -> Integer -> SNFMonad n m ()
addColM i j m = do
  modifyS $ addCol i j m
  modifyV $ addRow j i (-m)
```

ã“ã‚Œã‚‰ã‚’ä½¿ã£ã¦ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã‚’è¨ˆç®—ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚é–¢ä¿‚å¼ã®é•ã„ã¯ä¸Šè¨˜é–¢æ•°ã®å®Ÿè£…ã§å¸åã—ã¦ã„ã‚‹ã®ã§ `smithNormalForm` ã®å®Ÿè£…ã¯ä»¥å‰ã®è¨˜äº‹ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ã€‚

```hs
-- | ã‚¹ãƒŸã‚¹æ¨™æº–å½¢ã‚’æ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
smithNormalForm :: forall n m. (KnownNat n, KnownNat m) => Matrix n m Integer -> SNFState n m
smithNormalForm mat0 = execState algorithm initialState
  where
    initialState = SNFState mat0 eye eye
    rows = fromIntegral $ natVal (Proxy :: Proxy n)
    cols = fromIntegral $ natVal (Proxy :: Proxy m)
    limit = min rows cols

    algorithm :: SNFMonad n m ()
    algorithm = do
      forM_ [0 .. limit - 1] \k -> do
        processPivot k
        ensurePositiveDiagonal k

    processPivot :: Int -> SNFMonad n m ()
    processPivot k = do
      fix \restart -> do
        -- â‘  æœ€å°ã®éã‚¼ãƒ­è¦ç´ ã‚’æ¢ã—ã¦ (k,k) ã«ç§»å‹•
        maybeMin <- findMinNonZero k
        case maybeMin of
          Nothing -> pure () -- æ®‹ã‚ŠãŒé›¶è¡Œåˆ—ãªã‚‰ã“ã®å‡¦ç†ã¯å®Œäº†
          Just (r, c) -> do
            let k_row = toFinite @n k
                k_col = toFinite @m k
            swapRowsM k_row r
            swapColsM k_col c

            -- â‘¡ è¡Œæ–¹å‘
            forM_ [k + 1 .. rows - 1] \i -> do
              let i_row = toFinite @n i
              val <- getVal i_row k_col
              pivot <- getVal k_row k_col
              when (val /= 0) do
                let q = val `div` pivot
                addRowM i_row k_row (-q)
                rem' <- getVal i_row k_col
                when (rem'/= 0) do
                  swapRowsM k_row i_row
                  restart

            -- â‘¡ åˆ—æ–¹å‘
            forM_ [k + 1 .. cols - 1] \j -> do
              let j_col = toFinite @m j
              val <- getVal k_row j_col
              pivot <- getVal k_row k_col
              when (val /= 0) do
                let q = val `div` pivot
                addColM j_col k_col (-q)
                rem' <- getVal k_row j_col
                when (rem' /= 0) do
                  swapColsM k_col j_col
                  restart

            -- â‘¢
            pivot <- getVal k_row k_col
            badIndices <- findBadIndices k pivot
            case badIndices of
              Just (_, c') -> do
                addColM k_col c' 1
                restart
              Nothing -> pure ()

    -- (k, k)æˆåˆ†ã‹ã‚‰å³ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯è¡Œåˆ—ã«ãŠã‘ã‚‹0ã§ãªã„çµ¶å¯¾å€¤ãŒæœ€å°ã®è¦ç´ ã®ä½ç½®ã‚’æ¢ã™é–¢æ•°
    findMinNonZero :: Int -> SNFMonad n m (Maybe (Finite n, Finite m))
    findMinNonZero k = do
      s <- getS
      let candidates = [ (abs val, (r, c))
                       | r <- map (toFinite @n) [k .. rows - 1]
                       , c <- map (toFinite @m) [k .. cols - 1]
                       , let val = (s `V.index` r) `V.index` c
                       , val /= 0
                       ]
      if null candidates
        then pure Nothing
        else pure $ Just (snd $ minimum candidates)

    -- (k, k)æˆåˆ†ã‹ã‚‰å³ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯è¡Œåˆ—ã«ãŠã„ã¦ä¸ãˆã‚‰ã‚ŒãŸæ•´æ•°ã§å‰²ã‚Šåˆ‡ã‚Œãªã„è¦ç´ ã®ä½ç½®ã‚’æ¢ã™é–¢æ•°
    findBadIndices :: Int -> Integer -> SNFMonad n m (Maybe (Finite n, Finite m))
    findBadIndices k pivot = do
      s <- getS
      let indices = [ (r, c)
                    | r <- map (toFinite @n) [k + 1 .. rows - 1]
                    , c <- map (toFinite @m) [k + 1 .. cols - 1]
                    , ((s `V.index` r) `V.index` c) `mod` pivot /= 0
                    ]
      pure $ listToMaybe indices

    -- å¯¾è§’æˆåˆ†ã‚’æ­£ã«ã™ã‚‹
    ensurePositiveDiagonal :: Int -> SNFMonad n m ()
    ensurePositiveDiagonal k = do
      let k_row = toFinite @n k
          k_col = toFinite @m k
      val <- getVal k_row k_col
      when (val < 0) $ negateRowM k_row
```

æ¬¡ã«ã‚°ãƒ©ãƒ•ã®å› å­ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚é ‚ç‚¹ã«å¯¾å¿œã™ã‚‹æ•´æ•°ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã« `Vector` ã‚’ä½¿ã„ã¾ã™ã€‚

```hs
-- | å› å­
type Divisor n = Vector n Integer
```

ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®0ã§ãªã„å˜å› å­ã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å…ƒã®ä»£è¡¨å…ƒã‚’ç”Ÿæˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```hs
-- | ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒã‚’ç”Ÿæˆã™ã‚‹
randomDeg0Divisor :: forall n. (KnownNat n, 1 <= n) => Graph n -> IO (Divisor n)
randomDeg0Divisor es = do
  let n_1 = fromInteger $ (natVal (Proxy :: Proxy n)-1)
      matL' = reducedLaplacianMatrix es n_1
      snf = smithNormalForm matL'
      invariantFactors = diag $ snfS snf
  vs <- mapM (\d -> randomRIO (0, d-1)) invariantFactors
  let us = snfU snf !* vs
  pure $ V.snoc us (-V.sum us)
```

ä¸ãˆã‚‰ã‚ŒãŸå› å­ã‹ã‚‰ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­ã«å¤‰æ›ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆAlgorithm 4ï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚æœ¬ç¨¿ã§ã¯ $q$ ã¨ã—ã¦ä¸€ç•ªæœ«å°¾ã®é ‚ç‚¹ï¼ˆ`Finite n`ãªã‚‰`n-1`ï¼‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚å¾Œã«å…¥åŠ›ã¨ã—ã¦$q$-ç°¡ç´„å› å­ã‚’è¦è«‹ã™ã‚‹é–¢æ•°ãŒã‚ã‚‹ã®ã§å‡ºåŠ›ã•ã‚Œã‚‹å› å­ã‚’ `ReducedDivisor` ã¨ã„ã† `newtype` ã§ãƒ©ãƒƒãƒ—ã—ã¦$q$-ç°¡ç´„å› å­ã§ã‚ã‚‹ã“ã¨ã‚’å‹ã§ä¿è¨¼ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

å®Ÿè£…ã§ã¯ã‚¹ãƒ†ãƒƒãƒ—1ã«ãŠã„ã¦å˜ã«

$$
[D'] = [D] - L\lfloor L_{(q)}[D]\rfloor
$$

ã‚’è¨ˆç®—ã™ã‚‹ã®ã§ã¯ãªãã€ç¹°ã‚Šè¿”ã—é©ç”¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ãŒä¸Šè¿°ã®èª¬æ˜ã‹ã‚‰ç•°ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚[[Baker and Shokrieh 2013]](https://www.sciencedirect.com/science/article/pii/S0097316512001355) ã®Proposition 5.4ã«ãŠã„ã¦ä¸Šè¨˜ã®è¨ˆç®—ã«ã‚ˆã£ã¦ä¿‚æ•°ã®ååˆ†å°ã•ãªå› å­ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã¯ä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€æœ¬ç¨¿ã®å®Ÿè£…ã§ã¯å®Ÿæ•°è¨ˆç®—ã«ã‚ˆã‚‹èª¤å·®ãŒç™ºç”Ÿã— $[D']$ ã®è¦ç´ ãŒååˆ†å°ã•ããªã‚‹ã¨ã¯é™ã‚‰ãªã„ã®ã§ç¹°ã‚Šè¿”ã—é©ç”¨ã™ã‚‹ã“ã¨ã§å¾ã€…ã«å¤§ãã•ã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚å€¤ãŒåæŸã›ãšã«å‘¨æœŸæ€§ã‚’æŒã¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã‚ã‚‹ãŸã‚ã€æœ€å¤§å›æ•°ã‚’è¨­ã‘ã¦åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸ Algorithm 4 ã¯å¤§ããªå› å­ãŒä¸ãˆã‚‰ã‚Œã¦å‡¦ç†ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã®ã§ã€å› å­ã‚’å¯å¤‰ãªãƒ™ã‚¯ãƒˆãƒ« `Data.Vector.Mutable` ã«å¤‰æ›ã—ã¦ãƒ¡ãƒ¢ãƒªã®æ›¸ãæ›ãˆã‚’è¡Œã„ãªãŒã‚‰åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã‚‹ã‚ˆã†ãªå®Ÿè£…ã«ã—ã¦ã„ã¾ã™ã€‚

```hs
-- | q-ç°¡ç´„å› å­
newtype ReducedDivisor n = ReducedDivisor (Divisor n)
                           deriving (Show)

-- | å› å­ã‚’ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­ã«å¤‰æ›ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
algorithm4 :: forall n. (KnownNat n, 1 <= n) => Graph n -> Divisor n -> ReducedDivisor n
algorithm4 es ds = runST $ do
  let ds' = flip fix (ds, 100000 :: Int) \loop (divisor, limit) ->
          let divisor' = divisor ^-^ (matL !* (V.map floor $ matLq !* (V.map fromIntegral divisor)))
          in if divisor == divisor' || limit == 0 then divisor else loop (divisor', limit-1)
  mds <- VB.thaw $ V.fromSized ds'
  mas <- VBM.replicate n 1
  step2 mds
  step4 mds mas (n-1) 1
  ReducedDivisor . fromJust . V.toSized <$> VB.freeze mds
  where
    n = fromInteger $ natVal (Proxy :: Proxy n)
    n_1 = fromInteger $ natVal (Proxy :: Proxy n) - 1

    matA = adjacencyMatrix es
    matL = laplacianMatrix es
    matLq = generalizedInversedLaplacianMatrix es n_1

    matA' = V.fromSized $ fmap V.fromSized matA
    matL' = V.fromSized $ fmap V.fromSized matL

    step2 :: VBM.MVector s Integer -> ST s ()
    step2 divisor = flip fix 0 \loop v -> do
      d_v <- VBM.read divisor v
      if d_v < 0
        then if v == n-1 then pure () else do
          let matL_v = matL' VB.! v
          flip fix 0 \loopI i -> if i > n-1 then pure () else do
            current <- VBM.read divisor i
            let !nextVal = current + matL_v VB.! i
            VBM.write divisor i nextVal
            loopI (i+1)
          step2 divisor
        else if v == n-1 then pure () else loop (v+1)

    step4 :: VBM.MVector s Integer -> VBM.MVector s Integer -> Int -> Int -> ST s ()
    step4 divisor as v i = do
      VBM.write as v 0
      flip fix 0 \search v' -> do
        d_v' <- VBM.read divisor v'
        a_v' <- VBM.read as v'
        let row_v' = matA' VB.! v'
            calcDot k acc
              | k > (n-1) = pure acc
              | otherwise = do
                  a_k <- VBM.read as k
                  calcDot (k + 1) (acc + (1 - a_k) * (row_v' VB.! k))
        outdegA <- calcDot 0 0
        if (a_v' == 1) && (d_v' < outdegA)
          then if i == n-1 then pure () else step4 divisor as v' (i+1)
          else if v' == n-1
            then do
              flip fix 0 \loopK k -> if k > (n-1) then pure () else do
                a_k <- VBM.read as k
                if a_k == 1 then do
                  let matL_k = matL' VB.! k
                  flip fix 0 \loopJ j -> if j > (n-1) then pure () else do
                    current <- VBM.read divisor j
                    let !nextVal = current - matL_k VB.! j
                    VBM.write divisor j nextVal
                    loopJ (j+1)
                  else pure ()
                loopK (k+1)
              VBM.set as 1
              step4 divisor as (n-1) 1
            else search (v'+1)
```

`fix` ã‚’ä½¿ã£ãŸãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…ãŒæ°—ã«ãªã‚‹æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚‚ã”å‚ç…§ãã ã•ã„

https://qiita.com/lotz/items/409112751a23689d7d85

https://qiita.com/lotz/items/0894079a44e87dc8b73e

æ¬¡ã«$q$-ç°¡ç´„å› å­ã‹ã‚‰å…¨åŸŸæœ¨ã‚’ä½œæˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆAlgorithm 2ï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã«å…¥åŠ›ã•ã‚Œã‚‹å› å­ã¯$q$-ç°¡ç´„å› å­ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãã®åˆ¶ç´„ã‚’å‹ã‚’ä½¿ã£ã¦ä¿è¨¼ã—ã¦ã„ã¾ã™ã€‚

```hs
-- | q-ç°¡ç´„å› å­ã‹ã‚‰å…¨åŸŸæœ¨ã‚’ä½œæˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
algorithm2 :: forall n. KnownNat n => Graph n -> ReducedDivisor n -> Graph n
algorithm2 es (ReducedDivisor ds) = step2 (V.replicate False // [(n_1, True)]) Set.empty []
  where
    n_1 = fromInteger $ (natVal (Proxy :: Proxy n)-1)
    step2 xs rs ts
      | V.all id xs = ts
      | otherwise =
          let e = fromJust $ flip find es \e'@(u,v) -> not (Set.member e' rs) && (V.index xs u `xor` V.index xs v)
              v' = if V.index xs (fst e) then snd e else fst e
           in if V.index ds v' == fromIntegral (Set.size (Set.filter (\(u, v) -> u == v' || v == v') rs))
                then step2 (xs // [(v', True)]) (Set.insert e rs) (e : ts)
                else step2 xs (Set.insert e rs) ts
```

ã‚°ãƒ©ãƒ•ã‹ã‚‰å…¨åŸŸæœ¨ã¾ã§ä½œæˆã™ã‚‹é–¢æ•°ãŒã§ããŸã®ã§æœ€å¾Œã«è¿·è·¯ã‚’æç”»ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚ã‚°ãƒ©ãƒ•ã«ã¯é ‚ç‚¹ãŒå¹³é¢ä¸Šã«ã©ã®ã‚ˆã†ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ã¨ã„ã†æƒ…å ±ãŒç„¡ã„ãŸã‚ã€ãã‚Œã‚’è¡¨ã™å‹ã‚’ç”¨æ„ã—ã¾ã™ã€‚è¦ç´ ãŒ `Maybe` å‹ã¨ãªã£ã¦ã„ã‚‹ã®ã¯é ‚ç‚¹ãŒå­˜åœ¨ã—ãªã„ãƒã‚¹ã‚’è¡¨ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ï¼ˆã“ã®è¾ºã¯å¾Œã®å…·ä½“ä¾‹ã‚’å…ˆã«è¦‹ãŸæ–¹ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰

```hs
-- å†…å´ã®ãƒªã‚¹ãƒˆã®é ‚ç‚¹ã¯æ˜‡é †ã«ä¸¦ã¶ã“ã¨ã‚’ä»®å®šã—ã¦ã„ã‚‹
type Grid n = [[Maybe (Finite n)]]
```

å¹³é¢ä¸Šã«é ‚ç‚¹ãŒã©ã®ã‚ˆã†ã«é…ç½®ã•ã‚Œã‚‹ã‹ãŒåˆ†ã‹ã‚Œã°ã€ãã“ã‹ã‚‰åœŸå°ã¨ãªã‚‹ã‚°ãƒ©ãƒ•æ§‹é€ ã‚’è¨ˆç®—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```hs
-- | å¹³é¢ä¸Šã®é…ç½®ã‹ã‚‰åœŸå°ã¨ãªã‚‹ã‚°ãƒ©ãƒ•æ§‹é€ ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
toGraph :: Grid n -> Graph n
toGraph grid = horizontalEdges ++ verticalEdges
  where
    connect :: Maybe a -> Maybe a -> [(a, a)]
    connect (Just u) (Just v) = [(u, v)]
    connect _        _        = []

    horizontalEdges = flip concatMap grid \row -> 
        concat $ zipWith connect row (drop 1 row)

    verticalEdges = concat $ zipWith (\row1 row2 -> 
        concat $ zipWith connect row1 row2
      ) grid (drop 1 grid)
```

å¹³é¢ä¸Šã®é…ç½®ã¨å…¨åŸŸæœ¨ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ã€å¯¾å¿œã™ã‚‹ä½ç½®ã«ã©ã®ã‚ˆã†ãªé€šè·¯ã‚’é…ç½®ã™ã‚Œã°ã‚ˆã„ã‹ãŒè¨ˆç®—ã§ãã¾ã™ã€‚é€šè·¯ã¯ä¸Šä¸‹å·¦å³ã«ã¤ãªãŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã§å…¨16é€šã‚ŠãŒå­˜åœ¨ã—ã¾ã™ã€‚0~15ã®æ•°ã‚’2é€²æ•°ã§è¡¨ã—ã¦ä¸Šä¸‹å·¦å³ã«ãã‚Œãã‚Œã«é€šè·¯ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ $0,1$ ã§è¡¨ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«å¯¾å¿œã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2cbd9d808e3a-20251214.png)

ã“ã®è€ƒãˆæ–¹ã§ã€å…¨åŸŸæœ¨ã‹ã‚‰é…ç½®ã™ã‚‹é€šè·¯ã®æƒ…å ±ã€ã™ãªã‚ã¡è¿·è·¯ã«å¤‰æ›ã™ã‚‹é–¢æ•°ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```hs
-- | é ‚ç‚¹ãŒä¸Šã‹ã‚‰ä½•å±¤ç›®ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¡¨ã™ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—ã™ã‚‹
toLayer :: KnownNat n => Grid n -> Vector n Int
toLayer grid = V.replicate 0 //
  (catMaybes . concatMap (\(l, row) -> map (fmap (,l)) row) $ zip [0..] grid)

-- | ã‚°ãƒªãƒƒãƒ‰ã¨å…¨åŸŸæœ¨ã‹ã‚‰ä¸Šä¸‹å·¦å³ã«é€šè·¯ãŒã‚ã‚‹ã‹ã©ã†ã‹ã®æƒ…å ±ã«å¤‰æ›ã™ã‚‹
toAisles :: KnownNat n => Grid n -> Graph n -> [[Finite 16]]
toAisles grid es = map (map toAisle) grid
  where
    layer = toLayer grid
    toAisle Nothing = 0
    toAisle (Just s) = 
      let selfLevel = V.index layer s
          neighbors = [let t = if u == s then v else u in (V.index layer t, t) | (u, v) <- es, u == s || v == s]
          to01 b = if b then 1 else 0
          up    = to01 . isJust $ find (\(l, _) -> l < selfLevel) neighbors
          down  = to01 . isJust $ find (\(l, _) -> l > selfLevel) neighbors
          left  = to01 . isJust $ find (\(l, t) -> l == selfLevel && t < s) neighbors
          right = to01 . isJust $ find (\(l, t) -> l == selfLevel && t > s) neighbors
       in up * 8 + down * 4 + left * 2 + right
```

æç”»ã™ã‚‹ç”»åƒã®æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ã‚‡ã†ã€‚ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚

```sh
â””â”€â”€ images
   â”œâ”€â”€ 0000.png
   â”œâ”€â”€ 0001.png
   â”œâ”€â”€ 0010.png
   ..
```

```hs
-- | ãƒãƒƒãƒ—ãƒãƒƒãƒ—ã‚’æ ¼ç´ã—ãŸãƒ™ã‚¯ãƒˆãƒ«
type MapTips = Vector 16 (Image PixelRGB8)

-- | ãƒãƒƒãƒ—ãƒãƒƒãƒ—ï¼ˆç”»åƒãƒ‡ãƒ¼ã‚¿ï¼‰ã®èª­ã¿è¾¼ã¿
loadImages :: IO MapTips
loadImages = V.generateM \i -> do
  let bs = map (\k -> if (i `div` k) `mod` 2 == 1 then '1' else '0') [8, 4, 2, 1]
      path = "images/" ++ bs ++ ".png"
  eitherImage <- readImage path
  case eitherImage of
    Left err -> error $ "Failed to load image " ++ path ++ ": " ++ err
    Right img -> pure $ convertRGB8 img
```

æœ€å¾Œã«è¿·è·¯ã‚’æç”»ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦çµ‚ã‚ã‚Šã§ã™ã€‚

```hs
-- | è¿·è·¯ã®ç”»åƒã‚’æç”»ã™ã‚‹é–¢æ•°
renderImage :: MapTips -> FilePath -> [[Finite 16]] -> IO ()
renderImage mapTips outPath aisles = do
  let tipSize = 72
      width = tipSize * length (aisles !! 0)
      height = tipSize * length aisles
  canvas <- createMutableImage width height (PixelRGB8 0 0 0)
  forM_ (zip [0..] aisles) $ \(i, row) -> do
    forM_ (zip [0..] row) $ \(j, aisle) -> do
      forM_ [0 .. tipSize - 1] $ \dx ->
        forM_ [0 .. tipSize - 1] $ \dy -> do
          let srcImg = V.index mapTips aisle
              pixel = pixelAt srcImg dx dy
          writePixel canvas (j * tipSize + dx) (i * tipSize + dy) pixel
  image <- freezeImage canvas
  savePngImage outPath (ImageRGB8 image)
```

## ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹
ã„ã‚ˆã„ã‚ˆå®Ÿè£…ã—ãŸé–¢æ•°ã‚’ä½¿ã£ã¦ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ä»Šã¾ã§ä¾‹ã¨ã—ã¦è¦‹ã¦ããŸæ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã§è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```hs
main :: IO ()
main = do
  let grid = [ [Just 0, Just 1]
             , [Just 2, Just 3]
             ] :: Grid 4
      graph = toGraph grid
      invariantFactors = V.init . diag . snfS . smithNormalForm $ laplacianMatrix graph

  putStrLn "ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­"
  print invariantFactors
  putStrLn "--------------------"

  divisor <- randomDeg0Divisor graph
  putStrLn "ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒ"
  print divisor
  putStrLn "--------------------"

  -- q-ç°¡ç´„å› å­ã‚’çµŒç”±ã—ã¦å…¨åŸŸæœ¨ã«å¤‰æ›
  let qDivisor = algorithm4 graph divisor
      tree = algorithm2 graph $ qDivisor
      aisles = toAisles grid tree

  putStrLn "ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­"
  print qDivisor
  putStrLn "--------------------"

  -- è¿·è·¯ã®ç”»åƒã‚’æç”»
  mapTips <- loadImages
  renderImage mapTips "dungeon.png" aisles
```

```hs
$ cabal run
ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­
Vector [1,1,4]
--------------------
ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒ
Vector [0,2,0,-2]
--------------------
ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­
ReducedDivisor (Vector [1,0,0,-1])
```

![](https://storage.googleapis.com/zenn-user-upload/b7a7d8e5aead-20251214.png)

ã‚‚ã£ã¨å¤§ããªè¿·è·¯ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚$9\times9$ã®ãƒã‚¹ç›®ã®ã‚°ãƒ©ãƒ•ã§è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```hs
main :: IO ()
main = do
  let grid = [ [Just  0, Just  1, Just  2, Just  3, Just  4, Just  5, Just  6, Just  7, Just  8]
             , [Just  9, Just 10, Just 11, Just 12, Just 13, Just 14, Just 15, Just 16, Just 17]
             , [Just 18, Just 19, Just 20, Just 21, Just 22, Just 23, Just 24, Just 25, Just 26]
             , [Just 27, Just 28, Just 29, Just 30, Just 31, Just 32, Just 33, Just 34, Just 35]
             , [Just 36, Just 37, Just 38, Just 39, Just 40, Just 41, Just 42, Just 43, Just 44]
             , [Just 45, Just 46, Just 47, Just 48, Just 49, Just 50, Just 51, Just 52, Just 53]
             , [Just 54, Just 55, Just 56, Just 57, Just 58, Just 59, Just 60, Just 61, Just 62]
             , [Just 63, Just 64, Just 65, Just 66, Just 67, Just 68, Just 69, Just 70, Just 71]
             , [Just 72, Just 73, Just 74, Just 75, Just 76, Just 77, Just 78, Just 79, Just 80]
             ] :: Grid 81
-- ï¼ˆä»¥ä¸‹åŒã˜ï¼‰
```

```hs
$ cabal run
ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­
Vector [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,8,8,8,286824,286824,1656982248,14912840232]
--------------------
ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒ
Vector [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16626303891704027644158123716970402288542977988232568894400495002286868611465504932632857508500018267785471994803916930293,12793682229518324008915781688336024625678888195847859982500106080686828655629167256065736238265376264097867864529781083,-191905508191308594696206557666660272150977523840455108471562085616478195535846677712860192826806860337511938258562736378,1621603679161932293256388939717703539309443193230557180110406444172761945147408753135257836707000652215777224478908359040,-8830873479507179090461776694345606286491969229285773819814086032342202553382667563243604126994091928941757179121640781165,32470522576478457451575746128031986993543986452682932834751039992267387668106158531560616897679890624574532958312348552427,-81854437033559095061653010650305647992031705206056185398915681713377167534561678975173748467760501941447531293052742225362,139372034785009440218976966700382438279916552984814895089613776408169943187467092604610007098684145147657442181508697362201,-131746197489330363240291383563311573756008385038551102989108215473617044624056229350406985141709056534262574651317603784751,32520154896004570055126236198838621180744397490576715457451327351975244666694628577342392851481137196492052834782148542612]
--------------------
ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­
ReducedDivisor (Vector [0,1,0,0,0,1,1,0,1,0,2,2,0,1,0,3,1,0,0,3,0,0,3,0,0,0,1,1,0,0,0,1,2,0,0,0,0,3,1,2,0,0,1,3,0,1,1,2,0,0,2,0,1,0,0,0,0,1,2,0,0,3,0,2,1,2,1,0,1,1,0,0,0,1,0,0,1,0,0,1,-58])
--------------------
```

![](https://storage.googleapis.com/zenn-user-upload/6bf2883e3d29-20251214.png)

è¿·è·¯ã®å½¢ã‚’è‡ªç”±ã«è¨­è¨ˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°åå­—ã®è¿·è·¯ã ã£ãŸã‚Š

```hs
main :: IO ()
main = do
  let grid = [ [Nothing, Nothing, Nothing, Just  0, Just  1, Just  2, Nothing, Nothing, Nothing]
             , [Nothing, Nothing, Nothing, Just  3, Just  4, Just  5, Nothing, Nothing, Nothing]
             , [Nothing, Nothing, Nothing, Just  6, Just  7, Just  8, Nothing, Nothing, Nothing]
             , [Just  9, Just 10, Just 11, Just 12, Just 13, Just 14, Just 15, Just 16, Just 17]
             , [Just 18, Just 19, Just 20, Just 21, Just 22, Just 23, Just 24, Just 25, Just 26]
             , [Just 27, Just 28, Just 29, Just 30, Just 31, Just 32, Just 33, Just 34, Just 35]
             , [Nothing, Nothing, Nothing, Just 36, Just 37, Just 38, Nothing, Nothing, Nothing]
             , [Nothing, Nothing, Nothing, Just 39, Just 40, Just 41, Nothing, Nothing, Nothing]
             , [Nothing, Nothing, Nothing, Just 42, Just 43, Just 44, Nothing, Nothing, Nothing]
             ] :: Grid 45
-- ï¼ˆä»¥ä¸‹åŒã˜ï¼‰
```

```hs
$ cabal run
ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­
Vector [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,49416,55333813080]
--------------------
ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒ
Vector [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-75763467026785548898026746607614634899449787511154088204991591873592158278121494776072563133609991079043916795553721680,286215820583929872522330953846768905776782238658891402150762208295722999308449068300178819048552500574729450124280122680,-420904046051660815362439189477624766457590171384942171333669949059557962095399711129111867497726173258260338116307317648,0,0,0,139714608303279808904183100728889155622570536025746959893767280600434417183635212167360995619510170865360017775798980525440,-495074762707146625872870725582768167072813856503596384277287679794349896472694502756939493917820494186061357486613826745364,357944499968048325768727364347675342582450521096447489724482775806786151784985002069554824524740402852942984900593558077160,0,0,0,0,0,-8443317272178569527135773985854807244233418546960139328278934703375573014747550012163360918609591265814499336870666956612,-3064174905794154653273937424666953185997935951193756146904849047448424876761523241360424832173536556991229125680582854788,9192524717384421174681277191247598064116098077533011698299345449593934226253488144899133403213960313760781794724481870944,-58926411098689302573170292283698270511686477739976706690038979003181709605054233746668267278128359434123717164363000132]
--------------------
ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­
ReducedDivisor (Vector [0,1,1,0,2,0,1,0,1,0,1,1,0,1,0,2,0,1,2,0,2,0,0,0,0,0,0,0,0,0,0,1,3,0,0,0,0,0,0,0,1,1,0,0,-22])
--------------------
```

![](https://storage.googleapis.com/zenn-user-upload/058554d050b4-20251214.png)

çœŸã‚“ä¸­ã«ç©´ã®ç©ºã„ãŸè¿·è·¯ã‚’ä½œã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```hs
main :: IO ()
main = do
  let grid = [ [Just  0, Just  1, Just  2, Just  3, Just  4, Just  5, Just  6, Just  7, Just  8]
             , [Just  9, Just 10, Just 11, Just 12, Just 13, Just 14, Just 15, Just 16, Just 17]
             , [Just 18, Just 19, Just 20, Just 21, Just 22, Just 23, Just 24, Just 25, Just 26]
             , [Just 27, Just 28, Just 29, Nothing, Nothing, Nothing, Just 30, Just 31, Just 32]
             , [Just 33, Just 34, Just 35, Nothing, Nothing, Nothing, Just 36, Just 37, Just 38]
             , [Just 39, Just 40, Just 41, Nothing, Nothing, Nothing, Just 42, Just 43, Just 44]
             , [Just 45, Just 46, Just 47, Just 48, Just 49, Just 50, Just 51, Just 52, Just 53]
             , [Just 54, Just 55, Just 56, Just 57, Just 58, Just 59, Just 60, Just 61, Just 62]
             , [Just 63, Just 64, Just 65, Just 66, Just 67, Just 68, Just 69, Just 70, Just 71]
             ] :: Grid 72
-- ï¼ˆä»¥ä¸‹åŒã˜ï¼‰
```

```hs
ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®å˜å› å­
Vector [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,24,24,86544360,3601016053525800]
--------------------
ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ä»£è¡¨å…ƒ
Vector [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,522058502368896251850973825340087860896581655310339615884387761061962076256341280220330528368008135045759900,0,0,0,-19731051590801182162020683456569386451332232302029950406069732600998753770394282781786871582122509785899430,257403776190275284864561196102393109365500171277988491716745937054039757363678688956228382197008000513747978,-1283033944610647781034610032303264067940553837299252807702743212386892710408692155088018375993158837615052248,3176084609073599958289994081637658377745639289661656359810844976344215991539266542760437235621643688217810338,-3573008595397331842304168342196530464550690484954910336340785492999364774312896270781200375451880289746112486,920226703966009310495269954876224570934855438306208627037619763527038413332696196714009476840501813369745948]
--------------------
ç·šå½¢åŒå€¤ãªq-ç°¡ç´„å› å­
ReducedDivisor (Vector [1,0,0,1,1,1,1,0,0,1,1,0,1,1,0,0,2,0,1,2,1,0,0,1,0,2,2,0,0,0,0,0,0,0,0,2,1,3,0,0,0,1,1,0,0,0,2,0,1,0,1,0,1,0,0,1,0,0,0,0,1,1,0,0,2,1,1,1,1,1,0,-43])
--------------------
```

![](https://storage.googleapis.com/zenn-user-upload/fd948f8f8490-20251214.png)

## å®Ÿé¨“
è¿·è·¯ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€å‰¯ç”£ç‰©ã¨ã—ã¦è¿·è·¯ã‚’åˆ¶å¾¡ã™ã‚‹ç¾¤æ§‹é€ ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚ã“ã®ç¾¤æ§‹é€ ã‚’åˆ©ç”¨ã—ã¦ãªã«ã‹é¢ç™½ã„ã“ã¨ãŒã§ããªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿä¾‹ãˆã°ã‚ã‚‹éƒ¨åˆ†ç¾¤ã®å€¤ã‚’å›ºå®šã—ã¦æ®‹ã‚Šã®æˆåˆ†ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€å¥½ããªåã‚Šã‚’æŒãŸã›ãŸè¿·è·¯ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ãŸã‚Šã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã¾ãšå˜ä½å…ƒã«å¯¾å¿œã™ã‚‹ã®ã¯ã©ã‚“ãªè¿·è·¯ã§ã—ã‚‡ã†ã‹ï¼Ÿç ‚å±±ç¾¤ã®å˜ä½å…ƒã¯å¯¾è±¡æ€§ã®é«˜ã„ç¶ºéº—ãªæ¨¡æ§˜ã«ãªã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ãŒè¿·è·¯ã¯ã©ã†ã§ã—ã‚‡ã†ï¼Ÿè©¦ã—ã«ä¸Šè¿°ã®çœŸã‚“ä¸­ã«ç©´ã®ç©ºã„ãŸ $9\times 9$ ã®ãƒã‚¹ç›®ã®ã‚°ãƒ©ãƒ•ã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®å˜ä½å…ƒã«å¯¾å¿œã™ã‚‹è¿·è·¯ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/37a73fdd85d1-20251214.png =300x)

ã“ã‚Œã¯Algorithm 2ã§åˆ©ç”¨ã™ã‚‹è¾ºã®é †åºã«å¼·ãä¾å­˜ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå‡ºã¦ãã¦ã„ã¾ã™ã­ã€‚

æ¬¡ã« $4\times 4$ ã®æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã‚°ãƒ©ãƒ•ã®å˜å› å­ã¯ $1,1,4$ ãªã®ã§ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¯ ${\mathbb Z}/4{\mathbb Z}$ ã§ã™ã€‚${\mathbb Z}/4{\mathbb Z}$ ã®å…ƒ $\{0,1,2,3\}$ ã«å¯¾å¿œã™ã‚‹è¿·è·¯ã¯

![](https://storage.googleapis.com/zenn-user-upload/733f25f5736c-20251214.png)

ã®æ§˜ã«ãªã£ã¦ãŠã‚Šã€é€£çµã—ã¦ã„ãªã„éƒ¨åˆ†ãŒåæ™‚è¨ˆå›ã‚Šã«å›è»¢ã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã‚‚ã†ä¸€å›ã‚Šå¤§ãã„ã‚°ãƒ©ãƒ•ã§ã‚‚è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãª $3\times 3$ ã®ãƒã‚¹ç›®ã®çœŸã‚“ä¸­ã«ç©´ã‚’é–‹ã‘ãŸã‚°ãƒ©ãƒ•ã‚’è€ƒãˆã¾ã™ã€‚

```hs
main :: IO ()
main = do
  let grid = [ [Just  0, Just  1, Just 2]
             , [Just  3, Nothing, Just 4]
             , [Just  5, Just  6, Just 7]
             ] :: Grid 8
-- ï¼ˆä»¥ä¸‹åŒã˜ï¼‰
```

ã“ã®ã‚°ãƒ©ãƒ•ã®å˜å› å­ã¯ $\{1,1,1,1,1,1,8\}$ ã¨ãªã£ã¦ãŠã‚Šã€ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¯ ${\mathbb Z}/8{\mathbb Z}$ ã«åŒå‹ã§ã™ã€‚${\mathbb Z}/8{\mathbb Z}$ ã®å…ƒã«å¯¾å¿œã™ã‚‹è¿·è·¯ã¯

![](https://storage.googleapis.com/zenn-user-upload/a5cacaa0dc71-20251214.png)

ã®æ§˜ã«ãªã£ã¦ãŠã‚Šã€ã“ã¡ã‚‰ã‚‚é€£çµã—ã¦ã„ãªã„éƒ¨åˆ†ãŒåæ™‚è¨ˆå›ã‚Šã«å›è»¢ã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

$4\times 4$ ã®æ­£æ–¹å½¢ã®ã‚°ãƒ©ãƒ•ã‚’1æœ¬ã®è¾ºã§é€£çµã•ã›ãŸã‚°ãƒ©ãƒ•ã ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```hs

main :: IO ()
main = do
  let grid = [ [Just  0, Just  1, Nothing, Just 2, Just 3]
             , [Just  4, Just  5, Just  6, Just 7, Just 8]
             ] :: Grid 9
-- ï¼ˆä»¥ä¸‹åŒã˜ï¼‰
```

ã“ã®ã‚°ãƒ©ãƒ•ã®å˜å› å­ã¯ $\{1,1,1,1,1,1,4,4\}$ ã¨ãªã£ã¦ãŠã‚Šã€ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¯ ${\mathbb Z}/4{\mathbb Z}\times{\mathbb Z}/4{\mathbb Z}$ ã«åŒå‹ã§ã™ã€‚${\mathbb Z}/4{\mathbb Z}\times{\mathbb Z}/4{\mathbb Z}$ ã®å…ƒã«å¯¾å¿œã™ã‚‹è¿·è·¯ã¯

![](https://storage.googleapis.com/zenn-user-upload/ef90b23486c1-20251214.png)

ã®æ§˜ã«ãªã£ã¦ãŠã‚Šã€ç¬¬ä¸€æˆåˆ†ãŒå·¦å´ã®éé€£çµéƒ¨åˆ†ã®å›è»¢ã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã§ã¯ç¬¬äºŒæˆåˆ†ãŒå³å´ã®éé€£çµéƒ¨åˆ†ã®å›è»¢ã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã‹ã¨æ€ã£ãŸã®ã§ã™ãŒã€ç¢ºã‹ã«å›è»¢ã«å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã©ã“ã‹ã‚‰å›è»¢ã™ã‚‹ã®ã‹ãŒç¬¬ä¸€æˆåˆ†ã«ä¾å­˜ã—ã¦ã„ã¦å˜ç´”ãªè¡¨ç¾ã«ã¯ãªã£ã¦ã„ãªã•ãã†ã§ã™ã€‚

ã‚‚ã£ã¨è‰²ã€…ãªã‚°ãƒ©ãƒ•ã§è©¦ã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€æ˜æ—¥ãŒæœ¬ç¨¿ã®å…¬é–‹æ—¥ã¨ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã“ã®ã‚ãŸã‚Šã§åˆ‡ã‚Šä¸Šã’ãŸã„ã¨æ€ã„ã¾ã™ã€‚å®Ÿè£…ã«åŸå› ãŒã‚ã‚‹ã®ã‹ã€ã¯ãŸã¾ãŸCoriâ€“Le Borgne bijectionã®æ€§è³ªãªã®ã‹ã€ã‚‚ã—ä½•ã‹çŸ¥ã£ã¦ã„ãŸã‚Šæ°—ã¥ã„ãŸäººãŒã„ãŸã‚‰æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

## ãŠã‚ã‚Šã«
ã‚°ãƒ©ãƒ•ã®å…¨åŸŸæœ¨ã‚’ä¸€æ§˜ã«ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¯ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ã‚’åˆ©ç”¨ã—ãŸã‚‚ã®ãŒã‚ã‚Šã“ã¡ã‚‰ã®æ–¹ãŒè€ƒãˆæ–¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§é«˜é€ŸåŒ–ã‚‚å¯èƒ½ã§ã™[^8][^13]ã€‚æœ¬ç¨¿ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã‚°ãƒ©ãƒ•ä¸Šã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¨ã„ã†ä»£æ•°æ›²ç·šè«–ã«ãŠã‘ã‚‹æ•°å­¦çš„å¯¾è±¡ã®ã‚°ãƒ©ãƒ•ä¸Šã®é¡ä¼¼ç‰©ã‚’æ´»ç”¨ã—ã¦ã„ã¦ã€å…¨åŸŸæœ¨ã®æ§‹é€ ã‚’ã‚ˆã‚Šæ·±ãçŸ¥ã‚Œã‚‹ã®ãŒé¢ç™½ã„ã¨æ€ã„ç´¹ä»‹ã—ã¾ã—ãŸã€‚ã‚°ãƒ©ãƒ•ã«ãŠã‘ã‚‹ä»£æ•°æ›²ç·šè«–ã®é¡ä¼¼ã¯ä»–ã«ã‚‚ã‚¢ãƒ¼ãƒ™ãƒ«ãƒ¤ã‚³ãƒ“ã®å®šç†ã‚„ãƒªãƒ¼ãƒãƒ³ãƒ»ãƒ­ãƒƒãƒ›ã®å®šç†ã®é¡ä¼¼[^9]ã€å²©æ¾¤ç†è«–ã®é¡ä¼¼ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™[^10]ã€‚ã“ã‚Œã‚‰ã®å¯¾å¿œã¯é‡ã¿ä»˜ãã‚°ãƒ©ãƒ•ã‚„ãƒˆãƒ­ãƒ”ã‚«ãƒ«å¹¾ä½•å­¦ã¸ã®æ‹¡å¼µã‚‚ç ”ç©¶ã•ã‚Œã¦ã„ã¾ã™[^11][^12]ã€‚ã‚°ãƒ©ãƒ•ç†è«–ã¨ä»£æ•°æ›²ç·šè«–ã®ç†è«–çš„ãªã¤ãªãŒã‚Šã¨ã—ã¦ã€ä»£æ•°æ›²ç·šã®Berkovichç©ºé–“ã«ãŠã‘ã‚‹å¤‰ä½ãƒ¬ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šå¾—ã‚‰ã‚Œã‚‹ã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼ˆã‚°ãƒ©ãƒ•ï¼‰ã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ãŒã€å…ƒã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã®ãƒˆãƒ­ãƒ”ã‚«ãƒ«åŒ–ã«ã‚ˆã‚Šå¾—ã‚‰ã‚Œã‚‹ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã¨åŒå‹ã«ãªã‚‹ã“ã¨ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™[^14]ã€‚
ã‚‚ã—æœ¬ç¨¿ãŒçš†ã•ã‚“ã®ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³æ¢æ±‚ã®ç³¸å£ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
æœ€å¾Œã¾ã§ãŠèª­ã¿ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

[^1]: $Lx = 0 \implies x^{\sf T}Lx = 0$ ã¯è‡ªæ˜ã€‚$Lx = 0 \impliedby x^{\sf T}Lx = 0$ ã¯ $L$ ãŒåŠæ­£å®šå€¤è¡Œåˆ—ã§ã‚ã‚‹ã“ã¨ã‚ˆã‚Šã€ã‚ã‚‹å®Ÿæ­£æ–¹è¡Œåˆ—$B$ãŒå­˜åœ¨ã—ã¦$L=B^{\sf T}B$ã¨ãªã‚Š$x^{\sf T}Lx = (Bx)^{\sf T}Bx = \|Bx\| = 0 \iff Bx = 0$ã€‚ã‚ˆã£ã¦ $Lx = B^{\sf T}Bx = 0$
[^2]: ä»£æ•°æ›²ç·šã«ãŠã‘ã‚‹ä¸»å› å­ã¯æœ‰ç†å‹é–¢æ•°ã®æ¥µã‚„é›¶ç‚¹ã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ãŸã‚ã€æœ¬ç¨¿ã§ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³è¡Œåˆ—ã®åƒã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸä¸»å› å­ã¨ã®é–¢é€£ã¯æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ $\Delta$ ã‚’ $\Delta = \frac{\partial^2}{\partial x^2}+\frac{\partial^2}{\partial y^2}$ ã¨ã—ã¦æœ‰ç†å‹é–¢æ•° $f$ ã¨ãã®é–¢æ•° $\log|f|$ ã‚’è€ƒãˆã‚‹ï¼ˆã“ã¡ã‚‰ãŒ ${\mathcal M}(G)$ ã®å…ƒã«å¯¾å¿œã™ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ï¼‰ã¨ã€ä¾‹ãˆã° $f = z$ ãªã‚‰ $\Delta\log|f|$ ã¯ $z\neq 0$ ã§ã¯ $0$ ã«ãªã‚Šã¾ã™ãŒ $z=0$ ã‚ã‚‹ã„ã¯ $z=\infty$ã§ã¯ç™ºæ•£ã—ã¾ã™ã€‚ã“ã‚Œã‚’ $\Delta\log|f| = \delta_0 - \delta_\infty$ ï¼ˆ$\delta$ ã¯ãƒ‡ãƒ«ã‚¿é–¢æ•°ï¼‰ã¨è§£é‡ˆã™ã‚Œã°ãƒ©ãƒ—ãƒ©ã‚¹ä½œç”¨ç´ ã¨æœ‰ç†å‹é–¢æ•°ã®æ¥µã¨é›¶ç‚¹ã®é–“ã®å¯¾å¿œãŒè¦‹ãˆã¦ãã‚‹ã§ã—ã‚‡ã†ã€‚ã“ã®ã‚ˆã†ãªå¯¾å¿œã¯ã€å³å¯†ã«ã¯è¶…é–¢æ•°ã‚’å¾®åˆ†å½¢å¼ã«æ‹¡å¼µã—ãŸã‚«ãƒ¬ãƒ³ãƒˆç†è«–ã§è­°è«–ã•ã‚Œã€PoincarÃ©â€“Lelongã®å…¬å¼ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™
[^3]: ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã¨ã„ã†å‘¼ç§°ã¯ä»£æ•°æ›²ç·šã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ï¼ˆãƒ¤ã‚³ãƒ“è¡Œåˆ—ã§ã¯ãªã[ãƒ¤ã‚³ãƒ“å¤šæ§˜ä½“](https://ja.wikipedia.org/wiki/%E3%83%A4%E3%82%B3%E3%83%93%E5%A4%9A%E6%A7%98%E4%BD%93)ã®æ–¹ï¼‰ã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™
[^4]: ã“ã‚Œã‚‰ã®ã€Œã‚¨ãƒãƒ«ã‚®ãƒ¼ã€ã¨ã„ã†å‘¼ç§°ã¯ã‚°ãƒ©ãƒ•ã‚’é›»æ°—å›è·¯ã¨ã¿ãªã—ãŸã¨ãã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ã‹ã‚‰æ¥ã¦ã„ã¾ã™
[^5]: æœ‰ç†æ•°ã¯ä½“ãªã®ã§é€šå¸¸ã®ç·šå½¢ä»£æ•°ã®è­°è«–ãŒã§ãã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ã¨ [ç·šå‹ä»£æ•°å­¦ã®åŸºæœ¬å®šç†](https://ja.wikipedia.org/wiki/%E7%B7%9A%E5%9E%8B%E4%BB%A3%E6%95%B0%E5%AD%A6%E3%81%AE%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86)ã‚ˆã‚Š $L$ ã®åƒã¯è»¢ç½®è¡Œåˆ—ã®æ ¸ã®ç›´äº¤è£œç©ºé–“ã«ä¸€è‡´ã™ã‚‹ã€‚ã¤ã¾ã‚Š $\operatorname{Im}L=(\operatorname{Ker}L^{\sf T})^{\perp}=(\operatorname{Ker}L)^{\perp}$ã€‚$\operatorname{Ker}L$ ã¯å®šæ•°ãƒ™ã‚¯ãƒˆãƒ«ãŒå¼µã‚‹ç©ºé–“ãªã®ã§ $v\in\operatorname{Im}L\iff v\cdot 1 = 0\iff \sum v = 0$ ã‚ˆã‚Šã€æˆåˆ†ã®ç·å’ŒãŒ0ã«ãªã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã¯$\operatorname{Im}L$ ã«å«ã¾ã‚Œã¦ãŠã‚Šé€†åƒã‚’å–ã‚Œã‚‹
[^6]: æ–‡çŒ®ã«ã‚ˆã£ã¦ã¯ä¸€èˆ¬åŒ–é€†è¡Œåˆ—ã¨æ“¬ä¼¼é€†è¡Œåˆ—ã‚’åŒºåˆ¥ã›ãšã«ç”¨ã„ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€æœ¬ç¨¿ã§ã¯ $AA^+A=A$ ã‚’æº€ãŸã™è¡Œåˆ—ã‚’ä¸€èˆ¬åŒ–é€†è¡Œåˆ—ã€ãã®ä¸­ã§ã‚‚ç‰¹æ®Šãªãƒ ãƒ¼ã‚¢ãƒ»ãƒšãƒ³ãƒ­ãƒ¼ã‚ºç–‘ä¼¼é€†è¡Œåˆ—ã‚’å˜ã«æ“¬ä¼¼é€†è¡Œåˆ—ã¨å‘¼ã‚“ã§åŒºåˆ¥ã—ã¦ã„ã¾ã™ã€‚å®Ÿã¯å…ˆè¿°ã—ãŸã‚¨ãƒãƒ«ã‚®ãƒ¼å¯¾ã¯æ“¬ä¼¼é€†è¡Œåˆ—ã§ã¯ãªãä¸€èˆ¬åŒ–é€†è¡Œåˆ—ã‚’ä½¿ã£ã¦å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™
[^7]: [Grigory Mikhalkin and Ilia Zharkov. "Tropical curves, their Jacobians and Theta functions"](https://arxiv.org/abs/math/0612267)
[^8]: [David J. Aldous. "The random walk construction of uniform spanning trees and uniform labelled trees."](https://www.cs.cmu.edu/~15859n/RelatedWork/AldousRandomTrees.pdf)
[^9]: [Baker, Matthew, and Serguei Norine. "Riemannâ€“Roch and Abelâ€“Jacobi theory on a finite graph."](https://arxiv.org/abs/math/0608360)
[^10]: [Gonet, Sophia R. "Iwasawa theory of Jacobians of graphs."](https://arxiv.org/abs/2106.11221)
[^11]: [Mikhalkin, Grigory, and Ilia Zharkov. "Tropical curves, their Jacobians and theta functions."](https://arxiv.org/abs/math/0612267v2)
[^12]: [Gathmann, Andreas, and Michael Kerber. "A Riemannâ€“Roch theorem in tropical geometry."](https://arxiv.org/abs/math/0612129)
[^13]: [Schild, Aaron. "An almost-linear time algorithm for uniform random spanning tree generation."](https://arxiv.org/abs/1711.06455)
[^14]: [Baker, Matthew, and Joseph Rabinoff. "The skeleton of the Jacobian, the Jacobian of the skeleton, and lifting meromorphic functions from tropical to algebraic curves."](https://arxiv.org/abs/1308.3864)