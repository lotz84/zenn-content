---
title: "éšä¼´ã‚’ä½¿ã£ã¦ç†è§£ã™ã‚‹Stateãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…"
emoji: "ğŸ¹"
type: "tech"
topics: ["haskell", "åœè«–", "æ•°å­¦", "math"]
published: true
---
[å‰å›ã®è¨˜äº‹](https://zenn.dev/lotz/articles/8d9af0eb45a229bf3c00)ã¯é­”æ³•ã®ã‚ˆã†ã«è¦‹ãˆã‚‹Stateãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…ã‚‚ã€é †ã‚’è¿½ã£ã¦è¦‹ã¦ã„ã‘ã°ç†è§£ã™ã‚‹ã“ã¨ã¯é›£ã—ããªã„ã¨ã„ã†è©±ã§ã—ãŸã€‚

ã—ã‹ã—çŠ¶æ…‹ã®å¤‰æ›´ã‚’é †ç•ªã«å‡¦ç†ã™ã‚‹ã¨ã„ã†ã‚ˆã†ãª**æ‰‹ç¶šãçš„ãªè€ƒãˆæ–¹ã«ã‹ãªã‚Šè¿‘ã„æ§‹é€ ãŒã€ã†ã¾ããƒ¢ãƒŠãƒ‰ã«ãªã£ã¦ãã‚Œã‚‹**ã¨ã„ã†ã®ã¯å°‘ã—ä¸æ€è­°ã§ã™ã‚ˆã­ã€‚

ã“ã®è¨˜äº‹ã§ã¯

- ã‚¿ãƒ—ãƒ« `(a, b)`
- é–¢æ•° `a -> b`
- ã‚«ãƒªãƒ¼åŒ– `curry :: ((a, b) -> c) -> a -> b -> c`
- `uncurry :: (a -> b -> c) -> (a, b) -> c`

ã¨ã„ã£ãŸHaskellã®åŸºæœ¬çš„ãªè¦ç´ ãŒ**éšä¼´**ã¨å‘¼ã°ã‚Œã‚‹é–¢ä¿‚ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã‚’è¦‹ã¦ã€
ãã®**éšä¼´ã‹ã‚‰Stateãƒ¢ãƒŠãƒ‰ãŒå°ã‹ã‚Œã‚‹**ã“ã¨ã‚’èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

:::message alert
ã“ã®è¨˜äº‹ã«ã¯åœè«–ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã€ã¾ã å±¥ä¿®ã—ã¦ã„ãªã„æ–¹ã¯ã”æ³¨æ„ãã ã•ã„ã€‚
:::

## éšä¼´

äºŒã¤ã®åœ $C, D$ ã¨äºŒã¤ã®é–¢æ‰‹ $F : C \rightarrow D, G : D \rightarrow C$ ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ã—ã¾ã—ã‚‡ã†ã€‚
![](https://storage.googleapis.com/zenn-user-upload/pgyzrus7q1m3dfr982s9fcgetd9h =250x)

ã‚‚ã— $GF = {\rm 1}_C, FG = {\rm 1}_D$ ã§ã‚ã‚Œã° $C$ ã¨ $D$ ã¯**åœåŒå‹**ã§ã‚ã‚‹ã¨è¨€ã„ã¾ã™ã€‚ã“ã‚Œã¯åœã®åœ${\rm Cats}$ã«ãŠã„ã¦$C$ã¨$D$ãŒåŒå‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ãŠã‚Šã€äºŒã¤ã®åœ$C, D$ã‚’"åŒã˜"ã¨ã¿ãªã™ã¨ã¦ã‚‚å¼·ã„é–¢ä¿‚ã§ã™ã€‚

ä»Šã€$F, G$ã¯é–¢æ‰‹ã§ã‚ã‚‹ã®ã§ã€è‡ªç„¶å¤‰æ›ã‚’ä½¿ã£ã¦ã‚‚ã†å°‘ã—ã‚†ã‚‹ã„åŒå€¤é–¢ä¿‚ã‚’è€ƒãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚$GF \cong {\rm 1}_C, FG \cong {\rm 1}_D$ ã¨ã„ã†ã‚ˆã†ã«æ’ç­‰é–¢æ‰‹ã¨å³å¯†ã«ä¸€è‡´ã™ã‚‹å¿…è¦ã¯ãªãè‡ªç„¶åŒå‹ãŒå­˜åœ¨ã™ã‚‹ã¨ä»®å®šã—ãŸå ´åˆã€$C$ ã¨ $D$ ã¯**åœåŒå€¤**ã§ã‚ã‚‹ã¨è¨€ã„ã¾ã™ã€‚åœåŒå€¤ã¯ã€ä¾‹ãˆã°åœ$C$ã®å¯¾è±¡$c$ã‚’$GF$ã§å†™ã—ãŸå¯¾è±¡$GFc$ãŒå…ƒã®å¯¾è±¡$c$ã¨ä¸€è‡´ã™ã‚‹å¿…è¦ã¯ãªãåŒå‹ã§ã‚ã‚Œã°è‰¯ã„ã¨ã„ã†ã“ã¨è¨€ã£ã¦ãŠã‚Šã€åœåŒå‹ã‚ˆã‚Šã‚†ã‚‹ã„åŒå€¤é–¢ä¿‚ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«è‡ªç„¶åŒå‹ã§ã‚ã‚‹ã¨ã„ã†ä»®å®šã‚‚å¼±ã‚ã¦ã€äºŒã¤ã®è‡ªç„¶å¤‰æ› $\eta: {\rm 1}_C \rightarrow GF, \epsilon: FG \rightarrow {\rm 1}_D$ãŒå­˜åœ¨ã—ã¦å¿…è¦ãªå…¬ç†ã‚’æº€ãŸã™ã¨ä»®å®šã—ãŸå ´åˆã€**éšä¼´**ã¨å‘¼ã°ã‚Œã‚‹é–¢ä¿‚ãŒå®šã¾ã‚Šã¾ã™ã€‚æº€ãŸã™ã¹ãå…¬ç†ã¯$F, G, \eta, \epsilon$ãŒä»¥ä¸‹ã®å›³å¼ã‚’å¯æ›ã«ã™ã‚‹ã“ã¨ã§ã™ï¼ˆã“ã‚Œã‚‰ã¯**ä¸‰è§’ç­‰å¼**ã¨å‘¼ã°ã‚Œã¾ã™ï¼‰ã€‚
![](https://storage.googleapis.com/zenn-user-upload/w45jwdj4dj32evyp6ljgj5gxhj1c =500x)

ã“ã‚Œã‚‰ã®é–¢ä¿‚ã‚’æº€ãŸã™æ™‚ã€$F$ã¯$G$ã®**å·¦éšä¼´**ã€$G$ã¯$F$ã®**å³éšä¼´**ã¨å‘¼ã°ã‚Œ

$$
F \dashv G
$$

ã¨è¡¨ã—ã¾ã™ã€‚éšä¼´ã‚’æ§‹æˆã™ã‚‹ï¼’ã¤ã®è‡ªç„¶å¤‰æ›$\eta, \epsilon$ã¯ãã‚Œãã‚Œ**å˜ä½**(unit), **ä½™å˜ä½**(counit)ã¨å‘¼ã³ã¾ã™ã€‚

ãã‚ãã‚æŠ½è±¡çš„ãªè©±ã«ã‚‚ç–²ã‚Œã¦ããŸã®ã§ã€ã“ã“ã§éšä¼´ã‚’Haskellã§å®Ÿè£…ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ï¼’ã¤ã®é–¢æ‰‹ï¼ˆ`Functor`ï¼‰ãŒéšä¼´ï¼ˆ`Adjunction`ï¼‰ã®é–¢ä¿‚ã«ã‚ã‚‹ã“ã¨ã¯è‡ªç„¶å¤‰æ›ï¼ˆ`unit`, `counit`ï¼‰ã®å­˜åœ¨ã«ã‚ˆã£ã¦å®šã¾ã‚‹ã®ã§ã€ã“ã‚Œã‚’å‹ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦è¡¨ç¾ã—ã¾ã—ã‚‡ã†ã€‚

```hs
{-# LANGUAGE FunctionalDependencies #-}
{-# LANGUAGE MultiParamTypeClasses #-}

class (Functor f, Functor g) => Adjunction f g | f -> g, g -> f where
  unit :: a -> g (f a)
  counit :: f (g a) -> a
```

è‡ªç„¶å¤‰æ›ã¯å¤šç›¸é–¢æ•°ã‚’ä½¿ã£ã¦è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚ã“ã®å®Ÿè£…ã§ã¯æ’ç­‰é–¢æ‰‹`Identity`ãŒæ˜ç¤ºçš„ã«ç¾ã‚Œã¦ã„ãªã„ã“ã¨ã«ã‚‚æ³¨æ„ã—ã¦ä¸‹ã•ã„ã€‚åŒæ§˜ã®å®Ÿè£…ã¯Haskellã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª[adjunctions](https://hackage.haskell.org/package/adjunctions-4.4/docs/Data-Functor-Adjunction.html#t:Adjunction)ã«ã‚‚è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¨ã“ã‚ã§éšä¼´ã«ã¯ã‚‚ã†ä¸€ã¤åŒå€¤ãªå®šç¾©ãŒã‚ã‚Šã¾ã™ã€‚2ã¤ã®ï¼ˆå±€æ‰€å°ï¼‰åœ$C, D$ã®é–“ã®éšä¼´ã¨ã¯2ã¤ã®é–¢æ‰‹$F: C \rightarrow D, G: D \rightarrow C$ãŒå­˜åœ¨ã—ã¦ã€ã“ã‚Œã‚‰ãŒå®šã‚ã‚‹$C^{op}\times D$ã‹ã‚‰${\rm Sets}$ã¸ã®2ã¤ã®é–¢æ‰‹ãŒä»¥ä¸‹ã®ã‚ˆã†ã«è‡ªç„¶åŒå‹ã§ã‚ã‚‹ã‚‚ã®ã‚’è¨€ã„ã¾ã™ã€‚

$$
{\rm Hom}_D\left(F-, -\right) \cong {\rm Hom}_C\left(-, G-\right)
$$

ã“ã®å®šç¾©ãŒå‰è¿°ã®è‡ªç„¶å¤‰æ›$\epsilon, \eta$ã‚’å°ãã“ã¨ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†[^1]ã€‚åœ$C$ã®å„å¯¾è±¡$c$ã‚’ä½¿ã£ã¦è‡ªç„¶åŒå‹ã«$c$ã¨$Fc$ã‚’ä»£å…¥ã™ã‚Œã°

$$
{\rm Hom}_D\left(Fc, Fc\right) \cong {\rm Hom}_C\left(c, GFc\right)
$$

ã¨ã„ã†åŒå‹ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã®åŒå‹ã«ã‚ˆã‚Šæ’ç­‰å°„${\rm 1}_{Fc}$ã«å¯¾å¿œã™ã‚‹å°„ã‚’$\eta_c: c \rightarrow GFc$ã¨ãŠãã€å…¨ã¦ã®å¯¾è±¡ã«ã¤ã„ã¦åŒæ§˜ã®å°„ã‚’è€ƒãˆã‚‹ã¨è‡ªç„¶å¤‰æ›$\eta: {\rm 1}_C \rightarrow GF$ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å®Ÿéš›ã«$\eta$ãŒè‡ªç„¶å¤‰æ›ã§ã‚ã‚‹ã“ã¨ã¯å‰æã¨ãªã£ã¦ã„ã‚‹è‡ªç„¶åŒå‹ã‚’æ³¨æ„æ·±ãè¿½ãˆã°åˆ†ã‹ã‚Šã¾ã™ã€‚åŒæ§˜ã«åœ$D$ã®å„å¯¾è±¡$d$ã«ã¤ã„ã¦

$$
{\rm Hom}_D\left(FGd, d\right) \cong {\rm Hom}_C\left(Gd, Gd\right)
$$

ã¨ã„ã†åŒå‹ã‚’è€ƒãˆã¦æ’ç­‰å°„${\rm 1}_{Gd}$ã«å¯¾å¿œã™ã‚‹å°„ã‚’è€ƒãˆã‚‹ã“ã¨ã§ã€è‡ªç„¶å¤‰æ›$\epsilon: FG \rightarrow {\rm 1}_D$ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«å®šã‚ãŸ$\eta, \epsilon$ãŒä¸‰è§’ç­‰å¼ã‚’æº€ãŸã™ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

1ã¤ç›®ã®ä¸‰è§’ç­‰å¼

$$
{\rm 1}_F = \epsilon F \circ F\eta
$$

ã‚’ç¤ºã™ãŸã‚ã«åœ$C$ã®å„å¯¾è±¡$c$ã«ã¤ã„ã¦ä»¥ä¸‹ã®å›³å¼ã‚’è€ƒãˆã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ntg9nxrgsy034ynr87346mcsoqrx =400x)

ã“ã®å›³å¼ã¯è‡ªç„¶åŒå‹ã§ã‚ã‚‹ã“ã¨ã‚ˆã‚Šå¯æ›ã«ãªã‚Šã¾ã™ã€‚

å·¦ä¸Šã®${\rm Hom}_C(GFc, GFc)$ã«å±ã™ã‚‹å°„${\rm 1}_{GFc}$ã‚’ã€ã¾ãšå·¦ä¸‹ã‚’çµŒç”±ã—ã¦å³ä¸‹ã«ç§»ã™ã¨

$$
{\rm 1}_{GFc} \mapsto {\rm 1}_{GFc} \circ \eta_c = \eta_c \mapsto {\rm 1}_{Fc}
$$

ã¨ãªã‚Šã€åå¯¾ã«å³ä¸Šã‚’çµŒç”±ã—ã¦å³ä¸‹ã«ç§»ã™ã¨

$$
{\rm 1}_{GFc} \mapsto \epsilon_{Fc} \mapsto \epsilon_{Fc} \circ F\eta_c
$$

ã¨ãªã‚Šå›³å¼ãŒå¯æ›ã§ã‚ã‚‹ã“ã¨ã‚ˆã‚Š

$$
{\rm 1}_{Fc} = \epsilon_{Fc} \circ F\eta_c
$$

ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ä»»æ„ã®å¯¾è±¡ã«ã¤ã„ã¦æˆã‚Šç«‹ã¤ã®ã§1ã¤ç›®ã®ä¸‰è§’ç­‰å¼ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚2ã¤ç›®ã®ä¸‰è§’ç­‰å¼ã‚‚åŒæ§˜ã«ç¤ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã¦ã€ã“ã“ã‹ã‚‰ã¯Haskellã®å®Ÿè£…ã«æˆ»ã‚Šã¾ã—ã‚‡ã†ã€‚éšä¼´ã®åˆ¥ã®å®šç¾©ã‚’çŸ¥ã£ãŸã®ã§`Adjunction`ã®å®Ÿè£…ã«åæ˜ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```hs
class (Functor f, Functor g) => Adjunction f g | f -> g, g -> f where
  unit :: a -> g (f a)
  counit :: f (g a) -> a

  leftAdjunct :: (f a -> b) -> a -> g b
  rightAdjunct :: (a -> g b) -> f a -> b

  unit = leftAdjunct id
  counit = rightAdjunct id
```

`leftAdjunct`ã¨`rightAdjunct`ã¯è‡ªç„¶åŒå‹ã«ãŠã‘ã‚‹å…¨å˜å°„ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã«æ’ç­‰å°„`id`ã‚’ä¸ãˆã¦è©•ä¾¡ã™ã‚‹ã“ã¨ã§`unit`, `counit`ãŒå‡ºã¦ãã‚‹ã®ã¯ä¸Šè¿°ã—ãŸè¨¼æ˜ã®æµã‚Œã¨å¯¾å¿œã—ã¦ã„ã¦ã¨ã¦ã‚‚ç¶ºéº—ã§ã™ã­ï¼

## éšä¼´ã‹ã‚‰å°ã‹ã‚Œã‚‹ãƒ¢ãƒŠãƒ‰
å®Ÿã¯éšä¼´é–¢æ‰‹ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ã€ãã“ã‹ã‚‰ãƒ¢ãƒŠãƒ‰ã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãšã¯ãƒ¢ãƒŠãƒ‰ã®å®šç¾©ã‚’æ€ã„å‡ºã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

åœ$C$ã¨è‡ªå·±é–¢æ‰‹$T: C \rightarrow C$ãŒã‚ã‚Šã€ã•ã‚‰ã«ä»¥ä¸‹ã®å›³å¼ã‚’å¯æ›ã«ã™ã‚‹è‡ªç„¶å¤‰æ›$\eta: {\rm 1}_C \rightarrow T, \mu: T^2 \rightarrow T$ãŒå­˜åœ¨ã™ã‚‹æ™‚$T, \eta, \mu$ã®çµ„ã‚’ãƒ¢ãƒŠãƒ‰ã¨å‘¼ã³ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/biwnf8f7woldfqi9g10ahk5inqci =600x)

çµè«–ã‹ã‚‰è¨€ãˆã°éšä¼´é–¢æ‰‹ $F\dashv G$ ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã«åœ$C$ä¸Šã®è‡ªå·±é–¢æ‰‹$GF$ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã‚ŒãŒãƒ¢ãƒŠãƒ‰ã«ãªã‚Šã¾ã™ã€‚è‡ªç„¶å¤‰æ›$\eta$ã¯éšä¼´ã®counitï¼ˆã¤ã¾ã‚Š$\eta$ï¼‰ã§ã‚ã‚Šã€$\mu$ã¯

$$
\mu = G\epsilon F
$$

ã¨å®šã‚ã¾ã™ã€‚

ã“ã‚Œã‚‰ãŒã¡ã‚ƒã‚“ã¨ãƒ¢ãƒŠãƒ‰ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãš1ã¤ç›®ã®å¯æ›å›³å¼ã¯

$$
\begin{matrix}
&& \mu \circ T\mu &=& \mu \circ \mu T \\
&\Leftrightarrow& G\epsilon F \circ GFG\epsilon F &=& G\epsilon F \circ G\epsilon FGF \\
\end{matrix}
$$

ã¨ãªã‚Šã¾ã™ãŒ$\epsilon$ãŒ$FG$ã‹ã‚‰$1_D$ã¸ã®è‡ªç„¶å¤‰æ›ã§ã‚ã‚‹ã®ã§åœ$C$ã®å„å¯¾è±¡$a$ã«ã¤ã„ã¦ä»¥ä¸‹ã®å›³å¼ãŒå¯æ›ã¨ãªã‚Š

![](https://storage.googleapis.com/zenn-user-upload/kgeg2bdz3g0kpe9kjlqs01jlh0bi =200x)

ã“ã®å¯æ›å›³å¼ã‚’$G$ã§å†™ã›ã°ç­‰å¼ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ã¾ãŸ2ã¤ç›®ã®å¯æ›å›³å¼ã¯

![](https://storage.googleapis.com/zenn-user-upload/gpvptikna5zkl1e4gocjokmgwdsq =300x)

ã¨ãªã‚Šã€éšä¼´ã®ä¸‰è§’ç­‰å¼ã‚’é–¢æ‰‹$F$, $G$ã§ã†ã¾ãå†™ã—ãŸã‚‚ã®ã«å¯¾å¿œã—ã¦ã„ã¦ã€æˆç«‹ã™ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ãã‚Œã§ã¯éšä¼´ã‹ã‚‰ãƒ¢ãƒŠãƒ‰ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã‚’Haskellã§å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

Haskellã§`Functor`ã‚’åˆæˆã™ã‚‹æ–¹æ³•ã¯`Data.Functor.Compose`ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å®šç¾©ãŒé‡è¤‡ã—ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã®ã§ä»Šå›ã¯è‡ªåˆ†ã§ä½œã‚Šã¾ã™ã€‚

```hs
newtype (.) g f a = Compose { getCompose :: g (f a) }
```

`.` ã‚’`Functor`ã®åˆæˆã‚’è¡¨ã™Type Operatorã¨ã—ã¦ä½¿ã†ã“ã¨ã§Functor `g`ã¨`f`ã®åˆæˆã‚’ `g . f`ã¨åˆ†ã‹ã‚Šã‚„ã™ãæ›¸ãã“ã¨ãŒã§ãã¾ã™[^2]ã€‚

Haskellã§`Monad`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ãŸã‚ã«ã¯`Functor`ã¨`Applicative`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãš`Functor`ã®å®Ÿè£…ã¯ç°¡å˜ã§ã™ã€‚

```hs
instance (Functor f, Functor g) => Functor (g . f) where
  fmap f (Compose gf) = Compose $ fmap (fmap f) gf
```

æ¬¡ã«`Applicative`ã®å®Ÿè£…ã§ã™ãŒã€ãã®å‰ã«ãƒ¢ãƒŠãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’å…ˆå–ã‚Šã—ã¦è‡ªç„¶å¤‰æ›$\mu$ã«å¯¾å¿œã™ã‚‹é–¢æ•°`join`ã‚’å®šç¾©ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```hs
join :: Adjunction f g => g (f (g (f a))) -> g (f a)
join = fmap counit

join' :: Adjunction f g => (g . f) ((g . f) a) -> (g . f) a
join' (Compose gfgf) = Compose . join $ fmap (fmap getCompose) gfgf
```

`join'` ã¯å®Ÿè£…ã®è©³ç´°ã‚’å¸åã—ã¦è¤‡é›‘ã«ãªã£ã¦ã¾ã™ãŒã€å®Ÿæ…‹ã¯`join`ã§ã™ã€‚ã“ã‚Œã¯`counit`ã€ã™ãªã‚ã¡$\epsilon$ã‚’$G$ã«ã¤ã„ã¦`fmap`ã™ã‚‹å®Ÿè£…ã«ãªã£ã¦ãŠã‚Šã€åœè«–ã§éšä¼´ã‹ã‚‰ãƒ¢ãƒŠãƒ‰ã‚’å°ãã¨ãã®æ§‹æˆã¨åŒã˜ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’ä½¿ãˆã°`Applicative`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã¾ã™ã€‚

```hs
instance Adjunction f g => Applicative (g . f) where
  pure = Compose . unit
  f <*> k = join' $ fmap (\a -> fmap ($ a) f) k
```

`pure`ã€ã¤ã¾ã‚Šãƒ¢ãƒŠãƒ‰ã«ãŠã‘ã‚‹è‡ªç„¶å¤‰æ›$\eta$ã‚‚éšä¼´ã«ãŠã‘ã‚‹$\eta$ã¤ã¾ã‚Š`unit`ãŒãã®ã¾ã¾å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

æœ€å¾Œã«`Monad`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

```hs
instance Adjunction f g => Monad (g . f) where
  f >>= m = join' $ fmap m f
```

ã“ã‚Œã§å®Œæˆã§ã™ï¼

éšä¼´`Adjunction`ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ãƒ¢ãƒŠãƒ‰`Monad`ã®å®Ÿè£…ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸğŸ‘

## Stateãƒ¢ãƒŠãƒ‰
ã•ã¦ã€ã„ã‚ˆã„ã‚ˆæœ¬é¡Œã§ã‚ã‚‹Stateãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
ãã®ãŸã‚ã«ã‚‚ã¡ã‚ã‚“éšä¼´ã«ãªã£ã¦ã„ã‚‹é–¢æ‰‹ã‚’ä½¿ã„ã¾ã™ã€‚

å®Ÿã¯åœè«–ã§ã¯ã‚ˆãçŸ¥ã‚‰ã‚ŒãŸç©ã¨ã¹ãå¯¾è±¡ã®éšä¼´ã‹ã‚‰å°ã‹ã‚Œã‚‹ãƒ¢ãƒŠãƒ‰ãŒStateãƒ¢ãƒŠãƒ‰ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚Haskellã®è¨€è‘‰ã§è¨€ãˆã°ã‚¿ãƒ—ãƒ«`(a, b)`ã¨é–¢æ•°`a -> b`ã§ã™ã€‚`Writer`ã¨`Reader`ã¨è¨€ã£ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚

ãã—ã¦ã“ã‚Œã‚‰ã®éšä¼´ã‚’å®šã‚ã‚‹`leftAdjunct`ã¨`rightAdjunct`ãŒã‚«ãƒªãƒ¼åŒ–ã¨ãã®é€†ã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ã™ã€‚

å®Ÿéš›ã«å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```hs
curry' :: ((b, a) -> c) -> a -> b -> c
curry' f a b = f (b, a)

uncurry' :: (a -> b -> c) -> (b, a) -> c
uncurry' f (b, a) = f a b

instance Adjunction ((,) b) ((->) b) where
  leftAdjunct = curry'
  rightAdjunct = uncurry'
```

Haskellã§ã¯ã‚¿ãƒ—ãƒ«ã®å³å´ã ã‘å‹ã‚’é©å¿œã—ãŸå‹ã‚’æ‰‹è»½ã«ä½œã‚Œãªã„ã®ã§ã€å¼•æ•°ã®é †ç•ªãŒå°‘ã—é•ã†`curry`ã‚„`uncurry`ã‚’å†å®Ÿè£…ã—ã¦ã„ã¾ã™ãŒæœ¬è³ªã¯å¤‰ã‚ã‚Šã¾ã›ã‚“[^3]ã€‚

ã¨ã“ã‚ã§ã‚‚ã†Stateãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…ãŒçµ‚ã‚ã£ã¦ã„ã‚‹ã“ã¨ã«ãŠæ°—ã¥ãã§ã—ã‚‡ã†ã‹ï¼Ÿ
éšä¼´é–¢æ‰‹ãŒå®šã¾ã‚Œã°ãƒ¢ãƒŠãƒ‰ã¯è‡ªå‹•çš„ã«æ‰‹ã«å…¥ã‚‹ã®ã§ã€

```hs
type State s = ((->) s) . ((,) s)
```

ã“ã‚Œã§çµ‚ã‚ã‚Šã§ã™ï¼

å‰å›å®šç¾©ã—ãŸStateãƒ¢ãƒŠãƒ‰ã®å‹ãŒ

```hs
newtype State s a = State { runState :: s -> (s, a) }
```

ã§ã‚ã£ãŸã“ã¨ã‚’æ€ã„å‡ºã™ã¨ç¢ºã‹ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã­ã€‚

ã‚‚ã¡ã‚ã‚“`get`ã‚„`set`ã‚’å®šç¾©ã—ã¦æ™®é€šã®Stateãƒ¢ãƒŠãƒ‰ã®ã‚ˆã†ã«ä½¿ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

æœ€å¾Œã«ç­‰å¼è«–è¨¼ã‚’ä½¿ã£ã¦éšä¼´ã‚’ä½¿ã£ãŸãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…ãŒæ‰‹ç¶šãçš„ãªå®Ÿè£…ã¨å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦çµ‚ã‚ã‚Šã¾ã—ã‚‡ã†ã€‚å°‘ã—é•·ã„ã§ã™ãŒä¸å¯§ã«å±•é–‹ã—ã¦ã„ãã¾ã™ã€‚

```hs
f >>= m = join' $ fmap m f

<=> {- join' ã‚’å±•é–‹ -}

f >>= m = (\(Compose gfgf) -> Compose . join $ fmap (fmap getCompose) gfgf) $ fmap m f

<=> {- ãƒ©ãƒ ãƒ€å¼ã‚’é©ç”¨ -}

f >>= m = Compose . join $ fmap (fmap getCompose) (getCompose $ fmap m f)

<=> {- f = Compose $ \s -> getCompose f s -}

f >>= m = Compose . join $ fmap (fmap getCompose)
  (getCompose $ fmap m (Compose $ \s -> getCompose f s))

<=> {- getCompose f s = let (s', a) = getCompose f s in (s', a) -}

f >>= m = Compose . join $ fmap (fmap getCompose)
  (getCompose $ fmap m (Compose $ \s -> let (s', a) = getCompose f s in (s', a)))

<=> {- fmap m ã‚’è©•ä¾¡ -}

f >>= m = Compose . join $ fmap (fmap getCompose)
  (getCompose $ (Compose $ \s -> let (s', a) = getCompose f s in (s', m a)))

<=> {- getCompose . Compose = id -}

f >>= m = Compose . join $ fmap (fmap getCompose)
  (\s -> let (s', a) = getCompose f s in (s', m a))

<=> {- join = fmap counit = fmap (rightAdjunct id) = fmap (uncurry' id) = fmap (\(b, f) -> f b) -}

f >>= m = Compose . fmap (\(b, f) -> f b) $ fmap (fmap getCompose)
  (\s -> let (s', a) = getCompose f s in (s', m a))

<=> {- fmap èåˆå‰‡ -}

f >>= m = Compose $ fmap ((\(b, f) -> f b) . (fmap getCompose))
  (\s -> let (s', a) = getCompose f s in (s', m a))

<=> {- fmap é©ç”¨ -}

f >>= m = Compose $ \s ->
  let (s', a) = getCompose f s
  in (\(b, f) -> f b) . (fmap getCompose) $ (s', m a)

<=> {- inã®ä¸­ã‚’è©•ä¾¡ -}

f >>= m = Compose $ \s ->
  let (s', a) = getCompose f s
  in getCompose (m a) s'
```

å‰å›ã®ãƒ¢ãƒŠãƒ‰ã®å®Ÿè£…ã¨æ¯”è¼ƒã—ã¦ã¿ã‚‹ã¨è¦‹äº‹ã«å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã­ğŸ‘

```hs
instance Monad (State s) where
  f >>= m = State $ \s ->
    let (s', a) = runState f s
     in runState (m a) s'
```

## ã‚ã¨ãŒã
éšä¼´ã‚’ä½¿ã£ã¦Stateãƒ¢ãƒŠãƒ‰ãŒå®šç¾©ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€æ‰‹ç¶šãçš„ãªå®Ÿè£…ã¨ã¡ã‚ƒã‚“ã¨å¯¾å¿œã™ã‚‹ã“ã¨ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚éšä¼´ã«çºã‚ã‚‹é¢ç™½ã„è©±ã¯ã¾ã ã¾ã ã‚ã‚‹ã®ã§æ›´ã«çŸ¥ã‚ŠãŸã„äººã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãŸã©ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

- [From Adjunctions to Monads](https://www.stephendiehl.com/posts/adjunctions.html) éšä¼´ã‹ã‚‰ãƒ¢ãƒŠãƒ‰ã®å°å‡ºã‚’ã‚¹ãƒˆãƒªãƒ³ã‚°å›³ãªã©äº¤ãˆã¦è§£èª¬ã•ã‚Œã¦ã„ã¾ã™
- [éšä¼´ãŒãƒ¢ãƒ†ãªã„ã®ã¯ã©ã†è€ƒãˆã¦ã‚‚ãƒ¢ãƒŠãƒ‰ãŒæ‚ªã„ï¼ï¼ˆãƒ¢ãƒŠãƒ‰ã¨ã‚³ãƒ¢ãƒŠãƒ‰ã®é–¢ä¿‚ãŒåˆ†ã‹ã‚‹è©±ï¼‰](http://kagamilove0707.hatenablog.com/entry/2014/11/02/210400#fn-8ae3ae26) å®Ÿã¯éšä¼´é–¢æ‰‹ã‚’åå¯¾å‘ãã«çµ„ã¿åˆã‚ã›ã‚‹ã¨ã‚³ãƒ¢ãƒŠãƒ‰ã‚’å°å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Stateãƒ¢ãƒŠãƒ‰ã®åå¯¾ã¯Storeã‚³ãƒ¢ãƒŠãƒ‰
- [Haskellã¨éšä¼´](https://qiita.com/myuon_myon/items/d598480e4edd7a780ea7) ã‚¿ãƒ—ãƒ«ã¨é–¢æ•°ä»¥å¤–ã«ã‚‚èˆˆå‘³æ·±ã„éšä¼´ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™

----

ï¼¼èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼ï¼
ã“ã®è¨˜äº‹ãŒé¢ç™½ã‹ã£ãŸã‚‰ ã„ã„ã­â™¡ ã‚’ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™â˜ºï¸
ãƒãƒƒã‚¸ã‚’è´ˆã£ã¦ã„ãŸã ã‘ã‚Œã°æ¬¡ã®è¨˜äº‹ã‚’æ›¸ããŸã‚åŠ±ã¿ã«ãªã‚Šã¾ã™ğŸ™Œ

[^1]: å®šç¾©ãŒåŒå€¤ã§ã‚ã‚‹ã“ã¨ã‚’è¦‹ã‚‹ã«ã¯åå¯¾å‘ãã®è¨¼æ˜ã‚‚å¿…è¦ã§ã™ãŒã€é•·ããªã‚‹ã®ã§æ°—ã«ãªã‚‹äººã¯Wikipediaã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„ï¼ˆ[4.2	ä½™å˜ä½-å˜ä½éšä¼´ãŒhomé›†åˆéšä¼´ã‚’å°ãã“ã¨](https://ja.wikipedia.org/wiki/%E9%9A%8F%E4%BC%B4%E9%96%A2%E6%89%8B#%E4%BD%99%E5%8D%98%E4%BD%8D-%E5%8D%98%E4%BD%8D%E9%9A%8F%E4%BC%B4%E3%81%8Chom%E9%9B%86%E5%90%88%E9%9A%8F%E4%BC%B4%E3%82%92%E5%B0%8E%E3%81%8F%E3%81%93%E3%81%A8)ï¼‰ã€‚
[^2]: `.` ãŒType Operatorã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯[GHC8.8.1ã‹ã‚‰](https://downloads.haskell.org/ghc/8.8.1-alpha1/docs/html/users_guide/8.8.1-notes.html#language)ã®ã‚ˆã†ã§ã™ï¼ˆ[Haskell-jpã‚‚ãã‚‚ãä¼šã§æ•™ãˆã¦ã‚‚ã‚‰ã„ã¾ã—ãŸ](https://haskell-jp.slack.com/archives/CUPBC8WCE/p1600583449021700?thread_ts=1600582885.020400&cid=CUPBC8WCE)ï¼‰
[^3]: å‰å›ã®è¨˜äº‹ã§ã‚‚Stateãƒ¢ãƒŠãƒ‰ã®å‹ãŒtransformersã¨ã‚ºãƒ¬ãŸã®ã¯ã“ã‚ŒãŒåŸå› ã§ã™ğŸ˜…