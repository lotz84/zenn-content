---
title: "ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¨ Combinatorial Species"
emoji: "ğŸ¥‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Haskell"]
published: true
---

ã“ã‚Œã¯[ã€ŒHaskell Advent Calendar 2024ã€](https://qiita.com/advent-calendar/2024/haskell)9æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

---

[ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹](https://ja.wikipedia.org/wiki/%E4%BB%A3%E6%95%B0%E7%9A%84%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B)ã¯ç°¡æ½”æ€§ã‚’ä¿ã¡ãªãŒã‚‰å‹å®‰å…¨ã§è¡¨ç¾åŠ›è±Šã‹ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚æ¬ ã‹ã›ãªã„å­˜åœ¨ã§ã™ã€‚ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®åŸå‹ã¯1966å¹´ã«LandinãŒææ¡ˆã—ãŸ[ISWIM](https://ja.wikipedia.org/wiki/ISWIM)ã«è¦‹ã‚‰ã‚Œã¾ã™ã€‚ãã®å¾Œã€1977å¹´ã«[NPL](https://en.wikipedia.org/wiki/NPL_(programming_language))ã¨ã„ã†é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã«å®Ÿè£…ã•ã‚Œã€Standard MLã‚„Mirandaã€Haskellã«å®Ÿè£…ã•ã‚Œã¦ã„ãã¾ã—ãŸ[^1]ã€‚Haskellã«ãŠã„ã¦ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¯å‹ã® **ç›´å’Œ** ã¨ **ç›´ç©** ãŒè¡¨ç¾ã§ãã€**å†å¸°çš„ãªå®šç¾©** ï¼ˆ[å†å¸°ãƒ‡ãƒ¼ã‚¿å‹](https://ja.wikipedia.org/wiki/%E5%86%8D%E5%B8%B0%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B)ï¼‰ã‚‚å¯èƒ½ã§ã™ã€‚

```hs
-- ç›´å’Œå‹ï¼ˆEither a b ã¨ç­‰ä¾¡ï¼‰
data Sum a b = A a | B b

-- ç›´ç©å‹ï¼ˆã‚¿ãƒ—ãƒ« (a, b) ã¨ç­‰ä¾¡ï¼‰
data Product a b = Product a b

-- å†å¸°ãƒ‡ãƒ¼ã‚¿å‹ã®ä¾‹
data List a = Nil | Cons a (List a)
```

ã“ã®ç›´å’Œã¨ç›´ç©ã¨ã„ã†æ¼”ç®—ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ãŒ "ä»£æ•°çš„" ã¨å‘¼ã°ã‚Œã‚‹æ‰€ä»¥ã§ã™ãŒã€ã“ã‚Œã‚‰ã®æ“ä½œãŒæœ¬å½“ã«å’Œã¨ç©ã«å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã—ã‚‡ã†ã‹ï¼Ÿä¾‹ãˆã°ryota-kaæ°ã®[ã€ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¨åˆç­‰ä»£æ•°å­¦ã€](https://blog.ryota-ka.me/posts/2018/07/09/algebraic-data-types-and-elementary-algebra)ã§ã¯åŸºæœ¬çš„ãªä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã« $0, 1, 2 \dots$ ã¨ã„ã†åå‰ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ç›´å’Œã‚„ç›´ç©ã¨ã„ã£ãŸæ“ä½œãŒã“ã‚Œã‚‰ã®åå‰ã‹ã‚‰é€£æƒ³ã•ã‚Œã‚‹ **è‡ªç„¶æ•°ã®ä»£æ•°çš„ãªæ¼”ç®—ãŒæº€ãŸã™æ€§è³ªã¨ä¸€è‡´ã™ã‚‹ã“ã¨** ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸBurgetæ°ã® ["The algebra (and calculus!) of algebraic data types"](https://codewords.recurse.com/issues/three/algebra-and-calculus-of-algebraic-data-types) ã§ã¯é›†åˆã¨å¯¾å¿œä»˜ãã‚ˆã†ãªå‹ã‚’ç”¨ã„ã¦[^2]ãã®å€¤ã®æ•°ã‚’æ•°ãˆã‚‹ã“ã¨ã«ã‚ˆã‚Š **ã€Œå‹ã®ç›´å’Œã¨ç›´ç©ã€ã¨ã€Œé›†åˆã®ç›´å’Œã¨ç›´ç©ã€ã®ä¸€è‡´** ã‚’è¦‹ã‚‹ã“ã¨ã§ã€ä»£æ•°çš„ãªæŒ¯ã‚‹èˆã„ã®ç›´æ„Ÿçš„ãªè§£èª¬ã‚’è©¦ã¿ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®å¯¾å¿œã‚’è¡¨ã«ã¾ã¨ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

|å‹   |é›†åˆ  |è¦ç´ ã®æ•°|
|:---:|:---:|:---:|
|`data Void`|$\emptyset$|$0$|
|`data One = One`|$\{*\}$|$1$|
|`type Two = Sum One One`|$\{*\}+\{*\}$|$1+1=2$|
|`data Maybe a = Nothing \| Just a`|$\{*\} + A$|$1+\|A\|$|
|`data Sum a b = A a \| B b`|$A \sqcup B$|$\|A\|+\|B\|$|
|`data Product a b = Product a b`|$A \times B$|$\|A\|\times\|B\|$|
|`a -> b`|$B^A$|$\|B\|^{\|A\|}$|

ï¼ˆã“ã“ã§ $\sqcup$ ã¯2ã¤ã®é›†åˆã®[éäº¤å’Œ](https://ja.wikipedia.org/wiki/%E9%9D%9E%E4%BA%A4%E5%92%8C)ã‚’è¡¨ã™ï¼‰

æœ¬ç¨¿ã§ã¯ã“ã®

1. å‹ã‹ã‚‰
2. é›†åˆã«å¯¾å¿œä»˜ã‘
3. è¦ç´ ã®æ•°ã‚’æ•°ãˆã‚‹

ã¨ã„ã†ç¿»è¨³ã®æµã‚Œã‚’å‚è€ƒã«ã€é›†åˆã§ã¯ãªã **Combinatorial Species** ã¨ã„ã†æ¦‚å¿µã‚’è€ƒãˆã‚‹ã“ã¨ã§ã€ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã«å¯¾ã™ã‚‹ã¾ãŸåˆ¥ã®è¦‹æ–¹ãŒã§ãã‚‹ã“ã¨ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/73504855b630-20241207.png =200x)

## Combinatorial Species
æœ‰é™é›†åˆã‚’å¯¾è±¡ã¨ã—å…¨å˜å°„ã‚’å°„ã¨ã™ã‚‹ã‚ˆã†ãªåœ${\mathcal B}$ã®è‡ªå·±é–¢æ‰‹$F$ã‚’ [Combinatorial Species](https://en.wikipedia.org/wiki/Combinatorial_species) ã¨å‘¼ã³ã¾ã™ã€‚

$$
F: {\mathcal B} \to {\mathcal B}
$$

ä¾‹ãˆã°é›†åˆã«ãã®éƒ¨åˆ†é›†åˆæ—ã‚’å¯¾å¿œã•ã›ã‚‹ã‚ˆã†ãªé–¢æ‰‹ã¯ Combinatorial Species ã®ä¾‹ã§ã™ã€‚ä»–ã«ã‚‚é›†åˆã«ãã®è¦ç´ ã‚’é ‚ç‚¹ã¨ã™ã‚‹ã‚°ãƒ©ãƒ•å…¨ã¦ã®é›†åˆã‚’å¯¾å¿œã•ã›ã‚‹é–¢æ‰‹ã‚„é›†åˆã«ãã®è¦ç´ ã‚’ãƒãƒ¼ãƒ‰ã¨ã™ã‚‹æœ¨æ§‹é€ å…¨ã¦ã®é›†åˆã‚’å¯¾å¿œã•ã›ã‚‹é–¢æ‰‹ã‚‚ Combinatorial Species ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Combinatorial Species $F$ ã¯å…ƒã®é›†åˆã‚’ãƒ©ãƒ™ãƒ«ã¨ã—ã¦ **ãƒ©ãƒ™ãƒ«ã‚’ä½•ã‚‰ã‹ã®æ§‹é€ ã«å¯¾å¿œä»˜ã‘ã‚‹ã‚‚ã®** ã§ã‚ã‚Šã€åœ ${\mathcal B}$ ã®å°„ãŒå…¨å˜å°„ã§ã‚ã‚‹ã“ã¨ã¯ **ãƒ©ãƒ™ãƒ«ã‚’å–ã‚Šæ›ãˆã¦ã‚‚æ§‹é€ è‡ªä½“ã¯å¤‰ã‚ã‚‰ãªã„** ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ã¨è§£é‡ˆã™ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/be2c7041aefa-20241130.png)

Combinatorial Species $F$ ã«å¯¾ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå¤šé …å¼

$$
F(x) = \sum_{n\geq 0}f_n\frac{x^n}{n!}
$$

ã‚’å¯¾å¿œä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã€ã“ã®å¤šé …å¼ã¯ **æ¯é–¢æ•°ï¼ˆæŒ‡æ•°å‹æ¯é–¢æ•°ï¼‰** ã¨å‘¼ã°ã‚Œã¾ã™ã€‚ã“ã“ã§ $f_n$ ã¯ $n$ å€‹ã®è¦ç´ ã‚’æŒã¤é›†åˆ $A$ ã«å¯¾ã™ã‚‹ $FA$ ã®è¦ç´ ã®æ•° $|FA|$ ã§ã‚ã‚Šã€åœ ${\mathcal B}$ ã®å°„ãŒå…¨å˜å°„ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ $f_n$ ã¯é›†åˆ $A$ ã®é¸æŠã«ä¾ã‚‰ãš well-defined ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ä¾‹ãˆã° $n$ ç‚¹é›†åˆ $A$ ã®éƒ¨åˆ†é›†åˆã¯ $2^n$ å€‹å­˜åœ¨ã™ã‚‹ã®ã§ã€é›†åˆã«ãã®éƒ¨åˆ†é›†åˆæ—ã‚’å¯¾å¿œã•ã›ã‚‹ Combinatorial Species $F$ ã®æ¯é–¢æ•°ã¯

$$
F(x) = \sum_{n\geq 0}2^n\frac{x^n}{n!} = \sum_{n\geq 0}\frac{(2x)^n}{n!} = \exp(2x)
$$

ã¨ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5232d1d23170-20241207.png =200x)

## ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®ç¿»è¨³
**Haskell ã®ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã‚’ Combinatorial Species ã«å¯¾å¿œä»˜ã‘ã‚‹** æ–¹æ³•ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚Combinatorial Species ã¯é–¢æ‰‹ãªã®ã§ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãª `Functor` ã«ã§ãã‚‹ä¸€èˆ¬çš„ãªå‹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚

```hs
data F a = A | B1 a | B2 a | C a a | D a a a
```

ã“ã®å‹ `F` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species $F$ ã¨ã—ã¦

- ç©ºé›†åˆã«å¯¾ã—ã¦ã¯1ç‚¹é›†åˆ $A$ ã‚’å¯¾å¿œã•ã›
- 1ç‚¹é›†åˆã«å¯¾ã—ã¦ã¯ã€ãã®é›†åˆã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã‚‰ã‚ŒãŸæ§‹é€  $B_1, B_2$ ã‚’æŒã¤2ç‚¹é›†åˆã‚’å¯¾å¿œã•ã›
- 2ç‚¹é›†åˆã«å¯¾ã—ã¦ã¯ã€ãã®é›†åˆã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã‚‰ã‚ŒãŸæ§‹é€  $C$ ã‚’æŒã¤2ç‚¹é›†åˆã‚’å¯¾å¿œã•ã›ï¼ˆæ§‹é€ ã¯1ã¤ã§ã™ãŒãƒ©ãƒ™ãƒ«ã®çµ„ã¿åˆã‚ã›ãŒ2é€šã‚Šã‚ã‚‹ã®ã§2ç‚¹é›†åˆï¼‰
- 3ç‚¹é›†åˆã«å¯¾ã—ã¦ã¯ã€ãã®é›†åˆã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã‚‰ã‚ŒãŸæ§‹é€  $D$ ã‚’æŒã¤6ç‚¹é›†åˆã‚’å¯¾å¿œã•ã›ï¼ˆæ§‹é€ ã¯1ã¤ã§ã™ãŒãƒ©ãƒ™ãƒ«ã®çµ„ã¿åˆã‚ã›ãŒ6é€šã‚Šã‚ã‚‹ã®ã§6ç‚¹é›†åˆï¼‰
- ãã‚Œä»¥å¤–ã®é›†åˆã«å¯¾ã—ã¦ã¯ç©ºé›†åˆã‚’å¯¾å¿œã•ã›ã‚‹

ã‚ˆã†ãªé–¢æ‰‹ã‚’è€ƒãˆã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚

ã“ã® $F$ ã®æ¯é–¢æ•°ã¯å®šç¾©ã‚ˆã‚Š

$$
F(x) = 1 + 2x + x^2 + x^3
$$

ã¨ãªã‚Šã¾ã™ã€‚

ãªã‚“ã¨ãªãç¿»è¨³ã®ãƒ«ãƒ¼ãƒ«ã¯åˆ†ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€è­°è«–ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã«ã“ã“ã‹ã‚‰ã¯åŸºæœ¬çš„ãªå‹ã¨ãã‚Œã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã‚’å®šç¾©ã—ã€ãã‚Œã‚‰ã‚’ä»£æ•°çš„ã«çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã‚ˆã‚Šè¤‡é›‘ãªå¯¾å¿œã‚’ã‚«ãƒãƒ‹ã‚«ãƒ«ã«æ§‹ç¯‰ã—ã¦ã„ãæ–¹æ³•ã‚’è€ƒãˆãŸã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2f74a1b02bdd-20241207.png =200x)

## Regular Species
ã¾ãšæœ€ã‚‚åŸºæœ¬çš„ãªå‹ã¯å€¤ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒãŸãªã„å‹ã§ã—ã‚‡ã†ã€‚

```hs
data Void a -- å®Ÿè£…ã¯ç©º
```

ã“ã®å‹ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ **ä»»æ„ã®é›†åˆã‚’ç©ºé›†åˆã«å¯¾å¿œä»˜ã‘ã‚‹é–¢æ‰‹** ã§ã€ãã®æ¯é–¢æ•°ã¯

$$
F(x) = 0
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã® Combinatorial Species ã‚’ $0$ ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã«åŸºæœ¬çš„ãªå‹ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãª1ã¤ã®å€¤ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒã¤ã‚ˆã†ãªå‹ã‚’è€ƒãˆã¾ã™ã€‚

```hs
data One a = One
```

ã“ã®å‹ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ **ç©ºé›†åˆã‚’1ç‚¹é›†åˆã«å¯¾å¿œä»˜ã‘ãã‚Œä»¥å¤–ã®é›†åˆã‚’ç©ºé›†åˆã«å¯¾å¿œä»˜ã‘ã‚‹é–¢æ‰‹** ã§ã€ãã®æ¯é–¢æ•°ã¯

$$
F(x) = 1
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã® Combinatorial Species ã‚’ $1$ ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚

Combinatorial Speceis ã¨ã®å¯¾å¿œã‚’è€ƒãˆã‚‹ãŸã‚ã«ã“ã“ã§ã®ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¯å‹å¤‰æ•° `a` ã‚’å–ã‚‹å½¢ã«ãªã£ã¦ã„ã¾ã—ãŸãŒã€å‹ `Void a` ã¨ `One a` ã«ãŠã‘ã‚‹ `a` ã¯å¹½éœŠå‹ã§ã‚ã‚Š `Void a` ã¯ [`Data.Void` ã® `Void`](https://hackage.haskell.org/package/base-4.20.0.1/docs/Data-Void.html#t:Void), `One a` ã¯Unitå‹ `()` ã«åŒå‹ã§ã™ã€‚ã§ã™ã®ã§å‹å¤‰æ•°ãŒãªã„ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã«ã¤ã„ã¦ã‚‚ `Void a`,  `One a` ã¨åŒå‹ãªå‹ã®çµ„ã¿åˆã‚ã›ã¨è€ƒãˆã‚‹ã“ã¨ã«ã‚ˆã‚Š Combinatorial Species ã¨ã®å¯¾å¿œã‚’è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æœ€å¾Œã«æ¬¡ã®ã‚ˆã†ãªå‹ã‚’è€ƒãˆã¾ã™ã€‚

```hs
data X a = X a
```

ã“ã®å‹ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ **1ç‚¹é›†åˆã‚’1ç‚¹é›†åˆã«å¯¾å¿œä»˜ã‘ãã‚Œä»¥å¤–ã®é›†åˆã‚’ç©ºé›†åˆã«å¯¾å¿œä»˜ã‘ã‚‹é–¢æ‰‹** ã§ã€ãã®æ¯é–¢æ•°ã¯

$$
F(x) = x
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã® Combinatorial Species ã‚’ $X$ ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚

ã“ã“ã‹ã‚‰ã¯ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®ç›´å’Œã¨ç›´ç©ã«å¯¾å¿œã™ã‚‹ Combinatorial Speceis ã®æ¼”ç®—ã‚’è€ƒãˆã¾ã™ã€‚

ã¾ãšã¯ä»¥ä¸‹ã®ã‚ˆã†ãª **ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ `f` ã¨ `g` ã®ç›´å’Œ** ã‚’è¡¨ã™å‹ã‚’è€ƒãˆã¾ã™ã€‚

```hs
data Sum f g a = Inl (f a) | Inr (g a)
```

`Sum f g a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Speceis ã¯ã€ `f` ã¨ `g` ã«å¯¾å¿œã™ã‚‹ Combinatorial Speceis ã®ç›´å’Œã§ã™ã€‚Combinatorial Speceis $F$ ã¨ $G$ ã®ç›´å’Œ $F + G$ ã¯å¯¾è±¡ã‚’

$$
(F+G)A = FA \sqcup GA
$$

ã«å†™ã™ã‚ˆã†ãªé–¢æ‰‹ã§ã™ï¼ˆå°„ã®å¯¾å¿œã«ã¤ã„ã¦ã‚‚ç´ ç›´ã«å®šç¾©ã—ã¾ã™ï¼‰ã€‚å®šç¾©ã‚ˆã‚Š $F + G$ ã®æ¯é–¢æ•°ã¯å…ƒã® Combinatorial Species ã®æ¯é–¢æ•°ã®å’Œã¨ãªã‚Šã¾ã™ã€‚

$$
(F + G)(x) = F(x) + G(x)
$$

æ¬¡ã«ä»¥ä¸‹ã®ã‚ˆã†ãª **ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ f ã¨ g ã®ç›´ç©** ã‚’è¡¨ã™å‹ã‚’è€ƒãˆã¾ã™ã€‚

```hs
data Product f g a = Product (f a) (g a)
```

`Product f g a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Speceis ã¯ã€ `f` ã¨ `g` ã«å¯¾å¿œã™ã‚‹ Combinatorial Speceis ã® **ç¨®ç© (Species Product)** ã¨å‘¼ã°ã‚Œã‚‹æ›ã‘ç®—ã§ã™ã€‚Combinatorial Speceis $F$ ã¨ $G$ ã®ç¨®ç© $F \bullet G$ ã¯å¯¾è±¡ã‚’

$$
(F\bullet G)A = \sum_{A=U_1\sqcup U_2} FU_1 \times GU_2
$$

ã¨å†™ã™ã‚‚ã®ã§ã€å’Œã¯é›†åˆ $A$ ã‚’è¡¨ã™éäº¤å’Œãªåˆ†å‰²å…¨ã¦ã«æ¸¡ã£ã¦å–ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚ï¼ˆ$\times$ ã¨ã„ã†è¨˜å·ã¯ã¾ãŸåˆ¥ã®æ¦‚å¿µã§ã‚ã‚‹ Combinatorial Species ã®ãƒ‡ã‚«ãƒ«ãƒˆç©ã«ä½¿ç”¨ã•ã‚Œã‚‹ã®ã§ç¨®ç©ã¯ $\bullet$ ã§è¡¨ã—ã¦ã„ã¾ã™ã€‚ï¼‰ã“ã®ç¨®ç© $F\bullet G$ ã®æ¯é–¢æ•°ã¯å…ƒã®æ¯é–¢æ•°ã®ç©ã«å¯¾å¿œã—ã¾ã™ã€‚

$$
(F \bullet G)(x) = F(x)G(x)
$$

ã“ã“ã§ä¸€æ—¦ã“ã‚Œã¾ã§ã«å®šç¾©ã—ãŸ Combinatorial Species $0, 1, X$ ã¨ãã®æ¼”ç®— $+, \bullet$ ã‚’ç”¨ã„ã¦ã€ã„ãã¤ã‹ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãš

```hs
type Two a = Sum One One a
```

ã¨ã„ã†å‹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚ã“ã®å‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `Bool` ã¨åŒå‹ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```hs
twoToBool :: Two a -> Bool
twoToBool (Inl One) = False
twoToBool (Inr One) = True

boolToTwo :: Bool -> Two a
boolToTwo False = Inl One
boolToTwo True  = Inr One
```

`Two a` ã¯2ã¤ã® `One a` ã®ç›´å’Œãªã®ã§å¯¾å¿œã™ã‚‹ Combinatorial Species $1+1$ ã®æ¯é–¢æ•°ã¯

$$
(1+1)(x) = 1+1 = 2
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã® Combinatorial Species $1+1$ ã‚’ $2$ ã¨å‘¼ã³ã¾ã—ã‚‡ã†ã€‚$n$ ã‚‚åŒæ§˜ã«å®šç¾©ã—ã¾ã™ã€‚ã“ã“ã§å®šç¾©ã—ãŸ Combinatorial Species $0, 1, 2 \dots$ ã¯ç¨®ç©ã«ã¤ã„ã¦ã‚‚è‡ªç„¶ã«æŒ¯ã‚‹èˆã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ä¾‹ãˆã° $2\bullet 3 = 6$ ã«ãªã‚Šã¾ã™ã€‚

æ¬¡ã«

```hs
type Succ a = Sum One X a
```

ã¨ã„ã†å‹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚ã“ã®å‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `Maybe a` ã¨åŒå‹ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```hs
succToMaybe :: Succ a -> Maybe a
succToMaybe (Inl One)   = Nothing
succToMaybe (Inr (X a)) = Just a

maybeToSucc :: Maybe a -> Succ a
maybeToSucc Nothing  = Inl One
maybeToSucc (Just a) = Inr (X a)
```

`Succ a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ $1+X$ ã§ã‚ã‚Šã€ãã®æ¯é–¢æ•°ã¯

$$
(1+X)(x) = 1 + x
$$

ã§ã™ã€‚

ã“ã“ã§ Combinatorial Species $F, G$ ã® **åˆæˆ $F\circ G$** ã¨ã„ã†æ¼”ç®—ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚Combinatorial Species ã¯åœ ${\mathcal B}$ ã®è‡ªå·±é–¢æ‰‹ãªã®ã§ã¾ãšåˆæˆã¨ã—ã¦ã¯å˜ç´”ã«é–¢æ‰‹ã®åˆæˆãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã—ã‹ã— Combinatorial Species ãŒãƒ©ãƒ™ãƒ«ã‹ã‚‰æ§‹é€ ã¸ã®å¯¾å¿œä»˜ã‘ã§ã‚ã‚‹ã¨ã„ã†æåƒã‚’è€ƒãˆã‚‹ã¨å˜ç´”ã«é–¢æ‰‹ã¨ã—ã¦åˆæˆã—ãŸ Combinatorial Species ã¯ãƒ©ãƒ™ãƒ«ã‹ã‚‰å¯¾å¿œä»˜ã‘ã‚‰ã‚ŒãŸæ§‹é€ ã®é›†åˆã‚’æ›´ã«ãƒ©ãƒ™ãƒ«ã¨ã—ã¦æ§‹é€ ã«å¯¾å¿œä»˜ã‘ã‚‰ã‚ŒãŸã‚‚ã®ã¨ãªã‚Šæœ€åˆã®ãƒ©ãƒ™ãƒ«è‡ªä½“ãŒè¤‡è£½ã•ã‚Œã¦ã—ã¾ã£ã¦ï¼ˆã‚ã‚‹ã„ã¯å…±æœ‰ã•ã‚Œã¦ã—ã¾ã£ã¦ï¼‰ç´ ç›´ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã¯å°‘ã—ç•°ãªã‚‹ã‚‚ã®ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ï¼ˆãŸã ã—ã“ã‚Œã¯ã“ã‚Œã§ Combinatorial Species åŒå£«ã®æ¼”ç®—ã¨ã—ã¦è€ƒãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼‰ã€‚ãã“ã§ Combinatorial Species ã®åˆæˆ $F\circ G$ ã¨ã—ã¦ã€ã¾ãšå¯¾è±¡Aã®éäº¤å’Œã«ã‚ˆã‚‹åˆ†å‰² $A = U_1 \sqcup U_2 \sqcup \dots \sqcup U_k$ ã‚’è€ƒãˆãã‚Œãã‚Œã‚’ $G$ ã§å†™ã—ã€ãã®ã‚ˆã†ã«ã—ã¦ã§ããŸé›†åˆ $\{GU_1, GU_2, \dots, GU_k\}$ ã‚’ã•ã‚‰ã«Fã§å†™ã—ãŸã‚‚ã®ã‚’è€ƒãˆã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ **æœ€åˆã«ãƒ©ãƒ™ãƒ«ã‚’ã„ãã¤ã‹ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‘ãã‚Œãã‚Œã®ã‚°ãƒ«ãƒ¼ãƒ—ã§æ§‹é€  $G$ ã«å¯¾å¿œä»˜ã‘ãŸå¾Œã«ãã‚Œã‚‰ã‚’æ›´ã«æ§‹é€  $F$ ã«å…¥ã‚Œå­ã®ã‚ˆã†ã«å¯¾å¿œã•ã›ãŸã‚‚ã®** ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¼ã§æ›¸ãã¨

$$
(F\circ G)A = \sum_{\pi\in P(A)}\left(F\pi\times\prod_{B\in\pi}GB\right)
$$

ã¨ãªã‚Šã¾ã™ã€‚ã“ã“ã§ $P(A)$ ã¯ $A$ ã®éäº¤å’Œã«ã‚ˆã‚‹åˆ†å‰²å…¨ã¦ã®é›†åˆã‚’è¡¨ã—ã¾ã™ã€‚$F\circ G$ ã®æ¯é–¢æ•°ã¯ $F$ ã¨ $G$ ã®æ¯é–¢æ•°ã®åˆæˆé–¢æ•°ã«ãªã‚Šã¾ã™ã€‚

$$
(F\circ G)(x) = F(G(x))
$$

Haskellã®å‹ã¨ã—ã¦ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªåˆæˆã‚’å¯¾å¿œä»˜ã‘ã¾ã™ã€‚

```hs
data Compose f g a = Compose (f (g a))
```

ã“ã‚Œã‚’ä½¿ã£ã¦ `Compose Succ Two a` ã¨ã„ã†å‹ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã®å‹ã¯ `Maybe Bool` ã«åŒå‹ã§ã‚ã‚Šã€å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ $1+2 = 3$ ã§ã‚ã‚Šã€æ¯é–¢æ•°ã‚‚åŒæ§˜ã« $1+x$ ã® $x$ ã« $2$ ã‚’ä»£å…¥ã—ã¦ $3$ ã«ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ä»–ã«ã‚‚ç¨®ç©ã®ä¾‹ã¨ã—ã¦ `Product Two X a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ $2\bullet X$ ã§ã‚ã‚Šã€ãã®æ¯é–¢æ•°ã¯ $2x$ ã¨ãªã‚Šã€`Product X X a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã¯ $X\bullet X$ ã§ã‚ã‚Šã€ãã®æ¯é–¢æ•°ã¯ $x^2$ ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä¾‹ã‹ã‚‰è‡ªç„¶æ•°ã‚’ä¿‚æ•°ã¨ã™ã‚‹ä»»æ„ã®æœ‰é™æ¬¡æ•°å¤šé …å¼ã‚’æ¯é–¢æ•°ã¨ã™ã‚‹ Combinatorial Species ã«å¯¾å¿œã™ã‚‹ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ãŒæ§‹æˆã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã§ã—ã‚‡ã†ã€‚

ã¨ã“ã‚ã§Haskellã®ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã§ã¯å†å¸°çš„ãªå®šç¾©ãŒå¯èƒ½ã§ã—ãŸã€‚ä¾‹ãˆã°æ¨™æº–çš„ãªãƒªã‚¹ãƒˆã®å‹

```hs
data List a = Nil | Cons a (List a)
```

ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã‚’è€ƒãˆã‚‹ã“ã¨ã¯ã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿã“ã®ã‚ˆã†ãªå†å¸°ãƒ‡ãƒ¼ã‚¿å‹ã®å®šç¾©ã¯å‹ã®æœ€å°ä¸å‹•ç‚¹ã‚’å–ã‚‹æ“ä½œã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã¾ã§ã®è€ƒãˆæ–¹ã«åŸºã¥ãã¨ã“ã® `List a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species $L$ ã¯

$$
L \simeq 1 + X \bullet L
$$

ã¨ã„ã†åŒå‹å¯¾å¿œãŒæˆã‚Šç«‹ã¤ã¯ãšã§ã™ã€‚å®Ÿã¯ Combinatorial Species ã«ã¯ Implicit Species Theorem [^3]ã¨ã„ã†å®šç†ãŒã‚ã‚Šã“ã®ã‚ˆã†ãªå¼ã‚’æº€ãŸã™ Combinatorial Species ã®å­˜åœ¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å®šç†ã«ã‚ˆã£ã¦å­˜åœ¨ãŒä¿è¨¼ã•ã‚Œã‚‹ Combinatorial Species ã‚’ **ãƒ‡ãƒ¼ã‚¿å‹ã®æœ€å°ä¸å‹•ç‚¹ã«å¯¾å¿œã™ã‚‹ Combinatorial Species** ã¨è€ƒãˆã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ä¸Šè¨˜å¼ã‹ã‚‰ $L$ ã®æ¯é–¢æ•°ã¯å½¢å¼çš„ã«

$$
L(x) = 1 + x + x^2 + \cdots = \frac{1}{1-x}
$$

ã¨æ›¸ã‘ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ä»¥ä¸Šã«ãŠã‘ã‚‹ Combinatorial Species $1, X$ ã¨ãã®æ¼”ç®— $+, \bullet$ åŠã³æœ€å°ä¸å‹•ç‚¹ã‚’å–ã‚‹æ“ä½œã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã‚‹ Combinatorial Species ã¯ **Regular Species** ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™[^5]ã€‚

![](https://storage.googleapis.com/zenn-user-upload/1bb9bb957245-20241207.png =200x)

## ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®å¾®åˆ†
Combinatorial Species ã«ã¯ **å¾®åˆ†** ã¨ã„ã†æ“ä½œã‚’è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Combinatorial Species $F$ ã®å¾®åˆ† $F'$ ã‚‚ã¾ãŸ Combinatorial Species ã§ã‚ã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

$$
F'A = F(A\sqcup\{*\})
$$

ã¤ã¾ã‚Š $F'A$ ã¯å…ƒã® Combinatorial Species $F$ ã« $A$ ã¨1ç‚¹é›†åˆ $\{*\}$ ã®éäº¤å’Œã‚’é©ç”¨ã—ãŸã‚‚ã®ã¨å®šç¾©ã—ã¾ã™ã€‚

ã„ãã¤ã‹ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãš Combinatorial Species $0$ ã¯ä»»æ„ã®é›†åˆã‚’ç©ºé›†åˆã«å†™ã™ã®ã§ãã®å¾®åˆ†ã‚‚å¤‰ã‚ã‚‰ãš $0$ ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Š

$$
(0)' = 0
$$

ã§ã™ã€‚

æ¬¡ã« Combinatorial Species $1$ ã¯ç©ºé›†åˆã®ã¿1ç‚¹é›†åˆã«å¯¾å¿œã—ãã‚Œä»¥å¤–ã¯ç©ºé›†åˆã«å¯¾å¿œã™ã‚‹ãŸã‚ã€å¾®åˆ†ãŒå…ƒã®é–¢æ‰‹ã«å¼•ãæ•°ã¨1ç‚¹é›†åˆã¨ã®éäº¤å’Œã‚’å–ã£ãŸã‚‚ã®ã‚’é©ç”¨ã™ã‚‹æ“ä½œã§ã‚ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ $1$ ã®å¾®åˆ†ã¯ä»»æ„ã®é›†åˆã«ç©ºé›†åˆã‚’å¯¾å¿œä»˜ã‘ã‚‹é–¢æ‰‹ã€ã¤ã¾ã‚Š $0$ ã¨ãªã‚Šã¾ã™ã€‚

$$
(1)' = 0
$$

ãã—ã¦ Combinatorial Species $x$ ã¯1ç‚¹é›†åˆã«ã¯1ç‚¹é›†åˆã‚’è¿”ã—ã¾ã™ãŒãã‚Œä»¥å¤–ã¯ç©ºé›†åˆã‚’è¿”ã™ã®ã§ã€$x$ ã®å¾®åˆ†ã¯ç©ºé›†åˆã®ã¿1ç‚¹é›†åˆã«å¯¾å¿œã—ãã‚Œä»¥å¤–ã¯ç©ºé›†åˆã‚’è¿”ã™é–¢æ‰‹ã€ã¤ã¾ã‚Š $1$ ã¨ãªã‚Šã¾ã™ã€‚

$$
x' = 1
$$

ä»Šåº¦ã¯ç›´å’Œã®å¾®åˆ†ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚å®šç¾©ã‚ˆã‚Š

$$
\begin{matrix}
(F+G)'A
&=& (F+G)(A\sqcup\{*\}) \\
&=& F(A\sqcup\{*\})\sqcup G(A\sqcup\{*\}) \\
&=& F'A\sqcup G'A \\
\end{matrix}
$$

ã¨ãªã‚‹ã®ã§ Combinatorial Species $F, G$ ã®ç›´å’Œ $F+G$ ã®å¾®åˆ†ã¯ $F, G$ ãã‚Œãã‚Œã®å¾®åˆ†ã®ç›´å’Œã¨ãªã‚Šã¾ã™ã€‚

æ¬¡ã«ç¨®ç©ã®å¾®åˆ†ã¯å®šç¾©ã‚ˆã‚Š

$$
\begin{matrix}
(F\bullet G)'A
&=& (F\bullet G)(A\sqcup\{*\}) \\
&=& \displaystyle\sum_{A\sqcup\{*\}=U_1\sqcup U_2} FU_1 \times GU_2 \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2} F(U_1\sqcup\{*\}) \times GU_2 + \displaystyle\sum_{A=U_1\sqcup U_2} FU_1 \times G(U_2\sqcup\{*\}) \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2} F'U_1 \times GU_2 + \displaystyle\sum_{A=U_1\sqcup U_2} FU_1 \times G'U_2 \\
&=& (F'\bullet G)A + (F\bullet G')A
\end{matrix}
$$

ã¨ãªã‚Šãƒ©ã‚¤ãƒ—ãƒ‹ãƒƒãƒ„å‰‡ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚2è¡Œç›®ã‹ã‚‰3è¡Œç›®ã¸ã¯ $A\sqcup\{*\}$ ã®éäº¤å’Œãª2åˆ†å‰²ãŒ $A$ ã®éäº¤å’Œãª2åˆ†å‰² $A=U_1\sqcup U_2$ ã«å¯¾ã—ã¦ $U_1$ ã« $*$ ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¨ $U_2$ ã« $*$ ã‚’è¿½åŠ ã™ã‚‹å ´åˆã«åˆ†ã‘ã¦è€ƒãˆã‚‰ã‚Œã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

æ›´ã«åˆæˆã®å¾®åˆ†ã¯

$$
\begin{matrix}
(F\circ G)'A
&=& (F\circ G)(A\sqcup\{*\}) \\
&=& \displaystyle\sum_{\pi\in P(A\sqcup\{*\})}\left(F\pi\times\prod_{B\in\pi}GB\right) \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2}\left(\sum_{\pi\in P(U_1)}\left(F(\pi\sqcup\{*\})\times\prod_{B\in\pi}GB\times G(U_2\sqcup\{*\})\right)\right) \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2}\left(\sum_{\pi\in P(U_1)}\left(F'\pi\times\prod_{B\in\pi}GB\times G'U_2\right)\right) \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2}\left(\sum_{\pi\in P(U_1)}\left(F'\pi\times\prod_{B\in\pi}GB\right)\right)\times G'U_2 \\
&=& \displaystyle\sum_{A=U_1\sqcup U_2}(F'\circ G)U_1\times G'U_2 \\
&=& ((F'\circ G)\bullet G')A \\
\end{matrix}
$$

ã¨ãªã‚Šåˆæˆé–¢æ•°ã®å¾®åˆ†æ³•ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚2è¡Œç›®ã‹ã‚‰3è¡Œç›®ã¯$A\sqcup\{*\}$ã®éäº¤å’Œãªåˆ†å‰²ã‚’è€ƒãˆãŸæ™‚ã« $*$ ã‚’å«ã‚“ã§ã„ã‚‹é›†åˆã‚’ $U_2\sqcup\{*\}$ ã¨ç½®ãã¨ $A=U_1\sqcup U_2$ ã¨ã„ã† $A$ ã®éäº¤å’Œãªåˆ†å‰²ã«å¯¾ã—ã¦å…ƒã®éäº¤å’Œãªåˆ†å‰²ãŒã€ã‚ã‚‹ $\pi\in P(U_1)$ ã‚’ä½¿ã£ã¦ $\pi\sqcup\{U_2\sqcup\{*\}\}$ ã¨è¡¨ã›ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚3è¡Œç›®ã®å¼ã«ãŠã‘ã‚‹ $F(\pi\sqcup\{*\})$ ã® $*$ ã¯é›†åˆã‚’è¦ç´ ã¨ã™ã‚‹1ç‚¹é›†åˆ$\{U_2\sqcup\{*\}\}$ ã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼ˆ $F$ ã®å¼•ãæ•°ã«ç¾ã‚Œã‚‹ $*$ ã¨ $G$ ã®å¼•ãæ•°ã«ç¾ã‚Œã‚‹ $*$ ã®æ„å‘³ãŒç•°ãªã‚‹ã®ã§ã‚„ã‚„ã“ã—ã„â€¦ï¼‰ã€‚

ã“ã‚Œã‚‰ã®ä¾‹ã¨æ¯é–¢æ•°ã®å¯¾å¿œã‚’è€ƒãˆã‚‹ã“ã¨ã«ã‚ˆã‚Š **Combinatorial Species ã®å¾®åˆ†ã®æ¯é–¢æ•°ã¯å…ƒã®æ¯é–¢æ•°ã®å¾®åˆ†ã«å¯¾å¿œã™ã‚‹** ã“ã¨ã‚‚åˆ†ã‹ã‚‹ã§ã—ã‚‡ã†ã€‚

ã•ã¦ã“ã® Combinatorial Species ã®å¾®åˆ†ã‚’ç”¨ã„ã¦ **ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®å¾®åˆ†** ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚ã™ãªã‚ã¡ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã®å¾®åˆ†ã‚’å…ƒã®ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã«å¯¾å¿œã™ã‚‹ Combinatorial Species ã‚’å¾®åˆ†ã—ãŸ Combinatorial Species ã«å¯¾å¿œã™ã‚‹ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¨ã™ã‚‹ã®ã§ã™ã€‚

ä¾‹ãˆã° `List a` ã«å¯¾å¿œã™ã‚‹ Combinatorial Species $L$ ã®æ¯é–¢æ•°ã®å¾®åˆ†ã‚’è€ƒãˆã‚‹ã¨

$$
\begin{matrix}
L'(x)
&=& \left(\frac{1}{1-x}\right)' \\
&=& \left(\frac{1}{1-x}\right)^2 \\
&=& L(x)^2 \\
\end{matrix}
$$

ã¨ãªã‚Š `List a` ã®å¾®åˆ†ã¯ `(List a, List a)` ã«åŒå‹ãªå‹ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚å®Ÿã¯ã“ã‚Œã¯ `List a` ã® **Zipper** ã¨åŒã˜å‹ã«ãªã£ã¦ãŠã‚Šã€ä¸€èˆ¬ã«ãƒ‡ãƒ¼ã‚¿å‹ã® Zipper ã‚’å¾—ã‚‹æ“ä½œã¯ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¾®åˆ†ã—ã¦ã„ã‚‹ã¨è§£é‡ˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™[^4]ã€‚

![](https://storage.googleapis.com/zenn-user-upload/bc40000a58f7-20241207.png =200x)

## ã¾ã¨ã‚
ä»¥ä¸Šã®è©±ã‚ˆã‚Šä»¥ä¸‹ã®ã‚ˆã†ãªå¯¾å¿œè¡¨ãŒæ›¸ã‘ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚

|å‹|Combinatorial Species|æ¯é–¢æ•°|
|:---:|:---:|:---:|
|`data Void`|$0$|$0$|
|`data One = One`|$1$|$1$|
|`type Two = Sum One One`|$1+1$|$1+1=2$|
|`data Maybe a = Nothing \| Just a`|$1 + X$|$1+x$|
|`data Sum a b = A a \| B b`|$A + B$|$A(x)+B(x)$|
|`data Product a b = Product a b`|$A \bullet B$|$A(x)\times B(x)$|
|`data Compose f g a = Compose (f (g a))`|$F \circ G$|$F(G(x))$|
|ãƒ‡ãƒ¼ã‚¿å‹Fã®å¾®åˆ†|$F'$|$F(x)'$|

ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã«å¯¾å¿œã™ã‚‹å¤šé …å¼ã‚’ Combinatorial Species ã‚’çµŒç”±ã—ã¦ã‹ã‚‰æ¯é–¢æ•°ã¨ã—ã¦å¾—ã‚‹ã“ã¨ã§ **ãƒ©ãƒ™ãƒ«ä»˜ã‘ã‚‰ã‚ŒãŸæ§‹é€ ã®é›†åˆã¨ã„ã†ç›´æ„Ÿçš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã¡ãªãŒã‚‰å¾®åˆ†ã¨ã„ã£ãŸæ·±ã„æ§‹é€ ã«ã‚‚è¨€åŠã§ãã‚‹ã‚ˆã†ã«ãªã‚‹** ã®ãŒã€Combinatorial Species ã¨ã—ã¦è€ƒãˆã‚‹ã“ã¨ã®é¢ç™½ã•ã®ä¸€ã¤ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã®è§£é‡ˆã®æ¬ ç‚¹ã‚’æŒ™ã’ã‚‹ã¨ã™ã‚Œã°é–¢æ•°ã®å‹ `a -> b` ã«è¨€åŠã§ãã¦ã„ãªã„ã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å®šæ•°ã‹ã‚‰å®šæ•°ã¸ã®å¯¾å¿œãªã‚‰åŒå‹å¯¾å¿œã‚’ä½¿ã£ã¦ãªã‚“ã¨ã‹è€ƒãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€èˆ¬ã«ã¯å¯¾å¿œã™ã‚‹æ¯é–¢æ•°ã®æ¼”ç®—ãŒ $g(x)^{f(x)}$ ã‚„é …ã”ã¨ã®å†ªã¨ãªã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã‚‹ãŸã‚å¤šé …å¼ã«é–‰ã˜ãªããªã‚Šé›£ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ä»–ã«ã‚‚ Combinatorial Species ã«ã¯è‰²ã€…ãªæ‹¡å¼µãŒè€ƒãˆã‚‰ã‚Œã¦ãŠã‚Šã€è¤‡æ•°ã®å¼•ãæ•°ã‚’å–ã‚Œã‚‹ã«ã‚ˆã†ã«æ‹¡å¼µã—ãŸ **Multisort Species**ï¼ˆImplicit Species Theorem ã‚’å³å¯†ã«è¿°ã¹ã‚‹ãŸã‚ã«ã‚‚å¿…è¦ã€‚åå¾®åˆ†ã‚‚å®šç¾©ã§ãã‚‹ï¼‰ã‚„ã€è¶³ã—ç®—ã ã‘ã§ãªãå¼•ãç®—ã‚‚è€ƒãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«æ‹¡å¼µã—ãŸ **Virtual Species** ã‚„[^6]ã€Combinatorial Species ã®å·¦Kanæ‹¡å¼µã¨ã—ã¦ **Analytic Functor** ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ãŒæœ‰é™é›†åˆã®åœ ${\mathcal B}$ ã‹ã‚‰é›†åˆã®åœ $Set$ ã«æ‹¡å¼µã•ã‚Œã‚‹ã€‚"ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹"ã‚’æŒã¤ã‚ˆã†ãªé–¢æ‰‹ï¼‰ã¨ã„ã£ãŸã‚‚ã®ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

æœ€å¾Œã«ã€ã‚‚ã—ä»Šå›ã®è©±ã«èˆˆå‘³ãŒã‚ã‚Œã°ä»¥ä¸‹ã®æ–‡çŒ®ã‚’èª­ã‚€ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚

- [Species and Functors and Types, Oh My!](https://www.semanticscholar.org/paper/Species-and-functors-and-types%2C-oh-my!-Yorgey/1488066d257708b161dafb40474989307628c7b8)
- [Combinatorial Species and Labelled Structures](https://www.semanticscholar.org/paper/Combinatorial-species-and-labelled-structures-Yorgey/5d79e4ec3fe49a3004037a979ca27d08ebfb409a)

æŒ¿çµµã‚¤ãƒ©ã‚¹ãƒˆ: [Loose Drawing](https://loosedrawing.com/)

----

ï¼¼èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼ï¼
ã“ã®è¨˜äº‹ãŒé¢ç™½ã‹ã£ãŸã‚‰ ã„ã„ã­â™¡ ã‚’ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™â˜ºï¸
ãƒãƒƒã‚¸ã‚’è´ˆã£ã¦ã„ãŸã ã‘ã‚Œã°æ¬¡ã®è¨˜äº‹ã‚’æ›¸ããŸã‚åŠ±ã¿ã«ãªã‚Šã¾ã™ğŸ™Œ

[^1]: [A History of Haskell: being lazy with class](https://www.microsoft.com/en-us/research/publication/a-history-of-haskell-being-lazy-with-class/)
[^2]: åŸºæœ¬çš„ãªå‹ã‚’è€ƒãˆã¦ã„ã‚‹é™ã‚Šå‹ã‚’é›†åˆã¨æ‰ãˆã‚‹ã“ã¨ã¯ã†ã¾ãã„ãã¾ã™ãŒã€ä¾‹ãˆã° `T a = (a -> Bool) -> Bool` ã¨ã„ã†é–¢æ‰‹ã®ä¸å‹•ç‚¹ã‚’è€ƒãˆã‚‹ã¨æ¿ƒåº¦ã«é–¢ã™ã‚‹è­°è«–ãŒã†ã¾ãã„ã‹ãªããªã‚‹ã¨ã„ã£ãŸä¾‹å¤–ãŒã‚ã‚Šï¼ˆ[Polymorphism is not set theoretic](https://h2.jaguarpaw.co.uk/posts/polymorphism-is-not-set-theoretic/)ï¼‰ä¸€èˆ¬çš„ã«ã¯å‹ã¨é›†åˆã¯ç•°ãªã‚‹ã‚‚ã®ã§ã™
[^3]: [A quick introduction to species, operads, and closed multicategories](https://noamz.org/LambdaComb/kickoff/noam.zeilberger.pdf)
[^4]: [Haskell/Zippers - Wikibooks](https://ja.wikibooks.org/wiki/Haskell/Zippers)
[^5]: [Species and Functors and Types, Oh My!](https://www.semanticscholar.org/paper/Species-and-functors-and-types%2C-oh-my!-Yorgey/1488066d257708b161dafb40474989307628c7b8)
[^6]: [Species subtraction made simple](https://byorgey.wordpress.com/2010/11/24/species-subtraction-made-simple/)