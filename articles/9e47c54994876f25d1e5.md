---
title: "ãƒãƒåŸ‹ã‚è¾¼ã¿æ³•ã‚’ä½¿ã£ã¦éš£æ¥è¡Œåˆ—ã‹ã‚‰ã‚°ãƒ©ãƒ•ã‚’æç”»ã™ã‚‹"
emoji: "ğŸ•¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Haskell", "æ©Ÿæ¢°å­¦ç¿’", "math", "graph"]
published: true
---

["ã‚°ãƒ©ãƒ•ã‹ã‚‰ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ§‹é€ ã‚’æŠ½å‡ºã™ã‚‹ ã€œãƒªãƒƒãƒãƒ•ãƒ­ãƒ¼ã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•ã®æ™‚é–“ç™ºå±•ã€œ"](https://zenn.dev/lotz/articles/eebd7ea4d1fe776f1f66) ã§ã¯ãƒªãƒƒãƒãƒ•ãƒ­ãƒ¼ã«ã‚ˆã‚‹éš£æ¥è¡Œåˆ—ã‚’æ™‚é–“å¤‰åŒ–ã‚’è¨ˆç®—ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/g05g7n0fsmip9h8bmfhp5jswqrsf =400x)


ã—ã‹ã—éš£æ¥è¡Œåˆ—ã®ãƒªã‚¹ãƒˆãŒå¾—ã‚‰ã‚ŒãŸã¨ã—ã¦ã‚‚ã€ãã“ã‹ã‚‰ç›´ã¡ã«ä¸Šè¨˜ã®ã‚ˆã†ãªå¯è¦–åŒ–ã‚’è¡Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã“ã®è¨˜äº‹ã§ã¯**éš£æ¥è¡Œåˆ—ã‹ã‚‰ã©ã†ã‚„ã£ã¦ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–ã‚’è¡Œã†ã‹**ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

ãƒ™ã‚¯ãƒˆãƒ«ã‚„è¡Œåˆ—ã®å®Ÿè£…ã¯å‰ã®è¨˜äº‹ã§å®Ÿè£…ã—ãŸã‚‚ã®ã‚’ä½¿ã„ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§å¿…è¦ã«ãªã‚‹å®Ÿè£…ã¯ä»¥ä¸‹ã®ãƒˆã‚°ãƒ«ã«è¨˜è¼‰ã—ã¦ãŠãã¾ã—ãŸã€‚

:::details ç·šå½¢ä»£æ•°ã®å®Ÿè£…
```hs
import Data.Vector.Sized (Vector)
import qualified Data.Vector.Sized as V

--------------
-- ãƒ™ã‚¯ãƒˆãƒ«
--------------

-- | ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚¹ã‚«ãƒ©ãƒ¼å€
(*^) :: Num a => a -> Vector n a -> Vector n a
a *^ v = fmap (a*) v

-- | ãƒ™ã‚¯ãƒˆãƒ«é–“ã®è¶³ã—ç®—
(^+^) :: Num a => Vector n a -> Vector n a -> Vector n a
(^+^) = V.zipWith (+)

-- | ãƒ™ã‚¯ãƒˆãƒ«é–“ã®å¼•ãç®—
(^-^) :: Num a => Vector n a -> Vector n a -> Vector n a
(^-^) = V.zipWith (-)

-- | ãƒ™ã‚¯ãƒˆãƒ«ã®L2ãƒãƒ«ãƒ 
norm2 :: Floating a => Vector n a -> a
norm2 = sqrt . V.sum . fmap (^2)

-- | ãƒ™ã‚¯ãƒˆãƒ«é–“ã®ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢
distance :: Floating a => Vector n a -> Vector n a -> a
distance xs ys = norm2 (xs ^-^ ys)

--------------
-- è¡Œåˆ—
--------------

-- | m Ã— n è¡Œåˆ—
type Matrix m n a = Vector m (Vector n a)

-- | å…¨ã¦åŒã˜å€¤ã‚’æŒã¤è¡Œåˆ—ã‚’ä½œæˆã™ã‚‹é–¢æ•°
konst :: (KnownNat m, KnownNat n) => a -> Matrix m n a
konst a = V.replicate (V.replicate a)

-- è¡Œåˆ—ã®ã‚¹ã‚«ãƒ©ãƒ¼å€
(*!!) :: Semiring a => a -> Matrix m n a -> Matrix m n a
a *!! m = mmap (otimes a) m

-- | å„æˆåˆ†ã”ã¨ã®æ¼”ç®—
elementWise :: (a -> b -> c) -> Matrix m n a -> Matrix m n b -> Matrix m n c
elementWise op = V.zipWith (V.zipWith op)

-- | è¡Œåˆ—ã®å’Œ
(!+!) :: Semiring a => Matrix m n a -> Matrix m n a -> Matrix m n a
(!+!) = elementWise oplus
```
:::

ãƒãƒåŸ‹ã‚è¾¼ã¿æ³•
--------------
ãƒãƒåŸ‹ã‚è¾¼ã¿æ³•ã¯**ã‚°ãƒ©ãƒ•ã®ãƒãƒ¼ãƒ‰ã‚’é‡ã‚Šã€ã‚¨ãƒƒã‚¸ã‚’ãƒãƒã ã¨æ€ã£ã¦ã€ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦å®‰å®šã—ãŸé…ç½®ã‚’æç”»ã™ã‚‹**ã¨ã„ã†ã‚°ãƒ©ãƒ•æç”»æ‰‹æ³•ã®ä¸€ã¤ã§ã™[^1]ã€‚

ã“ã“ã§ã¯ã‚°ãƒ©ãƒ•ã®ãƒãƒ¼ãƒ‰ã®é‡ã•ã¯å…¨ã¦$1$ã§ã‚ã‚‹ã¨ã—ã€ãƒãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªåŠ›ãŒåƒãã¨ä»®å®šã—ã¾ã™ã€‚

### ãƒãƒã®åŠ›
ãƒãƒ¼ãƒ‰$i$ã¨ãƒãƒ¼ãƒ‰$j$ã®é–“ã«é•·ã•$l$ã®ã‚¨ãƒƒã‚¸ãŒå­˜åœ¨ã—ãŸæ™‚ã€ãƒãƒ¼ãƒ‰$i$ã«ã¯ä»¥ä¸‹ã®å¤§ãã•ã‚’æŒã¤ãƒãƒã®åŠ›ãŒãƒãƒ¼ãƒ‰$j$ã®æ–¹å‘ã«å‘ã‹ã£ã¦åƒãã¾ã™ã€‚

$$
-k(l - d_{ij})
$$

ã“ã“ã§$k$ã¯ãƒãƒå®šæ•°ã§ã‚ã‚Šã€$d_{ij}$ã¯ãƒãƒ¼ãƒ‰$i, j$é–“ã®è·é›¢ã§ã™ã€‚

ã“ã®åŠ›ã«ã‚ˆã£ã¦**å„ãƒãƒ¼ãƒ‰ã¯ã‚¨ãƒƒã‚¸ã®é‡ã•ãŒè·é›¢ã«å¯¾å¿œã™ã‚‹ã‚ˆã†ãªä½ç½®ã«é…ç½®ã•ã‚Œã‚‹**ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šé‡ã„ã‚¨ãƒƒã‚¸ã‚’å…±æœ‰ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã©ã‚“ã©ã‚“é›¢ã‚Œã¦ã„ãè»½ã„ã‚¨ãƒƒã‚¸ã‚’å…±æœ‰ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã©ã‚“ã©ã‚“è¿‘ã¥ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### ã‚¯ãƒ¼ãƒ­ãƒ³åŠ›
ãƒãƒã®åŠ›ã ã‘ã ã¨**ãƒãƒ¼ãƒ‰ã¨ãƒãƒ¼ãƒ‰ãŒé‡ãªã£ã¦è¦‹ãˆã¥ã‚‰ããªã£ã¦ã—ã¾ã†**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãªã®ã§ãƒãƒ¼ãƒ‰é–“ã«ã¯ä»¥ä¸‹ã®å¤§ãã•ã‚’æŒã¤ã‚¯ãƒ¼ãƒ­ãƒ³åŠ›ï¼ˆæ–¥åŠ›ï¼‰ãŒåƒãã¨ä»®å®šã—ã¾ã™ã€‚

$$
\frac{q}{d_{ij}^2}
$$

$q$ã¯ã‚¯ãƒ¼ãƒ­ãƒ³åŠ›ã®å¤§ãã•ã‚’è¡¨ã™å®šæ•°ã§ã™ã€‚ã“ã®æ–¥åŠ›ã¯è·é›¢ã®äºŒä¹—ã«åæ¯”ä¾‹ã—ã¦å°ã•ããªã£ã¦ã„ãã¾ã™ã€‚

### æ‘©æ“¦åŠ›

**ä¸Šè¨˜ï¼’ã¤ã®åŠ›ã ã‘ã ã¨æŒ¯å‹•ã—ã¦æ°¸é ã«åæŸã—ãªã„å¯èƒ½æ€§**ãŒã‚ã‚‹ã®ã§ãƒãƒ¼ãƒ‰ã«ã¯æ‘©æ“¦åŠ›ãŒã‹ã‹ã‚Šå¾ã€…ã«æ¸›è¡°ã—ã¦ã„ãã¨ã—ã¾ã™ã€‚

$$
\mu
$$

$\mu$ã¯æ‘©æ“¦ä¿‚æ•°ã§å¸¸ã«ãƒãƒ¼ãƒ‰ãŒå‹•ãæ–¹å‘ã¨åå¯¾æ–¹å‘ã«æ›ã‹ã‚‹åŠ›ã§ã™ã€‚ãªã®ã§å˜ç´”ã«ãƒãƒ¼ãƒ‰ã®é€Ÿåº¦ã‚’æ¸›é€Ÿã•ã›ã¦ã„ãã‚ˆã†ãªä½œç”¨ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### åŸç‚¹ã¸ã®å¼•åŠ›
ãƒãƒåŸ‹ã‚è¾¼ã¿æ³•ã§èª¿ã¹ã‚‹ã¨ä¸Šè¨˜ï¼“ã¤ã®åŠ›ãŒåŸºæœ¬çš„ãªã‚‚ã®ã¨ã—ã¦èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã ã‘ã ã¨**ã‚°ãƒ©ãƒ•ãŒé€£çµã§ãªã‹ã£ãŸå ´åˆã«éé€£çµæˆåˆ†åŒå£«ãŒç„¡é™ã«é›¢ã‚Œã¦ã„ã£ã¦ã—ã¾ã†**ã®ã§åŸç‚¹ã«å¯¾ã—ã¦å°‘ã—å¼•åŠ›ãŒåƒãã‚ˆã†ã«ã—ã¦ãŠãã¨ã‚°ãƒ©ãƒ•ã®é…ç½®ãŒåŸç‚¹ã‚’ä¸­å¿ƒã¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šè¨ˆç®—ãŒå®‰å®šã—ã¾ã™ã€‚

$$
-\frac{g}{d_{i0}^2}
$$

$g$ã¯åŸç‚¹ã¸ã®å¼•åŠ›ã®ä¿‚æ•°ã§ã‚ã‚Šã€$d_{i0}$ã¯åŸç‚¹ã‹ã‚‰ãƒãƒ¼ãƒ‰ã¾ã§ã®è·é›¢ã§ã™ã€‚

----

ä»¥ä¸Š4ã¤ã®åŠ›ãŒã‚°ãƒ©ãƒ•ã®ãƒãƒ¼ãƒ‰ã«åƒãã¨ã—ãŸä¸Šã§é©å½“ãªåˆæœŸå€¤ã‹ã‚‰å§‹ã‚ã¦ã€æ™‚é–“å¤‰åŒ–ãŒäºˆã‚æ±ºã‚ãŸé–¾å€¤ã‚ˆã‚Šä½ããªã‚‹ã¾ã§ã€ã‚ªã‚¤ãƒ©ãƒ¼æ³•ã§æ™‚é–“ç™ºå±•ã‚’è¨ˆç®—ã™ã‚Œã°ã‚°ãƒ©ãƒ•ã®é…ç½®ãŒæ±‚ã¾ã‚‹ã¨ã„ã†å¯¸æ³•ã§ã™ã€‚**ã“ã®è€ƒãˆæ–¹ã¯ã‚°ãƒ©ãƒ•ã‚’åŸ‹ã‚è¾¼ã‚€ç©ºé–“ã®æ¬¡å…ƒã«ã¯ä¾å­˜ã—ãªã„**ã®ã§å¹³é¢ã§ã‚‚3æ¬¡å…ƒç©ºé–“ã«åŸ‹ã‚è¾¼ã‚€å ´åˆã§ã‚‚åŒæ§˜ã®æ–¹æ³•ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å®Ÿè£…ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

```hs
-- | ãƒ™ã‚¯ãƒˆãƒ«ã®ãƒãƒ«ãƒ ã‚’1ã«ã™ã‚‹
normalize' :: Floating a => Vector n a -> Vector n a
normalize' v = fmap (/ norm2 v) v

-- | ãƒãƒåŸ‹ã‚è¾¼ã¿æ³•ã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•æç”»
springEmbed :: (KnownNat m, KnownNat n)
            => Matrix m m Double  -- éš£æ¥è¡Œåˆ—
            -> Matrix m n Double  -- åˆæœŸä½ç½®
            -> Matrix m n Double  -- è¨ˆç®—ä½ç½®
springEmbed adj ps0 = flip fix (ps0, konst 0.0) \loop (ps, vs) ->
  let vs' = flip V.imap vs \i v ->
          let p = ps `V.index` i
              f j p' accum = if i == j then accum
                  else let w  = adj `V.index` i `V.index` j
                           d  = distance p p'
                           f1 = q / d^2                                -- ã‚¯ãƒ¼ãƒ­ãƒ³åŠ›
                           f2 = if w == 0.0 then 0.0 else -k * (d - w) -- ãƒãƒã®åŠ›
                           f3 = -g / d^2                               -- åŸç‚¹ã¸ã®å¼•åŠ›
                        in accum ^+^ ((f1 + f2) *^ normalize' (p ^-^ p')) ^+^ (f3 *^ normalize' p)
              dv = V.ifoldr f (V.replicate 0) ps
           in mu *^ (v ^+^ (dt *^ dv))
      ps' = ps !+! (dt *!! vs')
   in if norm2 (fmap norm2 vs') < e then ps' else loop (ps', vs')
  where
    g  = 0.01 -- åŸç‚¹ã¸ã®å¼•åŠ›
    q  = 0.1  -- ãƒãƒ¼ãƒ‰é–“ã®æ–¥åŠ›
    k  = 1.0  -- ã°ã­å®šæ•°
    mu = 0.9  -- æ‘©æ“¦ä¿‚æ•°
    dt = 0.1  -- å¾®å°æ™‚é–“
    e  = 0.1  -- åæŸåˆ¤å®šã®ã—ãã„å€¤
```

è¨ˆç®—çµæœ `Matrix m n a` ã¯$m$å€‹ã®ãƒãƒ¼ãƒ‰ã®$n$æ¬¡å…ƒç©ºé–“ã§ã®åº§æ¨™ãŒã¾ã¨ã‚ã‚‰ã‚ŒãŸè¡Œåˆ—ã§ã™ã€‚æœ€åˆã¯é©å½“ãªåˆæœŸä½ç½®ã‹ã‚‰è¨ˆç®—ã‚’å§‹ã‚ã‚Œã°è‰¯ã„ã§ã™ã—ã€ã‚‚ã—éš£æ¥è¡Œåˆ—ã®æ™‚é–“ç™ºå±•ã‚’æ‰±ã£ã¦ã„ã‚‹å ´åˆã¯ã€**ä¸€ã¤å‰ã®æ™‚é–“ã«ãŠã‘ã‚‹é…ç½®ã‚’åˆæœŸå€¤ã«ã™ã‚‹ã“ã¨ã§æ»‘ã‚‰ã‹ãªã‚°ãƒ©ãƒ•ã®æ™‚é–“ç™ºå±•ã‚’æç”»ã™ã‚‹ã“ã¨ãŒã§ãã‚‹**ã§ã—ã‚‡ã†ã€‚ã‚ã¨ã¯glossç­‰ã‚’ç”¨ã„ã¦æ±‚ã‚ãŸé…ç½®ã«ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’æç”»ã™ã‚Œã°ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–ã®å®Œæˆã§ã™ ğŸ‘

![](https://storage.googleapis.com/zenn-user-upload/u5wxi5ononub3duadhs3q89kg1yn =300x)

P.S. å‚è€ƒã¾ã§ã«glossã®ä½¿ã„æ–¹ã‚’è¼‰ã›ãŸè¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯ã‚’å¼µã£ã¦ãŠãã¾ã™

https://qiita.com/lotz/items/eb73e62a64bc208c2dd6

----

ï¼¼èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼ï¼
ã“ã®è¨˜äº‹ãŒé¢ç™½ã‹ã£ãŸã‚‰ ã„ã„ã­â™¡ ã‚’ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™â˜ºï¸
ãƒãƒƒã‚¸ã‚’è´ˆã£ã¦ã„ãŸã ã‘ã‚Œã°æ¬¡ã®è¨˜äº‹ã‚’æ›¸ããŸã‚åŠ±ã¿ã«ãªã‚Šã¾ã™ğŸ™Œ

[^1]: ç†è«–çš„ãªè©±ã¯ã“ã¡ã‚‰ [Tutte embedding - Wikipedia](https://en.wikipedia.org/wiki/Tutte_embedding)